(self.webpackChunkrose_inc_web=self.webpackChunkrose_inc_web||[]).push([[476],{47476:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PlaybackTime:()=>on,default:()=>wn,getPlaybackTimeMillis:()=>sn,useDirtyAtPlaybackTime:()=>cn,useStateFromChatOrShow:()=>tn});n(35666),n(74916),n(64765),n(66992),n(41539),n(78783),n(33948),n(60285),n(23123),n(21249),n(57327),n(69826),n(68309),n(29254),n(34553),n(9653),n(69720),n(82526),n(41817),n(32165),n(47042),n(91038),n(88674),n(47941),n(38880),n(54747),n(49337);var r=n(67294),a=n(59010),i=n(96974),o=n(99490),s=n(90057),c=n(76581),u=(n(73210),n(39714),n(30653)),l=n(20185),d=n(31662),p=n(77825),v=n(18441),m=n(58905);function f(e,t){var n;if(0===t)return(0,m.Iu)("shop.product.free");var r=t/100;if(null!==(n=window.GEP)&&void 0!==n&&n.currency&&window.GEP.isOperatedByGlobale)return r=window.GEP.convertPrice(r,window.GEP.geFactor,window.GEP.vatRateTypes,null,window.GEP.isGrossPrices,window.GEP.roundingPrecision,window.GEP.currencyDecimalPlaces,1,!1,null,null,null),window.GEP.utils.getSymboledPrice(r,window.GEP.currency,r===Math.floor(r)?0:window.GEP.minFractionDigits);var a=(0,m.Iu)("global.locale.locale"),i=r===Math.floor(r)?0:void 0;return new Intl.NumberFormat(a,{style:"currency",currency:e,minimumFractionDigits:i}).format(r)}var h=n(36334),g=n(55468),b=n(46121);const y=n.p+"ef44e6fbf683a406f6ab8c0e4ed8ba2c.svg";var w=n(56931),_=n(65503),E=n(51120),k=n(89776);var I=r.createContext(void 0),C=function(){return(0,r.useContext)(I)},S=n(73902);function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=T(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){s=!0,i=e})),f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function F(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){D(i,r,a,o,s,"next",e)}function s(e){D(i,r,a,o,s,"throw",e)}o(void 0)}))}}function L(e,t){return j.apply(this,arguments)}function j(){return(j=F(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n).catch((function(e){return h.Z.instance.report(e),(0,m.Iu)("shop.bag.addition_error")}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,n,r){return U.apply(this,arguments)}function U(){return(U=F(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={_showId:n.showId,_isLive:n.isLive,_location:n.location},n.playbackTime&&(o._playbackTime=new Date(n.playbackTime).toISOString()),void 0!==t.bundleItems&&(s=t.bundleItems.map((function(e,t){var n,a,i=r[t];return{name:e.handle,variant:i.id,value:i.sku,calculated_bundle_price:i.priceCents/100,quantity:1,product_title:e.name,product_image:null!==(n=null===(a=e.img)||void 0===a?void 0:a.src)&&void 0!==n?n:"",product_option:i.options.length>0?i.options[0]:""}})),o.bundle_product=JSON.stringify(s)),!n.user||void 0===(null===(i=n.hasDiscount)||void 0===i?void 0:i.discounts[t.id])){e.next=20;break}if(!(c=(0,p.i)())){e.next=18;break}return e.prev=6,e.next=9,l.sO.getDiscountCode(n.user,n.showId,t.id,c);case 9:o._discountCode=e.sent.discountCode,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(6),e.t0 instanceof _.z&&400===e.t0.response.status&&(null==a||a()),e.t0;case 16:e.next=20;break;case 18:console.error("Friend discount can't be added to cart - Shopify customer ID missing"),null===(u=h.Z.instance)||void 0===u||u.report("Friend discount can't be added to cart - Shopify customer ID missing");case 20:return e.abrupt("return",o);case 21:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)}var V=function(e,t,n){var r=null==n?void 0:n.discounts[e.id];if(t.priceCents!==t.compareAtPriceCents||void 0!==r){var a=0;return void 0!==r&&"PERCENTAGE"===r.method&&(a=null==r?void 0:r.amount),function(e,t,n){return f(e,t*(100-n)/100)}(document.data.currency.isoCode,t.priceCents,a)}};function H(e){var t,n,a=(0,E.L)();C();var i=e.productAndDefaultVariant,o=e.variantsAndProducts,c=e.hasDiscount,l=e.getDataForLineItemProperties,p=e.onDone,h=i.product,_=P((0,r.useState)(i.variant),2),I=_[0],A=_[1],R=(0,b.jD)(),T=R.cartResult,x=R.setCartResult,D=R.isCartLoading,j=R.setIsCartDirty,U=P((0,r.useState)(null),2),H=U[0],W=U[1],q=P((0,r.useState)(!1),2),K=q[0],Z=q[1],Q=P((0,r.useState)(1),2),z=Q[0],Y=Q[1],J=P((0,s.x)(void 0!==h.bundleItems?h.bundleItems.map((function(e){return e.variants[0]})):void 0),2),X=J[0],$=J[1],ee=P((0,r.useState)(!1),2),te=ee[0],ne=ee[1],re=P((0,r.useState)(!1),2),ae=re[0],ie=re[1],oe=(0,k.F)({product:h,variant:I},X),se=oe.loading,ce=oe.selectionInStock,ue=oe.outOfStockVariantIds;(0,r.useEffect)((function(){if(H){var e=setTimeout((function(){W(null)}),7e3);return function(){return clearTimeout(e)}}}),[H]),(0,r.useEffect)((function(){te&&!D&&(p(),ne(!1))}),[te,D,p]);var le=(0,r.useCallback)(function(){var t=F(regeneratorRuntime.mark((function t(n){var r,i,s,u,p,v,f,b,y,w,_,E,k,C,S,A,R,D,F,U,V,H,G,q,K,Z,Q,Y,J,$,ee,te,re,ae=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=ae.length>1&&void 0!==ae[1]&&ae[1],ie(!0),!(s=T.cart)){t.next=11;break}if(!(s.items.length>=15)){t.next=9;break}return W((0,m.Iu)("shop.product.too_many_items_in_bag")),ie(!1),t.abrupt("return");case 9:t.next=14;break;case 11:return W((0,m.Iu)("shop.bag.addition_error")),ie(!1),t.abrupt("return");case 14:return u=n?window.open("","_blank"):null,p=l(),t.next=18,B(h,p,X,e.refreshDiscount);case 18:v=t.sent,i&&(f=a.preOrderCartNoteKey)&&(v[f]=I.preOrderCartNote),b=null==c?void 0:c.discounts[h.id],d.Z.logAddToBag({product_handle:h.handle,product_id:h.id,variant_id:I.id,show_id:p.showId,show_discount_percent:"PERCENTAGE"===(null==b?void 0:b.method)?b.amount:null,show_discount_type:null!==(r=null==b?void 0:b.type)&&void 0!==r?r:null,has_discount:void 0!==b,is_live:p.isLive,buy_now:n,location:p.location,playback_time:p.isLive?null:void 0!==p.playbackTime?Math.floor(p.playbackTime):null}),n?(_=null!=u?u:window,y=function(){var e;ie(!1),null!==(e=window.GEP)&&void 0!==e&&e.isOperatedByGlobale?_.location.href="/pages/globalECheckout":_.location.href="/checkout",ne(!0)},w=function(e){ie(!1),u&&u.close(),W(e)}):(y=function(){var t,n;(ie(!1),e.showMiniCartOnAddToBag)&&(null===(t=window.beautyLabsCart)||void 0===t||null===(n=t.showMinicart)||void 0===n||n.call(t,!1,I,h));ne(!0)},w=function(e){ie(!1),W(e)}),E=!0,k=!0,C=O(s.items),t.prev=26,A=regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.value,n=!0,I.id!==t.id&&(n=!1),n&&(Object.entries(v).every((function(e){var n=P(e,2),r=n[0],a=n[1];return"_playbackTime"===r||t.properties[r]===a}))&&Object.entries(t.properties).every((function(e){var t=P(e,2),n=t[0],r=t[1];return"_playbackTime"===n||r===v[n]}))||(n=!1)),!n){e.next=15;break}return e.next=7,L(g.W.changeCart,{id:t.key,quantity:t.quantity+z});case 7:if("string"!=typeof(r=e.sent)){e.next=11;break}return w(r),e.abrupt("return",{v:void 0});case 11:return s=r,E=!1,k=!1,e.abrupt("return","break");case 15:case"end":return e.stop()}}),e)})),C.s();case 29:if((S=C.n()).done){t.next=38;break}return t.delegateYield(A(),"t0",31);case 31:if("break"!==(R=t.t0)){t.next=34;break}return t.abrupt("break",38);case 34:if("object"!==N(R)){t.next=36;break}return t.abrupt("return",R.v);case 36:t.next=29;break;case 38:t.next=43;break;case 40:t.prev=40,t.t1=t.catch(26),C.e(t.t1);case 43:return t.prev=43,C.f(),t.finish(43);case 46:if(D=[],F=[],E&&D.push({id:I.id,properties:v,quantity:z}),void 0===e.giftsWithPurchaseConfig){t.next=57;break}if(!((U=Object.keys(e.giftsWithPurchaseConfig).map((function(t){var n=Number(t),r=e.giftsWithPurchaseConfig[n],a=(o.find((function(e){var t=e.variant;return(null==t?void 0:t.id)===n}))||{}).product;return M({id:n,product:a},r)})).filter((function(e){var t;return!0===(null===(t=e.product)||void 0===t?void 0:t.gwp)}))).length>0&&k)){t.next=55;break}return t.next=54,g.W.retrieveCart();case 54:s=t.sent;case 55:V=O(U);try{for(V.s();!(H=V.n()).done;){G=H.value,q=!1,K=O(s.items);try{for(K.s();!(Z=K.n()).done;)(Q=Z.value).id===G.id&&Q.properties._showId===p.showId&&(q?F.push({id:Q.key,quantity:0}):(Q.quantity!==G.quantity&&F.push({id:Q.key,quantity:G.quantity}),q=!0))}catch(e){K.e(e)}finally{K.f()}!q&&(G.allowAfterLive||p.isLive&&"watching"===p.location)&&D.push({id:G.id,quantity:G.quantity,properties:{_showId:p.showId,_gwp:!0}})}}catch(e){V.e(e)}finally{V.f()}case 57:if(Y=!1,!(D.length>0)){t.next=67;break}return t.next=61,L(g.W.addToCart,D);case 61:if("string"!=typeof(J=t.sent)){t.next=66;break}return x({cart:s}),w(J),t.abrupt("return");case 66:Y=!0;case 67:$=0,ee=F;case 68:if(!($<ee.length)){t.next=82;break}return te=ee[$],t.next=72,L(g.W.changeCart,te);case 72:if("string"!=typeof(re=t.sent)){t.next=77;break}return x({cart:s}),w(re),t.abrupt("return");case 77:s=re,Y=!1;case 79:$++,t.next=68;break;case 82:x({cart:s}),Y&&j(!0),y();case 85:case"end":return t.stop()}}),t,null,[[26,40,43,46]])})));return function(e){return t.apply(this,arguments)}}(),[I,T,x,h,l,z,j,null==c?void 0:c.discounts,e.refreshDiscount,X,e.showMiniCartOnAddToBag,e.giftsWithPurchaseConfig,a.preOrderCartNoteKey,o]),de=(0,r.useCallback)(F(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le(!1);case 2:case"end":return e.stop()}}),e)}))),[le]),pe=(0,r.useCallback)(F(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le(!0);case 2:case"end":return e.stop()}}),e)}))),[le]),ve=(0,r.useCallback)(F(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le(!1,!0);case 2:case"end":return e.stop()}}),e)}))),[le]),me=f(document.data.currency.isoCode,I.compareAtPriceCents),fe=V(h,I,c),he=function(e){Y((function(t){return t+e>0?t+e:0}))},ge=(0,r.useRef)(!0),be=(0,r.useRef)(!0),ye=K&&h.name,we=K||void 0!==e.onBackClick,_e=K||void 0===e.onBackClick?function(){return Z(!1)}:e.onBackClick,Ee=we||!1!==ye,ke=void 0===T||ae||te||se,Ie=ke||!ce,Ce=ke,Se=null===(t=h.details)||void 0===t?void 0:t.some((function(e){return e.html.trim().length>0})),Ne=(0,S.gl)(),Ae=Se&&r.createElement("div",{className:"liveshopping-product-details__wrapper"},r.createElement(w.BA,{className:"liveshopping-product-details__content",canClick:ge,vertical:!0},null===(n=h.details)||void 0===n?void 0:n.map((function(e,t){return r.createElement("div",{className:"liveshopping-product-details__entry",key:t},r.createElement(r.Fragment,null,(0,u.ZP)(e.html)))}))));return r.createElement("div",{className:"liveshopping-product__wrapper"},r.createElement("div",{className:"liveshopping-product".concat(e.isReminder&&K?" liveshopping-product-reminder-details":"")},Ee&&r.createElement("div",{className:"".concat(K?"liveshopping-product-details__header":"liveshopping-product-info__header")},we&&r.createElement("div",{className:"liveshopping-product__back",onClick:_e},r.createElement(v.M,{src:y,alt:(0,m.Iu)("shop.product.hide_product_details")}),r.createElement("p",null,(0,m.Iu)("shop.product.hide_product_details"))),ye&&r.createElement("h2",{className:"liveshopping-product-details__header-text"},h.name)),K?Ae:r.createElement(r.Fragment,null,I.img?r.createElement("div",{className:"liveshopping-product__inner"},r.createElement(v.M,{className:"liveshopping-product__image",src:I.img.src,alt:I.img.alt})):null,r.createElement("h2",{className:"liveshopping-product__header"},h.name),Se&&(!Ne||e.isReminder)&&r.createElement("button",{type:"button",className:"bl-core-button--link liveshopping-product-button-show-product-details",onClick:function(){return Z(!0)}},(0,m.Iu)("shop.product.show_product_details")),r.createElement("div",{className:"liveshopping-product__price-wrapper"},r.createElement("div",{className:"liveshopping-product__price".concat(fe?" liveshopping-product__price--overridden":"")},me),fe&&r.createElement("div",{className:"liveshopping-product__discount-price"},fe)),Ne&&!e.isReminder&&Ae),void 0!==h.bundleItems&&void 0!==X?r.createElement("div",{className:"liveshopping-product__bundle-wrapper"},r.createElement(w.BA,{className:"liveshopping-product__bundle-content",canClick:be,vertical:!0},h.bundleItems.map((function(e,t){var n=e.variants,a=X[t];return r.createElement("div",{className:"liveshopping-product__bundle-product-wrapper",key:t},a.img?r.createElement("div",{className:"liveshopping-product__inner"},r.createElement(v.M,{className:"liveshopping-product__image",src:a.img.src,alt:a.img.alt})):null,r.createElement("div",{className:"liveshopping-product__bundle-product-options-wrapper"},r.createElement("h2",{className:"liveshopping-product__header"},e.name),n.length>1?r.createElement(G,{variants:e.variants,variant:a,onChange:function(n){$((function(r){return r[t]=e.variants.find((function(e){return e.id===n.id})),r}))}}):r.createElement(r.Fragment,null,"Default Title"!==e.variants[0].name?r.createElement("div",{className:"liveshopping-product__variant-details-wrapper"},e.variants[0].swatch?r.createElement("div",{className:"liveshopping-product__variant-swatch",style:{backgroundColor:e.variants[0].color,backgroundImage:"url('".concat(e.variants[0].swatch,"')")}}):null,r.createElement("div",{className:"liveshopping-product__variant-names-wrapper"},r.createElement("div",{className:"liveshopping-product__variant-name"},e.variants[0].name),e.variants[0].secondaryName?r.createElement("div",{className:"liveshopping-product__variant-secondary-name"},e.variants[0].secondaryName):null)):null),ue.has(a.id)?r.createElement(r.Fragment,null,r.createElement("span",{className:"liveshopping-product__bundle-product-out-of-stock-notice"},(0,m.Iu)("shop.product.out_of_stock"))):null))})))):null),!0!==h.gwp&&0!==I.priceCents?r.createElement("form",{className:"liveshopping-product__form"},r.createElement("div",{className:"liveshopping-product__form-qty-variant-wrapper"},r.createElement("div",{className:"liveshopping-product__quantity-wrapper"},r.createElement("button",{type:"button",className:"liveshopping-product__quantity liveshopping-product__change-quantity",disabled:z<=1,onClick:function(){return z>1&&he(-1)}},"-"),r.createElement("div",{className:"liveshopping-product__quantity"},z),r.createElement("button",{type:"button",className:"liveshopping-product__quantity liveshopping-product__change-quantity",onClick:function(){return he(1)}},"+")),h.variants.length>1&&r.createElement(G,{variants:h.variants,variant:I,onChange:A})),H&&r.createElement("div",{className:"liveshopping-product__add-to-bag-error"},H),r.createElement("div",{className:"liveshopping-product__button-list"},ce||I.currentlyNotInStock&&!I.preOrderWhenOutOfStock?r.createElement(r.Fragment,null,r.createElement("button",{type:"button",className:"bl-core-button",onClick:de,disabled:Ie},(0,m.Iu)("shop.product.add_to_bag")),I&&r.createElement("button",{type:"button",className:"bl-core-button bl-core-button--cta",onClick:pe,disabled:Ie},(0,m.Iu)("shop.product.buy_now"))):r.createElement(r.Fragment,null,I.preOrderWhenOutOfStock&&I.currentlyNotInStock?r.createElement(r.Fragment,null,I.preOrderProductNote&&r.createElement("div",{className:"liveshopping-product__preorder-note"},I.preOrderProductNote),r.createElement("button",{type:"button",className:"bl-core-button bl-core-button--cta",onClick:ve,disabled:Ce},(0,m.Iu)("shop.product.pre_order_now"))):r.createElement("button",{type:"button",className:"bl-core-button liveshopping-product-button--out-of-stock",disabled:!0},(0,m.Iu)("shop.product.out_of_stock"))))):null)}function G(e){var t=e.variants,n=e.variant,a=e.onChange,i=P((0,r.useState)(!1),2),o=i[0],s=i[1],c=(0,E.L)(),u=(0,r.useRef)(null),l=function(e){u.current&&(u.current.scrollTop=0),s(e)};(0,r.useEffect)((function(){var e=function(){l(!1)};if(o)return document.body.addEventListener("click",e),function(){document.body.removeEventListener("click",e)}}),[o]);var d=function(e){var n=t.find((function(t){return t.id===e}));n&&a(n)},p=function(e){var t=e.currentTarget.getAttribute("data-variantid"),n=Number(t);d(n),l(!1)};return 0===t.length?null:c.renderCustomVariantDropdown?r.createElement("div",{className:"liveshopping-variant-dropdown__wrapper"},o?r.createElement("div",{className:"liveshopping-variant-dropdown__body",ref:u},t.map((function(e,t){return r.createElement("div",{className:"liveshopping-variant-dropdown__item  ".concat(e.id===n.id?"liveshopping-variant-dropdown__item--selected":""),onClick:p,key:t,"data-variantid":e.id},e.swatch&&r.createElement("div",{className:"liveshopping-variant-dropdown__swatch",style:{backgroundColor:e.color,backgroundImage:"url('".concat(e.swatch,"')")}}),r.createElement("div",{className:"liveshopping-variant-dropdown__description"},r.createElement("div",{className:"liveshopping-variant-dropdown__name"},e.name),e.secondaryName&&r.createElement("div",{className:"liveshopping-variant-dropdown__secondary"},e.secondaryName)))}))):r.createElement("div",{className:"liveshopping-variant-dropdown__item liveshopping-variant-dropdown__item--closed",onClick:function(e){l(!0)}},n.swatch&&r.createElement("div",{className:"liveshopping-variant-dropdown__swatch",style:{backgroundColor:n.color,backgroundImage:"url('".concat(n.swatch,"')")}}),r.createElement("div",{className:"liveshopping-variant-dropdown__description ".concat(n.swatch?"":"liveshopping-variant-dropdown__description--no-swatch")},r.createElement("div",{className:"liveshopping-variant-dropdown__name"},n.name),n.secondaryName&&r.createElement("div",{className:"liveshopping-variant-dropdown__secondary"},n.secondaryName)),r.createElement(v.M,{className:"liveshopping-variant-dropdown__arrow liveshopping-variant-dropdown__arrow--down",src:y,alt:(0,m.Iu)("shop.product.show_variants")}))):r.createElement("select",{className:"liveshopping-product__variant-dropdown",name:"variant",id:"variant",onChange:function(e){var t=Number(e.target.value);d(t)}},t.map((function(e){return r.createElement("option",{key:e.id,value:e.id},e.name)})))}n(17727);var W=n(93970),q=n(81316);function K(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Z(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Z(i,r,a,o,s,"next",e)}function s(e){Z(i,r,a,o,s,"throw",e)}o(void 0)}))}}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||Y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function X(e){var t=z((0,r.useState)(null),2),n=t[0],a=t[1],i=(0,b.jD)(),o=i.cartResult,s=i.setCartResult;C();var c=(0,W.XM)();function u(){return(u=Q(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.onDone();case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(e){return d.apply(this,arguments)}function d(){return(d=Q(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.W.changeCart(n).then((function(t){c.current&&("string"==typeof t?a(t):(s({cart:t}),e.onChangeBag()))})).catch((function(e){h.Z.instance.report(e),c.current&&a((0,m.Iu)("shop.bag.retrieval_error"))}));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}(0,r.useEffect)((function(){o.error&&a((0,m.Iu)("shop.bag.retrieval_error"))}),[o]),(0,r.useEffect)((function(){if(n){var e=setTimeout((function(){a(null)}),7e3);return function(){return clearTimeout(e)}}}),[n]);var p=window.GEP&&window.GEP.isOperatedByGlobale?"/pages/globalECheckout":"/checkout",v=o.cart,y=v?f(v.currency,v.items_subtotal_price):"",w="bl-core-button bl-core-button--cta bl-core-button--cta-checkout bl-core-anchor--fake-button";return(void 0===v||v.items.length<1)&&(w+=" bl-core-button--disabled"),r.createElement("div",{className:"liveshopping-live-bag__wrapper"},v&&r.createElement("div",{className:"liveshopping-live-bag"},v.items.map((function(t,n){return r.createElement(r.Fragment,{key:t.key},r.createElement($,{currency:v.currency,item:t,show:e.show,handleChange:l}))}))),v&&v.items&&v.items.length>1&&r.createElement(r.Fragment,null,r.createElement("div",{className:"liveshopping-live-bag__subtotal"},r.createElement("h2",{className:"liveshopping-live-bag__subtotal-label"},(0,m.Iu)("shop.bag.subtotal")),r.createElement("h2",{className:"liveshopping-live-bag__subtotal-value"},y))),r.createElement("a",{className:w,onClick:function(){return u.apply(this,arguments)},href:p,target:"_blank",rel:"opener","data-disable-recharge":!0},(0,m.Iu)("shop.bag.go_to_checkout")),r.createElement("div",{className:"liveshopping-live-bag__add-to-bag-error"},n))}function $(e){var t=(0,E.L)();C();var n=t.preOrderCartNoteKey,a=e.currency,i=e.item,o=i.properties&&n?i.properties[n]:void 0,s=z((0,r.useState)(!1),2),c=s[0],u=s[1];function l(t){u(!0);var n={id:i.key,quantity:i.quantity+t};e.handleChange(n).finally((function(){u(!1)}))}var d=e.show.products.find((function(t,n){return e.show.variants[n]===e.item.id})),p=(0,q.Zb)(d,e.item.id),m=p.loading,h=p.product,g=p.variant,b=i.price,y=(i.original_line_price,[]);if(!m&&h&&g&&((b=g.compareAtPriceCents)*i.quantity,void 0!==h.bundleItems)){var w=JSON.parse(i.properties.bundle_product);if(w){var _,k=K(w);try{for(k.s();!(_=k.n()).done;){var I,S=_.value.variant,N=K(h.bundleItems);try{e:for(N.s();!(I=N.n()).done;){var A,M=I.value,R=K(M.variants);try{for(R.s();!(A=R.n()).done;){var O=A.value;if(O.id===S){y.push({product:M,variant:O});break e}}}catch(e){R.e(e)}finally{R.f()}}}catch(e){N.e(e)}finally{N.f()}}}catch(e){k.e(e)}finally{k.f()}}}return r.createElement("div",{className:"liveshopping-live-bag__product"},r.createElement("div",{className:"liveshopping-live-bag__product-overview"},r.createElement(v.M,{className:"liveshopping-live-bag__product-image",src:i.featured_image.url,alt:i.featured_image.alt}),r.createElement("div",{className:"liveshopping-live-bag__product-inner"},r.createElement("h2",{className:"liveshopping-live-bag__product-inner-title"},i.product_title),r.createElement("p",{className:"liveshopping-live-bag__product-inner-option"},i.options_with_values.map((function(e,t,n){return(i.options_with_values.length>1||"Default Title"!==e.value)&&r.createElement(r.Fragment,{key:t},e.value,t<n.length-1&&", ")}))),o&&r.createElement("div",{className:"liveshopping-live-bag__variant-preorder-note"},o),r.createElement("div",{className:"liveshopping-live-bag__variant-priceline"},b===i.discounted_price?r.createElement("div",{className:"liveshopping-live-bag__variant-price"},f(a,b)):r.createElement(r.Fragment,null,r.createElement("div",{className:"liveshopping-live-bag__variant-price-wrapper"},r.createElement("div",{className:"liveshopping-live-bag__variant-price liveshopping-live-bag__variant-price--discounted"},f(a,i.discounted_price)),r.createElement("div",{className:"liveshopping-live-bag__variant-price liveshopping-product__price--overridden"},f(a,b)))),0!==i.discounted_price&&0!==i.price?r.createElement("div",{className:"liveshopping-live-bag__quantity-wrapper"},r.createElement("button",{type:"button",className:"liveshopping-live-bag__quantity liveshopping-live-bag__change-quantity",disabled:0===i.quantity||c,onClick:function(){return l(-1)}},"-"),r.createElement("div",{className:"liveshopping-live-bag__quantity"},i.quantity),r.createElement("button",{type:"button",className:"liveshopping-live-bag__quantity liveshopping-live-bag__change-quantity",disabled:c,onClick:function(){return l(1)}},"+")):null,!1))),y.length>0?r.createElement("div",{className:"liveshopping-live-bag__bundle-wrapper"},y.map((function(e,t){return r.createElement("div",{className:"liveshopping-live-bag__bundle-item",key:t},e.variant.img?r.createElement(v.M,{className:"liveshopping-live-bag__product-image",src:e.variant.img.src,alt:e.variant.img.alt}):null,r.createElement("h2",{className:"liveshopping-live-bag__product-inner-title"},e.product.name),r.createElement(r.Fragment,null,"Default Title"!==e.variant.name?r.createElement("div",{className:"liveshopping-live-bag__product-inner-option"},e.variant.name):null))}))):null)}n(72443),n(51532),n(40561),n(70189),n(38559),n(92222),n(27852),n(65069),n(15306),n(19601);var ee=n(18172),te=n(85518),ne=n(3093),re=n(58119),ae=n(88355);const ie=n.p+"35a28de1ada3dc2d4c7a2635fdf7c6a2.svg",oe=n.p+"d45578d0c12650675ac30113c59125e1.svg";var se=n(34994);const ce=n.p+"279bcae60d2b9415f1aea31d123e7cce.svg",ue=n.p+"2c761e8b69db0de5f4ce4ea074e92dd9.svg",le=n.p+"c5f1355d4d3c77ee867bc0def8c2ef22.svg",de=n.p+"6f77adf012f2e92114ce8f97b088e589.svg",pe=n.p+"bc11a79df1c1734e787fb00a979079ff.svg";n(68304),n(30489),n(12419);var ve=n(63204),me=n(81718),fe=n(30793),he=n(2832),ge=n(62125),be=n(13978);function ye(e){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function we(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function _e(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){we(i,r,a,o,s,"next",e)}function s(e){we(i,r,a,o,s,"throw",e)}o(void 0)}))}}function Ee(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Me(e);if(t){var a=Me(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Ne(this,n)}}function Ne(e,t){return!t||"object"!==ye(t)&&"function"!=typeof t?Ae(e):t}function Ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e){var t,n;function r(t,n){try{var i=e[t](n),o=i.value,s=o instanceof Pe;Promise.resolve(s?o.wrapped:o).then((function(e){s?r("return"===t?"return":"next",e):a(i.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise((function(i,o){var s={key:e,arg:a,resolve:i,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function Pe(e){this.wrapped=e}"function"==typeof Symbol&&Symbol.asyncIterator&&(Oe.prototype[Symbol.asyncIterator]=function(){return this}),Oe.prototype.next=function(e){return this._invoke("next",e)},Oe.prototype.throw=function(e){return this._invoke("throw",e)},Oe.prototype.return=function(e){return this._invoke("return",e)};var Te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(u,e);var t,n,r,a,i,o,s,c=Se(u);function u(e,t,n,r,a){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Re(Ae(i=c.call(this)),"showId",void 0),Re(Ae(i),"joinShowResponse",void 0),Re(Ae(i),"credentialsResponse",void 0),Re(Ae(i),"chime",void 0),Re(Ae(i),"messagingSession",void 0),i.showId=e,i.joinShowResponse=t,i.credentialsResponse=n,i.chime=r,i.messagingSession=a,a.addObserver(Ae(i)),i}return t=u,n=[{key:"messagingSessionDidStart",value:function(){this.dispatchEvent(new Event("didStart"))}},{key:"messagingSessionDidStop",value:function(e){this.dispatchEvent(e)}},{key:"messagingSessionDidStartConnecting",value:function(e){this.dispatchEvent(new l.$q(e))}},{key:"messagingSessionDidReceiveMessage",value:function(e){var t=e.type;switch(t){case"CREATE_CHANNEL_MESSAGE":case"REDACT_CHANNEL_MESSAGE":case"UPDATE_CHANNEL_MESSAGE":case"DELETE_CHANNEL_MESSAGE":var n,r=JSON.parse(e.payload,(function(e,t){return e.endsWith("Timestamp")&&t?new Date(t):t}));if(r.ChannelArn===this.joinShowResponse.mainChannelArn)n="main";else{if(!this.joinShowResponse.adminChannelArn||r.ChannelArn!==this.joinShowResponse.adminChannelArn)return;n="admin"}var a=u.convertBasedOnMetadata(t,r);if(!a)return void console.warn("Got message without metadata: ",e);this.dispatchEvent(new l.XA(a.type,n,t,r,a.metadata));break;default:console.log("Ignored message: ",e)}}},{key:"start",value:function(){this.messagingSession.start()}},{key:"stop",value:function(){this.messagingSession.stop()}},{key:"getRecentMessages",value:function(e){var t,n=this;return(t=regeneratorRuntime.mark((function t(){var r,a,i,o,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=void 0;case 1:return t.next=4,new Pe(n.chime.send(new fe.k({ChannelArn:n.joinShowResponse.mainChannelArn,MaxResults:e,NextToken:r&&r.NextToken,ChimeBearer:n.credentialsResponse.userArn})));case 4:if(r=t.sent,!(a=r.ChannelMessages)){t.next=28;break}i=Ee(a),t.prev=8,i.s();case 10:if((o=i.n()).done){t.next=18;break}if(s=o.value,!(c=u.createChimeMessageSummary(s))){t.next=16;break}return t.next=16,c;case 16:t.next=10;break;case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(8),i.e(t.t0);case 23:return t.prev=23,i.f(),t.finish(23);case 26:if(a.length!==e){t.next=28;break}return t.abrupt("continue",1);case 28:return t.abrupt("break",31);case 31:case"end":return t.stop()}}),t,null,[[8,20,23,26]])})),function(){return new Oe(t.apply(this,arguments))})()}},{key:"redactMessage",value:(s=_e(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chime.send(new he.i({ChannelArn:this.joinShowResponse.mainChannelArn,MessageId:t,ChimeBearer:this.credentialsResponse.userArn}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"sendMessage",value:(o=_e(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.sO.sendChatMessage(t,this.showId,{messageContent:n,replyToMessageId:r});case 2:return e.abrupt("return",e.sent.messageId);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"updateMessage",value:(i=_e(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.sO.updateChatMessage(t,this.showId,n,{messageContent:r});case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"userArn",get:function(){return this.credentialsResponse.userArn}}],r=[{key:"createChimeMessageSummary",value:function(e){var t=u.convertBasedOnMetadata("SUMMARY",e);if(t)return{type:t.type,message:e,metadata:t.metadata};console.warn("Got message summary without metadata: ",e)}},{key:"convertBasedOnMetadata",value:function(e,t){var n,r;if(t.Metadata)r=(n=JSON.parse(t.Metadata)).type.toLowerCase().replace(/[-_][a-z0-9]/g,(function(e){return e.slice(-1).toUpperCase()}));else{if("REDACT_CHANNEL_MESSAGE"!==e&&"DELETE_CHANNEL_MESSAGE"!==e&&!t.Redacted)return;n="redactDelete",r="redactDelete"}return{type:r,metadata:n}}},{key:"getLiveShowSession",value:(a=_e(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,c,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.sO.getChatCredentials(t),e.next=3,l.sO.joinChat(t,n,r);case 3:return i=e.sent,e.next=6,a;case 6:return o=e.sent,s=new ge.b({credentials:{accessKeyId:o.credentials.accessKeyId,secretAccessKey:o.credentials.secretAccessKey,sessionToken:o.credentials.sessionToken,expiration:new Date(o.credentials.expiration)},region:"us-east-1"}),e.next=10,s.send(new be.F({}));case 10:return c=e.sent,d=new ve.kwN("Chime",ve.ini.INFO),p=new ve.J6(new ve.iyk(o.userArn,null,c.Endpoint.Url,s),d),e.abrupt("return",new u(n,i,o,s,p));case 14:case"end":return e.stop()}}),e)}))),function(e,t,n){return a.apply(this,arguments)})}],n&&Ie(t.prototype,n),r&&Ie(t,r),u}(me.Z),xe=n(51163),De=n(2138),Fe=n.n(De),Le=n(62783);function je(){return(je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Be(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ge(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Ue(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Ve(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Ue(i,r,a,o,s,"next",e)}function s(e){Ue(i,r,a,o,s,"throw",e)}o(void 0)}))}}function He(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||Ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ge(e,t){if(e){if("string"==typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(e,t):void 0}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qe(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}var Ke=100;function Ze(e){var t,n,a=e.user,i=e.myProfile,o=e.show,c=e.referralCode,u=e.buttonsToLeftOfChatInput,d=e.buttonsToRightOfChatInput,p=e.setShowMayHaveEnded,f=e.setViewerCountFromChat,h=e.chatSessionCloseCount,g=e.onChatSessionClosed,b=e.onSomeonePurchased,y=e.setFeaturedItemFromChat,w=e.playbackControl,_=e.playbackWrapper,E=e.onKeyboardChange,k=e.chatInputRef,I=e.scrubbing,C=e.variantsAndProducts,N=(0,W.XM)(),A=He((0,r.useState)(null),2),M=A[0],R=A[1],O=He((0,W.KS)(0),2),P=O[0],T=O[1];(0,r.useEffect)((function(){"RUNNING"===o.state?M||P||(T(5e3),Te.getLiveShowSession(a,o.id,{referralCode:c}).then((function(e){N.current&&(R(e),p(!1))})).catch((function(e){var t,n;console.error(e),"NOT_A_RUNNING_SHOW"===(null===(t=l.sO.getValidationErrorResponse(e))||void 0===t||null===(n=t.showId[0])||void 0===n?void 0:n.errorCode)&&p(!0)}))):M&&R(null)}),[N,c,M,P,T,p,o.id,o.state,a]);var x=He((0,r.useState)(""),2),D=x[0],F=x[1],L=He((0,s.x)([]),2),j=L[0],B=L[1],U=(0,xe.Pr)((function(){var e;return null!==(e=o.pinnedChatMessage)&&void 0!==e&&e.metadata.messageId?{type:"pinnedChat",message:{MessageId:o.pinnedChatMessage.messageId,Content:o.pinnedChatMessage.content},metadata:o.pinnedChatMessage.metadata}:null}),[o]),V=tn(o,h,(function(){return U})),H=V.value,G=V.setValueFromChat,q=null!==a&&o.handle===(null===(t=i.influencer)||void 0===t?void 0:t.handle),K=null!=a&&l.sO.isModerator(a),Z=l.sO.MAX_CHAT_MESSAGE_LENGTH_NORMAL;q?Z=l.sO.MAX_CHAT_MESSAGE_LENGTH_OWNER:K&&(Z=l.sO.MAX_CHAT_MESSAGE_LENGTH_MODERATOR);var Q=He((0,s.x)(new Map),2),z=Q[0],Y=Q[1],J=(0,r.useRef)(0),X=He((0,s.x)(null),2),$=X[0],ne=X[1],ie=He((0,s.x)([]),2),oe=ie[0],se=ie[1],ce=(0,r.useCallback)((function(){return se((function(e){e.forEach((function(e){return e()})),e.length=0}))}),[se]);(0,r.useEffect)((function(){!$&&oe&&ce()}),[oe,ce,$,se]);var le=(0,r.useCallback)((function(e,t){ce(),ne((function(n){return t?e:n&&(0,ee.Js)(n)===e?null:void 0}))}),[ce,ne]),de=(0,r.useCallback)((function(e){se((function(t){t.push(e)}))}),[se]),pe=He((0,r.useState)(void 0),2),ve=pe[0],me=pe[1];(0,r.useEffect)((function(){de((function(){me(null!=H&&H.metadata.messageId?{event:H,outOfQuarantine:!0}:null)}))}),[de,H]);var fe=(0,r.useCallback)((function(e){return de((function(){return B((function(t){var n=t.find((function(t){return(0,ee.Js)(t)===e}));if(n&&!n.outOfQuarantine){n.outOfQuarantine=!0;for(var r=0,i=t.length;i>0&&r<Ke;)tt(t[--i],a,M)&&r++;t.splice(0,i)}}))}))}),[de,M,B,a]),he=He((0,s.x)({mutedUsers:new Set,changingUsers:new Set}),2),ge=he[0],be=he[1],ye=(0,r.useCallback)((function(e){return N.current&&be(e)}),[N,be]),we=(0,r.useCallback)((function(e){B((function(t){if(t.some((function(t){return e.message.MessageId===t.event.message.MessageId})))de((function(){return B((function(t){var n,r,a=t.find((function(t){return e.message.MessageId===t.event.message.MessageId}));a&&((null!==(n=e.message.LastUpdatedTimestamp)&&void 0!==n?n:0)>(null!==(r=a.event.message.LastUpdatedTimestamp)&&void 0!==r?r:0)&&(a.event=e))}))}));else{var n=e.message.CreatedTimestamp;if(n){var r=t.findIndex((function(e){var t=e.event.message.CreatedTimestamp;return t&&n<t}));if(r>=0)return void t.splice(r,0,{event:e,outOfQuarantine:!1})}t.push({event:e,outOfQuarantine:!1})}}))}),[de,B]);(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("chat",(function(e){switch(e.eventType){case"CREATE_CHANNEL_MESSAGE":case"UPDATE_CHANNEL_MESSAGE":we(e);break;default:console.error("Unhandled message ".concat(e.eventType))}}))}),[we,M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("pinnedChat",(function(e){console.log("pinnedChat",e),G(e,e.message)}))}),[M,G]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("redactDelete",we)}),[we,M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("close",(function(e){console.log("close",e),g()}))}),[g,M]);var _e=(0,W.KJ)(h),Ee=(0,r.useCallback)((function(e,t){if(void 0!==e)switch(e.type){case"VARIANT":C.some((function(t){var n=t.variant;return(null==n?void 0:n.id)===e.variantId}))&&y(e,t);break;case"LINK":var n;null!==(n=document.data.liveshoppingLinks)&&void 0!==n&&n.find((function(t){return t.url===e.link}))&&y(e,t)}else y(void 0,t)}),[y,C]);(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("didStart",function(){var e=Ve(regeneratorRuntime.mark((function e(t){var n,r,i,s,c,u,l,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("didStart",t),n=0,r=!0,i=!1,e.prev=4,c=qe(null==M?void 0:M.getRecentMessages(10));case 6:return e.next=8,c.next();case 8:return u=e.sent,r=u.done,e.next=12,u.value;case 12:if(l=e.sent,r){e.next=38;break}if(d=l,N.current){e.next=17;break}return e.abrupt("break",38);case 17:if(_e.current===h){e.next=19;break}return e.abrupt("break",38);case 19:e.t0=d.type,e.next="chat"===e.t0||"redactDelete"===e.t0?22:"activeVariant"===e.t0?27:"featuredItem"===e.t0?29:"pinnedChat"===e.t0?31:"viewerCount"===e.t0?33:35;break;case 22:if(we(d),!et(d,a,M,!0)){e.next=26;break}if(!(++n>=Ke)){e.next=26;break}return e.abrupt("return");case 26:return e.abrupt("break",35);case 27:return-1!==o.variants.indexOf(d.metadata.variantId)&&(p={type:"VARIANT",variantId:d.metadata.variantId},y(p,d.message)),e.abrupt("break",35);case 29:return Ee(d.metadata.item,d.message),e.abrupt("break",35);case 31:return G(d,d.message),e.abrupt("break",35);case 33:return f(d.metadata.viewerCount,d.message),e.abrupt("break",35);case 35:r=!0,e.next=6;break;case 38:e.next=44;break;case 40:e.prev=40,e.t1=e.catch(4),i=!0,s=e.t1;case 44:if(e.prev=44,e.prev=45,r||null==c.return){e.next=49;break}return e.next=49,c.return();case 49:if(e.prev=49,!i){e.next=52;break}throw s;case 52:return e.finish(49);case 53:return e.finish(44);case 54:case"end":return e.stop()}}),e,null,[[4,40,44,54],[45,,49,53]])})));return function(t){return e.apply(this,arguments)}}())}),[h,_e,we,N,M,G,Ee,y,f,a,o.variants]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("didStartConnecting",(function(e){return console.log("didStartConnecting",e)}))}),[M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("endShow",(function(){return p(!0)}))}),[p,M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("purchase",b)}),[b,M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("activeVariant",(function(e){if(-1!==o.variants.indexOf(e.metadata.variantId)){var t={type:"VARIANT",variantId:e.metadata.variantId};y(t,e.message)}}))}),[M,y,o.variants]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("featuredItem",(function(e){Ee(e.metadata.item,e.message)}))}),[M,Ee]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("streamHealth",(function(e){return console.log("streamHealth",e)}))}),[M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("streamStarting",(function(e){return console.log("streamStarting",e)}))}),[M]),(0,r.useEffect)((function(){return null==M?void 0:M.addEventListenerAndReturnRemover("viewerCount",(function(e){return f(e.metadata.viewerCount,e.message)}))}),[M,f]),(0,r.useEffect)((function(){if(M)return M.start(),function(){M.stop(),R(null)}}),[M]);var ke=(0,r.useCallback)((function(e){Y((function(t){t.delete(e)}))}),[Y]),Ie=He((0,r.useState)(),2),Ce=Ie[0],Se=Ie[1],Ne=function(){return Se(void 0)},Ae=function(e){Se(e),e&&pt()},Me=(0,r.useCallback)((function(e,t,n){return!!M&&(M.sendMessage(a,t,null==n?void 0:n.messageId).then((function(){N.current&&ke(e)})).catch((function(t){console.error(t),N.current&&de((function(){return Y((function(n){n.get(e).error=t}))}))})),!0)}),[N,de,ke,M,Y,a]),Re=(0,r.useCallback)((function(e,t){var n=J.current++;return!!Me(n,e,t)&&(Y((function(r){r.set(n,{content:e,replyTo:t})})),!0)}),[Y,Me]),Oe=(0,r.useCallback)((function(e,t){Me(e,t.content,t.replyTo)&&Y((function(t){delete t.get(e).error}))}),[Y,Me]),Pe=He((0,r.useState)(0),2),De=Pe[0],Fe=Pe[1],Le=(0,r.useRef)(null),je=(0,r.useRef)(null),Be=(0,W.D9)(j),Ue=He((0,r.useState)(!0),2),Ge=Ue[0],We=Ue[1],Ze=(0,r.useRef)(Ge);(0,r.useEffect)((function(){Ze.current=Ge,Ge&&Ye()}),[j,Le,Ge,null===(n=Le.current)||void 0===n?void 0:n.clientHeight]);var ze=function(e){if(Le.current){var t=Le.current,n=t.scrollHeight,r=t.clientHeight,a=n===t.scrollTop+r;Ze.current&&!a&&e&&!I?We(!1):!Ze.current&&a&&We(!0)}};(0,r.useEffect)((function(){if(Ge)Fe(0);else{for(var e=null!=Be?Be:[],t=0,n=function(n){var r=j[n];if(r.outOfQuarantine){var a=e.find((function(e){return e.event.message.MessageId===r.event.message.MessageId}));if(a&&a.outOfQuarantine)return"break";++t}},r=j.length-1;r>=0;--r){if("break"===n(r))break}t>0&&Fe((function(e){return e+t}))}}),[j,Be,Ge]);var Ye=function(){je.current&&je.current.scrollIntoView({behavior:"smooth"})},Je=function(){ze(!0)},$e=He((0,r.useState)(!1),2),rt=$e[0],ot=$e[1],st=a&&i.influencer?i.influencer.handle?void 0:r.createElement(ae.Z,{wrapperClassName:"liveshopping-modal--onboard",setIsOpen:ot},r.createElement(re.kb,{user:a,myProfile:i,autofocus:!0})):i.displayName?void 0:r.createElement(ae.Z,{wrapperClassName:"liveshopping-modal--display-name",setIsOpen:ot,header:(0,m.Iu)("onboard.viewer.choose_display_name")},r.createElement(re.o0,{user:a,myProfile:i,altHeader:!1,autofocus:!0,withEmailOptin:!1,hideHeader:!0})),ct=!st,ut=He((0,r.useState)(!1),2),lt=ut[0],dt=ut[1],pt=function(){var e;return null===(e=document.querySelector(".liveshopping-live-bottom__chat-txt"))||void 0===e?void 0:e.focus()},vt=function(){Ge&&Ye()};(0,r.useEffect)((function(){var e=Le.current;function t(){e&&e.style.setProperty("--liveshopping-live-chat-offset",e.scrollTop+"px")}if(e)return e.addEventListener("scroll",t),function(){null==e||e.removeEventListener("scroll",t)}}),[Le]);var mt=He((0,r.useState)(!0),2),ft=mt[0],ht=mt[1],gt=(0,S.gl)();return r.createElement(r.Fragment,null,o.chatBaseUrl&&r.createElement(Xe,{chatBaseUrl:o.chatBaseUrl,playbackControl:w,setMessages:B,setViewerCountFromChat:f,setQueuedPinnedMessageFromChat:G,setFeaturedItemFromChatWithValidation:Ee,onSomeonePurchased:b,show:o}),gt?r.createElement("div",{className:"liveshopping-live__desktop-chat-buttons-wrapper"},r.createElement("div",{className:"liveshopping-live-chat__desktop-left-buttons"},u),r.createElement("div",{className:"liveshopping-live-chat__desktop-right-buttons"},d)):null,r.createElement("div",{className:"liveshopping-live__bottom".concat(lt&&ct&&te.tq?" liveshopping-live__bottom-focused":"")},gt?r.createElement("h1",{className:"liveshopping-live-chat-panel__header"},(0,m.Iu)("livestream.watch.chat.title")):null,j.length>0&&!gt?r.createElement("div",{className:"liveshopping-live-chat-panel__toggle".concat(ft?"":" liveshopping-live-chat-panel__toggle--hidden"),onClick:function(){return ht(!ft)}},(0,m.Iu)("livestream.watch.chat.toggle")):null,r.createElement("div",{ref:Le,className:"liveshopping-live-chat-panel".concat(ft?"":" liveshopping-live-chat-panel--hidden"),onScroll:function(){ze(!1)},onTouchMove:Je,onWheel:Je},j.map((function(e){return!e.event.message.Redacted&&"redactDelete"!==e.event.metadata&&r.createElement(nt,{key:e.event.message.MessageId,message:e,metadata:e.event.metadata,user:a,iAmShowOwner:q,show:o,session:M,setChatMessageOutOfQuarantine:fe,isMessageWithButtons:$===e,isPinnedMessage:!1,setAsMessageWithButtonsAndDrainChatChanges:le,muteSets:ge,setMuteSetsIfMounted:ye,setReplyToAndIfSetFocusChat:Ae,showButtons:void 0===o.chatBaseUrl,onAnimationEnd:vt})})),r.createElement("div",{ref:je,className:"liveshopping-live-chat-panel__bottom"}),Array.from(z,(function(e){var t=He(e,2),n=t[0],a=t[1];return r.createElement(at,{key:n,id:n,pendingMessage:a,resendChat:Oe,removePendingChat:ke,onAnimationEnd:vt})}))),De&&ft?r.createElement("div",{className:"liveshopping-live-chat-panel__new-messages-wrapper"},r.createElement("div",{onClick:function(){Ye(),We(!0)},className:"liveshopping-live-chat-panel__new-messages"},(0,m.Iu)("livestream.watch.new_message",{count:De}))):null,ve&&r.createElement(nt,{key:ve.event.message.MessageId,message:ve,metadata:ve.event.metadata,user:a,iAmShowOwner:q,show:o,session:M,setChatMessageOutOfQuarantine:function(){},isMessageWithButtons:$===ve,isPinnedMessage:!0,setAsMessageWithButtonsAndDrainChatChanges:le,muteSets:ge,setMuteSetsIfMounted:ye,setReplyToAndIfSetFocusChat:Ae,showButtons:void 0===o.chatBaseUrl,onAnimationEnd:void 0}),_,Ce&&r.createElement("div",{className:"liveshopping-live-chat__reply-banner",onClick:pt},r.createElement(it,{content:Ce.content,metadata:Ce.metadata,isPending:!1,isPinned:!1}),r.createElement(v.M,{className:"liveshopping-live-chat__close-reply-banner",src:ue,alt:"Close",onClick:Ne})),r.createElement("div",{className:"liveshopping-live-chat-input-wrapper"},gt?null:r.createElement("div",{className:"liveshopping-live-chat__left-buttons"},u),r.createElement("div",{className:"liveshopping-live-bottom__chat"},"RUNNING"===o.state&&r.createElement(r.Fragment,null,gt?r.createElement(Qe,{onEmojiClick:function(e){var t=D+e;t.length<=Z&&F(t)}}):null,r.createElement("input",{className:"liveshopping-live-bottom__chat-txt  ".concat(gt?"liveshopping-live-bottom__chat-txt--desktop":""),enterKeyHint:"send",maxLength:Z,placeholder:Ce?(0,m.Iu)("livestream.watch.chat.reply_placeholder"):(0,m.Iu)("livestream.watch.chat.comment_placeholder"),tabIndex:1,isp_ignore:"",value:D,onChange:function(e){F(e.target.value),te.tq&&null!==e.target.selectionStart&&(e.target.selectionStart===e.target.value.length?e.target.scrollLeft=e.target.scrollWidth:" "===e.target.value[e.target.selectionStart-1]&&e.target.scrollWidth>e.target.offsetWidth&&(e.target.blur(),e.target.focus()))},readOnly:!ct,onClick:st?function(){return ot(!0)}:void 0,onKeyDown:function(e){var t=e.currentTarget,n=t.value.trim();("Backspace"===e.key&&!n&&!t.selectionStart||"Delete"===e.key&&!t.value)&&(Ne(),F(""))},onKeyPress:function(e){if("Enter"===e.key){var t=e.currentTarget.value.trim();t&&Re(t,Ce)&&(F(""),Ne())}},onFocus:function(){dt(!0),te.tq&&ct&&E(!0)},onBlur:function(){dt(!1),E(!1)},ref:k}),gt&&r.createElement("div",{className:"liveshopping-live-bottom__chat-character-count"},D.length," / ",Z)),rt&&st),gt?null:r.createElement("div",{className:"liveshopping-live-chat__right-buttons"},d))))}function Qe(e){var t=He((0,r.useState)(!1),2),n=t[0],a=t[1],i=(0,r.useRef)(null);return(0,Le.Bx)(i,(function(){return a(!1)})),r.createElement("div",{className:"liveshopping-live-chat__emoji-picker-wrapper",ref:i},r.createElement(v.M,{src:de,alt:"Emoji",className:"liveshopping-live-chat__emoji",onClick:function(){return a(!n)}}),n&&r.createElement(Fe(),{onEmojiClick:function(t,n){a(!1),e.onEmojiClick(n.emoji)}}))}function ze(e,t){var n=(0,W.KJ)(t);(0,r.useEffect)((function(){if(e){var t=new AbortController;return Ve(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.signal.aborted){r.next=25;break}return r.prev=1,r.next=4,fetch(e,{signal:t.signal});case 4:if(200!==(a=r.sent).status){r.next=12;break}return r.t0=n,r.next=9,a.json();case 9:return r.t1=r.sent,r.t0.current.call(r.t0,r.t1),r.abrupt("return");case 12:if(403!==a.status&&404!==a.status){r.next=15;break}return n.current(void 0),r.abrupt("return");case 15:console.error("Fetch failed with status",{url:e,response:a}),r.next=21;break;case 18:r.prev=18,r.t2=r.catch(1),"AbortError"!==r.t2.name&&console.error("Fetch failed with throw",{url:e,error:r.t2});case 21:return r.next=23,new Promise((function(e){return setTimeout(e,5e3)}));case 23:r.next=0;break;case 25:case"end":return r.stop()}}),r,null,[[1,18]])})))(),function(){return t.abort()}}}),[n,e])}function Ye(e,t){return Object.fromEntries(Object.entries(e).map(t))}function Je(e){return Ye(e,(function(e){var t=He(e,2),n=t[0],r=t[1],a="".concat(n[0].toUpperCase()).concat(n.slice(1));return a.endsWith("Timestamp")&&r&&(r=new Date(r)),[a,r]}))}function Xe(e){var t=e.chatBaseUrl,n=e.playbackControl,a=e.setMessages,i=e.setViewerCountFromChat,o=e.setQueuedPinnedMessageFromChat,c=e.setFeaturedItemFromChatWithValidation,u=e.onSomeonePurchased,l=(e.show,(0,se.kq)()),d=He((0,r.useState)(),2),p=d[0],v=d[1];ze("".concat(t,"/manifest.json"),(function(e){e?v(e):console.error("Failed to fetch chat manifest")}));var m=He((0,r.useState)(),2),f=m[0],h=m[1];ze("".concat(t,"/state.json"),(function(e){e&&(e=Ye(e,(function(e){var t=He(e,2);return[t[0],t[1].map(Je)]})),h(e))}));var g=sn(n.playbackState),b=He((0,s.x)(new Set),2),y=b[0],w=b[1],_=He((0,s.x)([]),2),E=_[0],k=_[1],I=0;function C(e){e&&(!I||e<I)&&(I=e)}var S=void 0;if(p)for(var N=function(e){var t=p.records[e],n=Date.parse(t.endTime);if(!y.has(e)){var r=Date.parse(t.startTime)-1e4;g<n&&(g>=r?w((function(t){t.add(e)})):C(r))}void 0===S&&g<n&&(S=e)},A=0;A<p.records.length;A++)N(A);var M=(0,W.zo)((function(){return{current:0}}),[S]),R=void 0===S?void 0:E[S];if(void 0!==R){for(var O,P,T;g>=(null!==(x=null===(D=R[M.current])||void 0===D||null===(F=D.CreatedTimestamp)||void 0===F?void 0:F.getTime())&&void 0!==x?x:1/0);){var x,D,F;M.current++}for(;g<(null!==(L=null===(j=R[M.current-1])||void 0===j||null===(B=j.CreatedTimestamp)||void 0===B?void 0:B.getTime())&&void 0!==L?L:0);){var L,j,B;M.current--}C(null!==(O=null===(P=R[M.current])||void 0===P||null===(T=P.CreatedTimestamp)||void 0===T?void 0:T.getTime())&&void 0!==O?O:0)}var U=M.current,V=He((0,r.useState)([]),2),H=V[0],G=V[1],q=(0,W.D9)(H);(0,r.useEffect)((function(){var e,t=q||[],n=Be(H);try{for(n.s();!(e=n.n()).done;){var r,a=e.value,i=!1,o=Be(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.message.MessageId===s.message.MessageId&&(i=!0)}}catch(e){o.e(e)}finally{o.f()}i||u(a)}}catch(e){n.e(e)}finally{n.f()}}),[H,u,q]),(0,r.useEffect)((function(){var e,t,n=[],r=[];if(void 0!==R){var o=S,s=R,c=U;e:for(;n.length<Ke||void 0===t;){for(;0===c;){if(0===o)break e;if(void 0===(s=E[--o]))if("break|visibleMessageLoop"===function(){var e=o;return y.has(o)||w((function(t){t.add(e)})),"break|visibleMessageLoop"}())break e;c=s.length}var u=s[--c],d=Te.createChimeMessageSummary(u);if(d)switch(d.type){case"chat":n.length<Ke&&et(d,l,null,!0)&&n.push({event:d,outOfQuarantine:!0});break;case"viewerCount":void 0===t&&(t=d.metadata.viewerCount);break;case"purchase":r.push(d)}}n.reverse()}a(n),i(null!==(e=t)&&void 0!==e?e:0,"on demand"),G(r)}),[E,R,S,U,y,a,w,i,l]);var K=(0,xe.Pr)((function(){return{PINNED_CHAT:{current:0},ACTIVE_VARIANT:{current:0},FEATURED_ITEM:{current:0}}}),[]);Object.entries(K).forEach((function(e){var t=He(e,2),n=t[0],r=t[1],a=null==f?void 0:f[n];if(a){for(var i,o,s,c=r;g>=(null!==(u=null===(l=a[c.current])||void 0===l||null===(d=l.CreatedTimestamp)||void 0===d?void 0:d.getTime())&&void 0!==u?u:1/0);){var u,l,d;c.current++}for(;g<(null!==(p=null===(v=a[c.current-1])||void 0===v||null===(m=v.CreatedTimestamp)||void 0===m?void 0:m.getTime())&&void 0!==p?p:0);){var p,v,m;c.current--}C(null!==(i=null===(o=a[c.current])||void 0===o||null===(s=o.CreatedTimestamp)||void 0===s?void 0:s.getTime())&&void 0!==i?i:0)}}));var Z=Ye(K,(function(e){var t,n=He(e,2),r=n[0],a=n[1];return[r,null==f||null===(t=f[r])||void 0===t?void 0:t[a.current-1]]}));return(0,r.useEffect)((function(){var e=Z.PINNED_CHAT,t=e&&Te.createChimeMessageSummary(e);o(null!=t?t:null,"on demand")}),[Z.PINNED_CHAT,o]),(0,r.useEffect)((function(){var e=Z.ACTIVE_VARIANT,t=e&&Te.createChimeMessageSummary(e),n=null==t?void 0:t.metadata.variantId;c(void 0!==n?{type:"VARIANT",variantId:n}:void 0,"on demand")}),[Z.ACTIVE_VARIANT,c]),(0,r.useEffect)((function(){var e=Z.FEATURED_ITEM,t=e&&Te.createChimeMessageSummary(e);if(void 0!==t){var n=t.metadata.item;c(n,"on demand")}else c(void 0,"on demand")}),[Z.FEATURED_ITEM,c]),cn(I,n),r.createElement(r.Fragment,null,Array.from(y,(function(e){return r.createElement($e,{key:e,chatBaseUrl:t,chatBlockIndex:e,onFetched:function(t){return k((function(n){n[e]=t}))}})})))}function $e(e){var t=e.chatBaseUrl,n=e.chatBlockIndex,r=e.onFetched;return ze("".concat(t,"/chat_").concat(n,".json"),(function(e){e?(e=e.map(Je),r(e)):(console.error("Missing chat block: ".concat(n)),r([]))})),null}function et(e,t,n,r){if("redactDelete"===e.metadata)return!1;var a=e.message.Sender,i=n&&a&&a.Arn===n.userArn;return!(e.metadata.isMuted&&!i)&&(!!(t&&l.sO.isModerator(t)||i)||r)}function tt(e,t,n){return et(e.event,t,n,e.outOfQuarantine)}function nt(e){var t=e.message,n=e.metadata,a=e.user,i=e.iAmShowOwner,o=e.show,s=e.session,c=e.setChatMessageOutOfQuarantine,u=e.isMessageWithButtons,d=e.isPinnedMessage,p=e.setAsMessageWithButtonsAndDrainChatChanges,v=e.muteSets,m=e.setMuteSetsIfMounted,f=e.setReplyToAndIfSetFocusChat,h=e.showButtons,g=e.onAnimationEnd,b=a&&l.sO.isModerator(a),y=t.event.message.Sender,w=s&&y&&y.Arn===s.userArn,_=b,E=b&&!n.isModerator&&"STREAMER"!==n.chatUserType&&!d,k=(b||w)&&!d,I=b,C=(_||E||k||I)&&h,N=et(t.event,a,s,t.outOfQuarantine||"quarantined"),A=He((0,W.KS)(!0===N?0:5e3),1)[0];(0,r.useEffect)((function(){(!0===N||"quarantined"===N&&!A)&&c(t)}),[t,A,c,N]);var M=3e3,R=He((0,W.KS)(0),2),O=R[0],P=R[1],T=O?{opacity:1}:{opacity:0,transition:"opacity ".concat(2e3,"ms ease-in")};(0,r.useEffect)((function(){if(u&&!O){var e=setTimeout((function(){return p(t,!1)}),2e3);return function(){return clearTimeout(e)}}}),[O,u,t,p]);var x=He((0,r.useState)(!1),2),D=x[0],F=x[1],L=(0,r.useRef)(!1);(0,r.useEffect)((function(){if(D)return P(M),p(t,!0),L.current=!0,function(){L.current=!1,p(t,!1)}}),[D,t,p,P]);var j=n.handle,B=n.displayName,U=null!=j?j:B&&"".concat(B.baseName,"/").concat(B.sequenceId),V=U&&v.mutedUsers.has(U),H=U&&v.changingUsers.has(U),G=V?H?"unmuting":"unmute":H?"muting":"mute",q=(0,S.gl)(),K=He((0,r.useState)(!1),2),Z=K[0],Q=K[1];return N&&t.outOfQuarantine?r.createElement(ot,{pinned:d,buttonMode:"overlaid",events:{onMouseEnter:C?function(){F(!0)}:void 0,onClick:C?function(){F(!0),P(M),p(t,!0)}:void 0,onMouseMove:C?function(){L.current&&(P(M),u||p(t,!0))}:void 0,onMouseLeave:C?function(){F(!1)}:void 0},body:r.createElement(it,{content:t.event.message.Content,metadata:n,isPending:!1,isPinned:d}),buttons:r.createElement(rt,{canDelete:Boolean(k),canMute:Boolean(E),canPin:Boolean(I),canReply:Boolean(_),iAmShowOwner:i,displayName:B,hoverEffectedRef:L,isMessageWithButtons:u,isMutedWouldUnmute:Boolean(V),isMutingOrUnmuting:Boolean(H),isPinnedMessage:Boolean(d),message:t,metadata:n,muteButtonState:G,session:s,setAsMessageWithButtonsAndDrainChatChanges:p,setHoverDetected:F,setMuteSetsIfMounted:m,setReplyToAndIfSetFocusChat:f,show:o,user:a,handle:j,mutedUserKey:U,isDesktop:q,setShowDesktopButtons:Q,showDesktopButtons:Z}),showButtons:u||q&&Z,showButtonsAbove:Z,buttonFadeStyle:q&&Z?void 0:T,replyTo:n.replyTo,onAnimationEnd:g}):null}function rt(e){var t=(0,r.useRef)(null),n=He((0,r.useState)(!1),2),a=n[0],i=n[1];return(0,Le.Bx)(t,(function(){e.setShowDesktopButtons(!1)})),(0,r.useEffect)((function(){if(t.current){var e=new IntersectionObserver((function(e){var t=He(e,1)[0];i((function(e){return e||t.intersectionRatio<1&&t.boundingClientRect.top>0}))}),{threshold:[1]});return e.observe(t.current),function(){e.disconnect()}}})),e.isMessageWithButtons||e.isDesktop&&e.showDesktopButtons?r.createElement(r.Fragment,null,e.isDesktop&&r.createElement(v.M,{className:"liveshopping-live-chat__chat-dots",alt:"Chat Dots",src:pe,onClick:function(){return e.setShowDesktopButtons(!e.showDesktopButtons)}}),(!e.isDesktop||e.showDesktopButtons)&&r.createElement("div",{ref:t,className:e.isDesktop&&e.showDesktopButtons?"liveshopping-live-chat__desktop-buttons".concat(a?" liveshopping-live-chat__desktop-buttons--offset":""):"liveshopping-live-chat__buttons-wrapper"},e.canReply&&r.createElement("button",{type:"button",className:"bl-core-button bl-core-button--reply",onClick:function(){void 0!==e.message.event.message.MessageId&&void 0!==e.message.event.message.Content&&(e.setReplyToAndIfSetFocusChat({messageId:e.message.event.message.MessageId,content:e.message.event.message.Content,metadata:e.metadata}),e.setHoverDetected(!1)),e.setShowDesktopButtons(!1)}},!e.isDesktop&&r.createElement(v.M,{src:ce,alt:(0,m.Iu)("livestream.watch.chat.reply")}),(0,m.Iu)("livestream.watch.chat.reply")),e.canMute&&r.createElement("button",{type:"button",className:"bl-core-button ".concat("mute"===e.muteButtonState?"liveshopping-live-button--warning":"liveshopping-live-button--chat"),onClick:function(){if(e.user&&!e.isMutingOrUnmuting){var t;if(e.handle)t=e.isMutedWouldUnmute?l.sO.unmuteUserByHandle(e.user,e.show.id,e.handle):l.sO.muteUserByHandle(e.user,e.show.id,e.handle);else{if(!e.displayName)return void console.error("Oops");t=e.isMutedWouldUnmute?l.sO.unmuteUserByDisplayName(e.user,e.show.id,e.displayName):l.sO.muteUserByDisplayName(e.user,e.show.id,e.displayName)}if(!e.mutedUserKey)return void console.error("Oops");e.setMuteSetsIfMounted((function(t){t.changingUsers.add(e.mutedUserKey)})),t.then((function(){return e.setMuteSetsIfMounted((function(t){e.isMutedWouldUnmute?t.mutedUsers.delete(e.mutedUserKey):t.mutedUsers.add(e.mutedUserKey)}))})).finally((function(){return e.setMuteSetsIfMounted((function(t){t.changingUsers.delete(e.mutedUserKey)}))}))}e.setShowDesktopButtons(!1)},disabled:!e.mutedUserKey||!!e.isMutingOrUnmuting},(0,m.Iu)("livestream.watch.chat.".concat(e.muteButtonState))),e.canPin&&r.createElement("button",{type:"button",className:"bl-core-button".concat(e.isPinnedMessage?" liveshopping-live-button--chat":" liveshopping-live-button--pin"),onClick:function(){e.user&&(e.isPinnedMessage?l.sO.clearPinnedMessage(e.user,e.show.id):l.sO.setPinnedMessage(e.user,e.show.id,{messageId:e.message.event.message.MessageId})),e.setShowDesktopButtons(!1)}},e.isPinnedMessage?(0,m.Iu)("livestream.watch.chat.unpin"):(0,m.Iu)("livestream.watch.chat.pin")),e.canDelete&&r.createElement("button",{type:"button",className:"bl-core-button liveshopping-live-button--chat",onClick:function(){e.session&&e.message.event.message.MessageId&&(e.session.redactMessage(e.message.event.message.MessageId),setTimeout((function(){return e.hoverEffectedRef.current&&e.setAsMessageWithButtonsAndDrainChatChanges(e.message,!1)}))),e.setShowDesktopButtons(!1)}},(0,m.Iu)("livestream.watch.chat.delete")),e.iAmShowOwner&&e.isDesktop&&!e.show.publiclyListed&&e.displayName&&e.show.variants.length>0&&r.createElement("button",{type:"button",className:"bl-core-button liveshopping-live-button--purchase",onClick:function(){if(e.user&&e.displayName&&e.show.variants.length>0){var t=e.show.variants[Math.floor(Math.random()*e.show.variants.length)],n=Math.floor(3*Math.random())+1;l.sO.debugPurchaseByDisplayName(e.user,e.show.id,e.displayName,t,n)}e.setShowDesktopButtons(!1)}},(0,m.Iu)("livestream.watch.chat.debug_purchase")))):null}function at(e){var t=e.id,n=e.pendingMessage,a=e.resendChat,i=e.removePendingChat,o=e.onAnimationEnd;return n.error?r.createElement(ot,{pinned:!1,buttonMode:"after",body:r.createElement(it,{content:n.content,metadata:void 0,isPending:!0,isPinned:!1}),buttons:r.createElement(r.Fragment,null,r.createElement("button",{type:"button",className:"bl-core-button liveshopping-live-button--chat",onClick:function(){return a(t,n)}},(0,m.Iu)("livestream.watch.chat.retry_sending")),r.createElement("button",{type:"button",className:"bl-core-button liveshopping-live-button--chat",onClick:function(){return i(t)}},(0,m.Iu)("livestream.watch.chat.cancel_sending"))),showButtons:!0,showButtonsAbove:!1,replyTo:n.replyTo,onAnimationEnd:o}):null}var it=function(e){var t,n,a=e.content,i=e.metadata,o=e.isPending,s=e.isPinned,c="liveshopping-live-chat__header--normal",u=null,l=null,d=!1;if(o)c="liveshopping-live-chat__header--error";else if("STREAMER"===(null==i?void 0:i.chatUserType))c="liveshopping-live-chat__header--channel-owner",u=r.createElement(v.M,{src:ie,alt:(0,m.Iu)("livestream.watch.chat.streamer")});else if(null!=i&&i.isModerator){c="liveshopping-live-chat__header--moderator",u=r.createElement(v.M,{src:oe,alt:(0,m.Iu)("livestream.watch.chat.moderator")});var p=/^(https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)$/,f=/^(https?:\/\/)/;l=(null!=a?a:"").split(" ").map((function(e,t){var n=e;if(p.test(n)&&(f.test(n)||!/\.\./.test(n))){d=!0;var a=n;f.test(a)||(a="https://"+a),n=r.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},n.replace(/^https?:\/\//,""))}return r.createElement(r.Fragment,null,t>0&&" ",n)}))}return r.createElement(r.Fragment,null,!o&&r.createElement(ne.Y,{handle:null==i?void 0:i.handle,displayName:null==i?void 0:i.displayName}),r.createElement("div",{className:"liveshopping-live-chat__wrapper"},r.createElement("p",{className:"liveshopping-live-chat__header "+c},o?(0,m.Iu)("livestream.watch.chat.failed_to_send"):r.createElement(r.Fragment,null,null!==(t=null==i?void 0:i.handle)&&void 0!==t?t:null==i||null===(n=i.displayName)||void 0===n?void 0:n.baseName," ",u,s&&r.createElement(r.Fragment,null," ",r.createElement("span",null,r.createElement(v.M,{src:le,alt:(0,m.Iu)("livestream.watch.chat.pin")})," ",(0,m.Iu)("livestream.watch.chat.pinned"))))),r.createElement("p",{className:"liveshopping-live-chat__content".concat(d?" liveshopping-live-chat__content--has-url":"").concat("STREAMER"===(null==i?void 0:i.chatUserType)||null!=i&&i.isModerator?" liveshopping-live-chat__content--long":"")},d&&l||a)))};function ot(e){var t=e.buttonMode,n=e.events,a=e.body,i=e.buttons,o=e.showButtons,s=e.showButtonsAbove,c=e.buttonFadeStyle,u=e.hasReply,l=e.replyTo,d=e.pinned,p=e.onAnimationEnd;return r.createElement(r.Fragment,null,l&&r.createElement(ot,{buttonMode:t,body:r.createElement(r.Fragment,null,r.createElement(v.M,{className:"liveshopping-live-chat__has-reply",src:ce,alt:"Reply"}),r.createElement(it,{content:l.content,metadata:l.metadata,isPending:!1,isPinned:!1})),buttons:null,showButtons:!1,showButtonsAbove:!1,buttonFadeStyle:c,hasReply:!0,replyTo:void 0,pinned:d,onAnimationEnd:p}),r.createElement("div",je({className:"liveshopping-live-chat__container".concat(i?" liveshopping-live-chat__container--buttons-".concat(t):"").concat(u?" liveshopping-live-chat__container--has-reply":"").concat(l?" liveshopping-live-chat__container--is-reply":"").concat(d?" liveshopping-live-chat__container--pinned":"")},n,{onAnimationEnd:p}),r.createElement("div",{className:"liveshopping-live-chat"},a),o&&r.createElement("div",{className:"liveshopping-live-chat__buttons".concat(s?" liveshopping-live-chat__buttons--above":"")},r.createElement("div",{className:"liveshopping-live-chat__buttons-inner",style:c},i))))}var st=n(54703),ct=n(23985),ut=n(30788),lt=n(97632);const dt=n.p+"2ae38a3579e4115a3cb501e7a851d66a.svg";function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mt=new lt.ZP,ft=new lt.ZP;function ht(e){var t=e.myHearts,n=e.isLiveStreamAvailable,a=pt((0,r.useState)(0),2),i=a[0],o=a[1];(0,r.useEffect)((function(){return l.sO.instance.addEventListenerAndReturnRemover("reaction",(function(e){o((function(t){return t+e.data.counts.HEART}))}))}),[]);var c=pt((0,r.useState)(i),2),u=c[0],d=c[1],p=pt((0,r.useState)(t),2),v=p[0],m=p[1],f=pt((0,s.x)(new Map),2),h=f[0],g=f[1];(0,r.useEffect)((function(){var e=t-v;e>0&&m(t);var r=Math.max(i,u+e);n||o(r),r>u&&(g((function(e){for(var t=0,n=u;n<r;n++)e.set(n,{delayMs:t}),t+=200+200*Math.random()})),d(r))}),[t,v,u,i,g,n]);var b=(0,r.useCallback)((function(e){return g((function(t){t.delete(e)}))}),[g]);return r.createElement(r.Fragment,null,Array.from(h,(function(e){var t=pt(e,2),n=t[0],a=t[1];return r.createElement(gt,{key:n,id:n,config:a,onHeartDone:b})})))}function gt(e){var t=e.id,n=e.config,a=e.onHeartDone,i=pt((0,r.useState)((function(){var e=function(e){var t,n,r,a=Math.exp(-.5*e*e);do{r=(t=2*Math.random()-1)*t+(n=2*Math.random()-1)*n}while(r<a||r>=1);var i=Math.sqrt(-2*Math.log(r)/r);return{x:t*i,y:n*i}}(3);return{position:{x:0,y:0},velocity:{x:10*e.x-15,y:10*e.y-120},acceleration:{x:0,y:0},elapsed:0}})),2),o=i[0],s=i[1],c=(0,r.useCallback)((function(e,t){s((function(n){var r=(t-e)/1e3,a=r-n.elapsed,i={x:n.velocity.x+n.acceleration.x*a,y:n.velocity.y+n.acceleration.y*a},o={x:n.position.x+(n.velocity.x+i.x)*a/2,y:n.position.y+(n.velocity.y+i.y)*a/2},s=n.position.x/100,c=n.position.y/100,u=t/1500,l={x:30*mt.noise3D(s,c,u),y:30*ft.noise3D(s,c,u)},d=o.x,p=.02;return i.x>0&&(d+=30,p=.05),l.x-=d*Math.abs(d)*p,{position:o,velocity:i,acceleration:l,elapsed:r}}))}),[]),u=pt((0,W.KS)(100+n.delayMs),2),l=u[0],d=u[1],p=pt((0,r.useState)(void 0),2),v=p[0],m=p[1];(0,r.useEffect)((function(){if(!l){var e=performance.now();void 0===v?(m(e),c(e,e)):c(v,e),d(500)}}),[d,c,l,v]);var f=pt((0,r.useState)({opacity:0,transition:""}),2),h=f[0],g=f[1];(0,r.useEffect)((function(){if(void 0!==v){g({opacity:1,transition:"0.4s ease-out"});var e=setTimeout((function(){g({opacity:0,transition:"2s ease-in"}),e=setTimeout((function(){return a(t)}),2e3)}),1500);return function(){return clearTimeout(e)}}}),[t,a,v]);var b,y=o.position.x,w=o.position.y,_=function(e,t,n){var r=1,a=e+t*r,i=(e+a)/2,o=e+1.5*t,s=(e+o)/2;Math.abs(i)<Math.abs(s)&&(r=1.5,a=o,i=s);var c=e/i/3,u=1-a/i/3;return["".concat(n," ").concat(r,"s cubic-bezier(").concat(1/3,", ").concat(c,", ").concat(2/3,", ").concat(u,")"),i*r]};if(void 0!==v){var E=pt(_(o.velocity.x,o.acceleration.x,"left"),2),k=E[0],I=E[1],C=pt(_(o.velocity.y,o.acceleration.y,"top"),2),S=C[0],N=C[1];b="".concat(k,", ").concat(S,", opacity ").concat(h.transition),y+=I,w+=N}return r.createElement("div",{className:"liveshopping-heart",style:{backgroundImage:"url(".concat(dt,")"),left:"".concat(y,"px"),top:"".concat(w,"px"),opacity:"".concat(h.opacity),transition:b,userSelect:"none"}})}var bt=n(56709),yt=n(57154),wt=n(74652),_t=n(66746);const Et=n.p+"a819122f3b1c0bb970a5f6176d3ee185.svg",kt=n.p+"437cc6e6aa277f5819e50eb1981a515a.svg";var It=n(83665);const Ct=n.p+"f47b25727e50cb313a6954a6c41166b3.svg",St=n.p+"e93c7cb4cade4712d09168b6261d3984.svg",Nt=n.p+"e68a74c67d80735a5c6c5eeaa07906fb.svg",At=n.p+"9b82e0a52e253e319081aa63c6820aaa.svg",Mt=n.p+"ed17595a3be61f1a0c6462b3797aa4aa.svg",Rt=n.p+"1c4fa7c1061b7e92cef64953ef191407.svg",Ot=n.p+"23ba4ac56a890fffdb1722ebf1f64631.svg";var Pt=n(43844);function Tt(e){var t="string"==typeof e.body?r.createElement("p",null,e.body):r.createElement("p",{dangerouslySetInnerHTML:e.body}),n=(0,E.L)().authModalSingleButton;return r.createElement(ae.Z,{wrapperClassName:"liveshopping-auth-modal--".concat(e.live?"live":"card"),setIsOpen:e.setIsOpen,header:e.header},t,n?r.createElement("a",{className:"bl-core-button bl-core-button--cta bl-core-anchor--fake-button",href:"/pages/".concat("myaccount","?operation=signUp")},(0,m.Iu)("account.links.sign_up_or_in")):r.createElement("h2",null,r.createElement("a",{href:"/pages/".concat("myaccount","?operation=signUp")},(0,m.Iu)("account.links.sign_up"))," / ",r.createElement("a",{href:"/pages/".concat("myaccount","?operation=signIn")},(0,m.Iu)("account.links.sign_in"))))}var xt=n(38094);function Dt(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Ft(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jt(e){var t,n=e.show,a=e.user,i=e.myProfile,o=e.live,s=e.setShareModalOpen,c=a&&n.handle===(null===(t=i.influencer)||void 0===t?void 0:t.handle),u=(0,W.XM)(),d=(0,E.L)(),p=Ft((0,r.useState)(),2),v=p[0],f=p[1],h=Ft((0,r.useState)(),2),g=h[0],b=h[1],y=function(){var e,t=(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,Pt.s)(n.title,v,g,b),l.sO.recordShare(a,n.id);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Dt(i,r,a,o,s,"next",e)}function s(e){Dt(i,r,a,o,s,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}();(0,r.useEffect)((function(){(0,xt.H1)(n,a,i).then((function(e){u.current&&f(e)}))}),[n.id,n.handle,a,i.influencer,u]);var w="RUNNING"===n.state&&(0,l.U6)(n,"FRIEND_REFERRAL");return a||!d.requireSignInToShare?r.createElement(ae.Z,{wrapperClassName:"liveshopping-friend-reminder__wrapper--".concat(o?"live":"card"),setIsOpen:s},r.createElement("p",{className:"liveshopping-friend-reminder__text"},c?(0,m.Iu)("livestream.watch.friend_reminder_body_for_streamer"):w?(0,m.Iu)("livestream.watch.friend_reminder_body_discount"):(0,m.Iu)("livestream.watch.friend_reminder_body_no_discount")),r.createElement("div",{className:"liveshopping-share-wrapper"},r.createElement("button",{type:"button",className:"bl-core-button liveshopping-button--share".concat(o?"":" bl-core-button--cta"),title:(0,m.Iu)("livestream.watch.share_title"),onClick:y,disabled:!v},r.createElement("img",{src:It.Z,alt:(0,m.Iu)("livestream.watch.share")}),(0,m.Iu)("livestream.watch.share")),r.createElement("span",{className:"liveshopping-share-tooltip".concat(g?" active":"")},(0,m.Iu)("livestream.watch.link_copied")))):r.createElement(Tt,{setIsOpen:s,live:o,body:(w?(0,m.Iu)("livestream.watch.friend_reminder_body_discount"):(0,m.Iu)("livestream.watch.friend_reminder_body_no_discount"))+" "+(0,m.Iu)("livestream.watch.friend_reminder_auth")})}var Bt=n(96666),Ut=n(38242),Vt=function(e){return r.createElement("div",{className:"liveshopping-product-mini ".concat(e.slideOut?"liveshopping-product-mini__slide-left":"liveshopping-product-mini__slide-right"),onClick:e.onClick,tabIndex:1},e.children)},Ht=function(e){var t=document.data.liveshoppingLinks.find((function(t){return t.url===e.link}));return r.createElement(Vt,{slideOut:e.slideOut,onClick:function(){return e.onClick(t)}},t.image?r.createElement(v.M,{src:t.image,alt:t.name,className:"liveshopping-product-mini__image"}):null)},Gt=function(e){C();var t=(0,q.Zb)(e.productId,e.variantId),n=t.loading,a=t.product,i=t.variant;if(n||!a||!i)return null;var o=f(document.data.currency.isoCode,i.compareAtPriceCents),s=V(a,i,e.hasDiscount);return r.createElement(Vt,{slideOut:e.slideOut,onClick:function(){return e.onClick({product:a,variant:i})}},i.img?r.createElement(v.M,{src:i.img.src,alt:i.name,className:"liveshopping-product-mini__image"}):null,r.createElement("div",{className:"liveshopping-product-mini__label-wrapper"},r.createElement("div",{className:"liveshopping-product-mini__label ".concat(s?"liveshopping-product__price--overridden":"")},o),s&&r.createElement("div",{className:"liveshopping-product-mini__discount-label"},s)))},Wt=n(8806);function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach((function(t){zt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zt(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Xt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yt(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||Xt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xt(e,t){if(e){if("string"==typeof e)return $t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(e,t):void 0}}function $t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var en=function(){return window.location.href="/pages/".concat("myaccount","?operation=confirm"),null};function tn(e,t,n){var a=Jt((0,s.x)({mostRecentChatTimestamp:0}),2),i=a[0],o=a[1],c=(0,r.useCallback)((function(e,n){return o((function(r){var a,i,o=0;if("on demand"===n||(o=null!==(a=null===(i=n.CreatedTimestamp)||void 0===i?void 0:i.getTime())&&void 0!==a?a:0)>r.mostRecentChatTimestamp)return{value:e,chatSessionCloseCountWhenValueSetFromChat:t,mostRecentChatTimestamp:o}}))}),[t,o]),u="loading"!==e&&"no such show"!==e&&"temporary error"!==e&&"RUNNING"===e.state?n(e):void 0,l=(0,W.KJ)(t);return(0,r.useEffect)((function(){"loading"!==e&&"no such show"!==e&&"temporary error"!==e&&o((function(e){l.current!==e.chatSessionCloseCountWhenValueSetFromChat&&(e.value=u)}))}),[l,o,e,u]),{value:null==i?void 0:i.value,setValueFromChat:c}}function nn(e){var t,n,a=Jt((0,r.useState)(!0),2),i=a[0],o=a[1],s=(0,b.pH)(),c=e.variantsAndProducts.filter((function(e){return!e.product.gwp})),u=(0,b.jD)().cartResult,l=Jt((0,r.useState)(),2),d=l[0],p=l[1];(0,r.useEffect)((function(){var e,t=0===(null===(e=u.cart)||void 0===e?void 0:e.item_count);(t||u.cart&&void 0===d)&&p(t)}),[d,u.cart]);var v={user:e.user,showId:e.show.id,isLive:e.wasWatchingLive,playbackTime:void 0,location:"endcard",hasDiscount:e.hasDiscount},f=!0===d&&void 0!==(null===(t=window.beautyLabsCart)||void 0===t?void 0:t.showMinicart)&&c.length+(document.data.liveshoppingLinks||[]).filter((function(e){return e.allowAfterLive})).length>1,h=function(){var e,t=(e=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f&&o(!0);case 1:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){Yt(i,r,a,o,s,"next",e)}function s(e){Yt(i,r,a,o,s,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}(),g=f?function(){return o(!0)}:void 0,y=(0,r.useRef)(null),w=Jt((0,r.useState)(!1),2),_=w[0],E=w[1];(0,r.useEffect)((function(){if(_&&!i&&y.current){var e=y.current.offsetTop+y.current.clientHeight-window.innerHeight+100;window.scrollTo({top:e}),E(!1)}}),[_,i]);var k=document.getElementById("react-liveshopping-purchase-reminder"),I=r.createElement("div",{className:"liveshopping-purchase-reminder",ref:y},!f||!i&&e.activeProductAndVariant?!f&&"!"!==s&&s>0?r.createElement(r.Fragment,null,r.createElement("h1",{className:"liveshopping-purchase-reminder__title"},(0,m.Iu)("shop.purchase_reminder.title_something_in_bag")),e.variantsAndProducts&&r.createElement(X,{onDone:function(){},onChangeBag:function(){},show:e.show})):e.activeProductAndVariant&&e.variantsAndProducts?r.createElement(r.Fragment,null,r.createElement("h1",{className:"liveshopping-purchase-reminder__title liveshopping-purchase-reminder__title--empty"},(0,m.Iu)("shop.purchase_reminder.title_empty_bag")),r.createElement(H,{productAndDefaultVariant:e.activeProductAndVariant,variantsAndProducts:e.variantsAndProducts,hasDiscount:e.hasDiscount,getDataForLineItemProperties:function(){return v},giftsWithPurchaseConfig:null===(n=e.show.discounts)||void 0===n?void 0:n.giftsWithPurchase,onDone:h,showMiniCartOnAddToBag:f,onBackClick:g,isReminder:!0,refreshDiscount:e.refreshDiscount,show:e.show})):null:r.createElement(r.Fragment,null,r.createElement("h1",{className:"liveshopping-product-all-products__header"},(0,m.Iu)("shop.product.products_featured")),r.createElement(an,{mode:"purchase-reminder",variantsAndProducts:c,showIsLive:!1,onVariantClick:function(t){e.setActiveVariantId(t.variant.id),o(!1),E(!0)},onClose:function(){}})));return r.createElement(r.Fragment,null,r.createElement(st._,{show:e.show,size:"large",setWatchOnDemand:e.setWatchOnDemand,watchedShowEnd:e.watchedShowEnd,purchaseReminder:I}),r.createElement(Ut.q,{portal:k,renderInline:!1},I))}var rn=function(e){var t;return r.createElement(r.Fragment,null,e.image&&r.createElement(v.M,{className:"liveshopping-product-all-products__img",src:e.image,alt:null!==(t=e.imageAltText)&&void 0!==t?t:e.name}),r.createElement("div",{className:"liveshopping-product-all-products__name-wrapper"},r.createElement("div",{className:"liveshopping-product-all-products__name"},e.isFeatured&&"featured-item-switcher"!==e.mode&&r.createElement("div",{className:"liveshopping-product-all-products__featured-text"},(0,m.Iu)("livestream.watch.featured")),e.name),"featured-item-switcher"===e.mode?e.isFeatured?r.createElement("img",{src:Ot,alt:(0,m.Iu)("accessibility.radio_button"),className:"liveshopping-product-all-products__featured-radio liveshopping-product-all-products__featured-radio--selected"}):r.createElement("img",{src:Rt,alt:(0,m.Iu)("accessibility.radio_button"),className:"liveshopping-product-all-products__featured-radio"}):null),"featured-item-switcher"!==e.mode&&r.createElement(v.M,{className:"liveshopping-product-all-products__arrow",src:Mt,alt:(0,m.Iu)("accessibility.arrow")}))},an=function(e){var t=(0,r.useRef)(!0);return r.createElement(w.BA,{className:"liveshopping-product-all-products__content",canClick:t,vertical:!0},(document.data.liveshoppingLinks||[]).filter((function(t){return t.allowAfterLive||e.showIsLive})).map((function(n,a){var i=void 0!==e.featuredItem&&"LINK"===e.featuredItem.type&&e.featuredItem.link===n.url;return r.createElement("div",{key:-a,className:"liveshopping-product-all-products__item liveshopping-product-all-products__item-link",onClick:function(){t.current&&("featured-item-switcher"===e.mode?i?"NOTHING_FEATURED_BY_DEFAULT"===e.featureMode&&e.setFeaturedItem(void 0):void 0!==e.featureMode&&e.setFeaturedItem({type:"LINK",link:n.url}):(window.open(n.url,"_blank"),e.onClose()))}},r.createElement(rn,{image:n.image,name:n.name,mode:e.mode}))})),e.variantsAndProducts.map((function(n,a){var i,o,s=void 0!==e.featuredItem&&"VARIANT"===e.featuredItem.type&&e.featuredItem.variantId===n.variant.id;return r.createElement("div",{key:a,className:"liveshopping-product-all-products__item".concat(s?" liveshopping-product-all-products__item--active":""),onClick:function(){t.current&&("featured-item-switcher"===e.mode?s?"NOTHING_FEATURED_BY_DEFAULT"===e.featureMode&&e.setFeaturedItem(void 0):e.setFeaturedItem({type:"VARIANT",variantId:n.variant.id}):e.onVariantClick(n))}},r.createElement(rn,{image:null===(i=n.product.img)||void 0===i?void 0:i.src,name:n.product.name,mode:e.mode,isFeatured:s,imageAltText:null===(o=n.product.img)||void 0===o?void 0:o.alt}))})))},on=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zt(this,"playbackState",void 0),this.playbackState=t}var t,n,r;return t=e,(n=[{key:"now",value:function(){return sn(this.playbackState)}},{key:"nowForAnalytics",value:function(){return Math.floor(this.now())}},{key:"nowIfOnDemand",value:function(){if("live"!==this.playbackState.state)return this.now()}},{key:"nowIfOnDemandForAnalytics",value:function(){var e=this.nowIfOnDemand();return e?Math.floor(e):null}}])&&Qt(t.prototype,n),r&&Qt(t,r),e}();function sn(e){var t;switch(e.state){case"live":t=Date.now();break;case"in recording":t=Date.parse(e.recording.startTime)+e.seekRef.current.positionMillis,t=Math.min(t,Date.parse(e.recording.endTime));break;case"playing between recordings":t=Date.now()+e.playbackOffsetMillis,e.nextRecording&&(t=Math.min(t,Date.parse(e.nextRecording.startTime)));break;default:t=e.playbackTimeMillis}return t}function cn(e,t){var n=t.playbackState,a=t.videoPlayerControl,i=(0,W.qY)();(0,W.V7)("live"!==n.state&&"playing between recordings"!==n.state||!e?0:Math.max(e-sn(n),1));var o=a.addPositionListenerAndReturnRemover;(0,r.useEffect)((function(){if("in recording"===n.state&&e&&e<=Date.parse(n.recording.endTime)){var t=Date.parse(n.recording.startTime);return o((function(n){t+n>=e&&i()}))}}),[e,n,i,o])}var un=function(e){(0,r.useEffect)((function(){var t,n=document.createElement("style"),r=Zt(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.textContent+="#".concat(a," { display: none !important; }\n")}}catch(e){r.e(e)}finally{r.f()}return document.head.append(n),function(){document.head.removeChild(n)}}),[e])},ln=function(e){return Date.parse(e.startedTime)},dn=function(e){var t;return Date.parse(null!==(t=e.endTime)&&void 0!==t?t:e.startTime)};function pn(e){var t=e.show,n=e.user,a=e.children;return(0,r.useEffect)((function(){l.sO.logShowViewPending(n,t.id)}),[t.id,n]),r.createElement(r.Fragment,null,a)}function vn(e){var t,n,i,o,u,p,f,h,g=(0,E.L)();un(["shopify-section-header","shopify-section-footer","shopify-section-announcement-bar"]),un(g.streamInProgressExtraHideElementIds),h=["header","footer"],(0,r.useEffect)((function(){var e,t=document.createElement("style"),n=Zt(h);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.textContent+="".concat(r," { display: none !important; }\n")}}catch(e){n.e(e)}finally{n.f()}return document.head.append(t),function(){document.head.removeChild(t)}}),[h]),(0,r.useEffect)((function(){var e=document.querySelector("body"),t=e.style.overflow;return e.style.overflow="hidden",function(){e.style.overflow=t}}),[]),(0,r.useEffect)((function(){if(g.streamInProgressHideAndReturnUnhideExtra)return g.streamInProgressHideAndReturnUnhideExtra()}),[g]);var y,w,_=Jt((0,r.useState)(!1),2),k=_[0],I=_[1],C=Jt((0,r.useState)("allProducts"),2),N=C[0],A=C[1],M=function(t){"product"===t?e.setUserVariantId((function(t){return t||(e.hostFeaturedItem&&"VARIANT"===e.hostFeaturedItem.type?e.hostFeaturedItem.variantId:de.variants.length>0?de.variants[0]:void 0)})):e.setUserVariantId(void 0),A(t),I(!0)},R=(0,b.pH)(),O=Jt((0,r.useState)(!1),2),P=O[0],T=O[1],x=Jt((0,r.useState)(!1),2),D=x[0],F=x[1],L=Jt((0,r.useState)((function(){return e.show.recordings?{state:"did seek",playbackTimeMillis:Date.parse(e.show.startTime),isPaused:!1}:{state:"live"}})),2),j=L[0],B=L[1],U=(0,r.useMemo)((function(){return new on(j)}),[j]),V=(0,c.a)(e.show.id,U),H=Jt((0,r.useState)(!1),2),G=H[0],q=H[1],K={playbackState:j,videoPlayerControl:V,isPaused:function(){switch(j.state){case"in recording":return!0===V.isPaused;case"paused between recordings":return!0;case"did seek":return j.isPaused;default:return!1}},pause:function(){B((function(e){switch(e.state){case"in recording":return V.pause(),e.seekRef.current.initialIsPaused=!0,e;case"playing between recordings":return{state:"paused between recordings",playbackTimeMillis:sn(e),nextRecording:e.nextRecording};case"did seek":return Kt(Kt({},e),{},{isPaused:!0});default:return e}}))},play:function(){B((function(e){switch(e.state){case"in recording":return V.play(),e.seekRef.current.initialIsPaused=!1,e;case"paused between recordings":return{state:"playing between recordings",playbackOffsetMillis:e.playbackTimeMillis-Date.now(),nextRecording:e.nextRecording};case"did seek":return Kt(Kt({},e),{},{isPaused:!0});default:return e}}))}},Z=0;function Q(e){e&&(!Z||e<Z)&&(Z=e)}var z=U.now();switch(j.state){case"live":y=null===(t=e.influencer)||void 0===t?void 0:t.livePlaybackUrl;break;case"in recording":y="".concat(j.recording.baseUrl,"/media/hls/master.m3u8"),(w=j.seekRef).current.ended&&B({state:"did seek",isPaused:!1,playbackTimeMillis:z,playbackTimeForSearchMillis:Date.parse(j.recording.endTime)});break;case"playing between recordings":if(j.nextRecording){var Y=Date.parse(j.nextRecording.startTime);z>=Y?B({state:"in recording",recording:j.nextRecording,seekRef:{current:{positionMillis:0,initialIsPaused:!1}}}):Q(Y)}break;case"paused between recordings":break;case"did seek":var J=e.show.recordings,X=null!==(n=j.playbackTimeForSearchMillis)&&void 0!==n?n:j.playbackTimeMillis,$=J.findIndex((function(e){return X<Date.parse(e.startTime)}));$<0&&($=J.length);var ee=J[$-1],re=J[$];B(ee&&X<Date.parse(ee.endTime)?{state:"in recording",recording:ee,seekRef:{current:{positionMillis:j.playbackTimeMillis-Date.parse(ee.startTime),initialIsPaused:j.isPaused}}}:j.isPaused?{state:"paused between recordings",playbackTimeMillis:j.playbackTimeMillis,nextRecording:re}:{state:"playing between recordings",playbackOffsetMillis:j.playbackTimeMillis-Date.now(),nextRecording:re})}var ie=dn(e.show);(0,r.useEffect)((function(){"live"!==j.state&&z>=ie&&K.pause()})),"live"!==j.state&&z<ie&&Q(ie),cn(Z,K);var oe=(0,r.useCallback)((function(t){d.Z.logShowWatchQuality({show_id:e.show.id,quality:t.name,height:t.height,width:t.width,codecs:t.codecs,bitrate:t.bitrate,playback_time:U.nowIfOnDemandForAnalytics()})}),[e.show.id,U]),se=(0,r.useCallback)((function(){return{user:e.user,showId:e.show.id,isLive:"RUNNING"===e.show.state,location:"watching",playbackTime:U.now(),hasDiscount:e.hasDiscount}}),[e.user,e.show.id,e.show.state,U,e.hasDiscount]),ce=e.userVariantAndProduct,le=e.hostFeaturedItem,de=e.show,pe=(0,W.D9)(le,le),ve=Jt((0,r.useState)(le),2),me=ve[0],fe=ve[1],he=Jt((0,r.useState)(!1),2),ge=he[0],be=he[1],ye=(0,r.useMemo)((function(){return"VARIANT"===(null==me?void 0:me.type)?de.products.find((function(e,t){return de.variants[t]===me.variantId})):null}),[de.products,de.variants,me]);(0,r.useEffect)((function(){var e=!1;if(void 0!==pe?(void 0===le||pe.type!==le.type||"VARIANT"===pe.type&&"VARIANT"===le.type&&pe.variantId!==le.variantId||"LINK"===pe.type&&"LINK"===le.type&&pe.link!==le.link)&&(e=!0):void 0!==le&&(e=!0),e){be(!0);var t=getComputedStyle(document.documentElement).getPropertyValue("--liveshopping-product-mini__slide-duration")||"0",n=!1,r=function(){n||(be(!1),fe(le)),n=!0},a=setTimeout(r,Number(t));return function(){n||(r(),clearTimeout(a))}}}),[le]);var we=e.variantsAndProducts.filter((function(e){return!e.product.gwp})),_e=null!==e.user&&de.handle===(null===(i=e.myProfile.influencer)||void 0===i?void 0:i.handle);(0,W.d9)((0,r.useCallback)((function(t){t?d.Z.logShowWatchHide({show_id:e.show.id,playback_time:U.nowIfOnDemandForAnalytics()}):d.Z.logShowWatchShow({show_id:e.show.id,playback_time:U.nowIfOnDemandForAnalytics()})}),[e.show.id,U]));var Ee=Jt((0,s.x)([]),2),ke=Ee[0],Ie=Ee[1],Ce=(0,r.useCallback)((function(e){return Ie((function(t){t.find((function(t){return t.message.MessageId===e.message.MessageId}))||t.push(e)}))}),[Ie]),Se=(0,r.useCallback)((function(e){return Ie((function(t){return t.filter((function(t){return t.message.MessageId!==e.message.MessageId}))}))}),[Ie]),Ne=null===(o=e.hasDiscount)||void 0===o?void 0:o.discounts,Ae=void 0!==Object.entries(null!=Ne?Ne:{}).find((function(e){return"FRIEND_REFERRAL"===Jt(e,2)[1].type})),Me=Jt((0,W.KS)(0),2),Re=Me[0],Oe=Me[1];(0,r.useEffect)((function(){Oe(Ae?1e4:0)}),[Oe,Ae]);var Pe=Jt((0,r.useState)(0),2),Te=Pe[0],xe=Pe[1],De="RUNNING"===de.state&&(V.playerState===a.PlayerState.PLAYING||V.playerState===a.PlayerState.BUFFERING),Fe=K.isPaused(),Le=Jt((0,r.useState)(),2),je=Le[0],Be=Le[1],Ue=(0,r.useRef)(null),Ve=(0,r.useCallback)((function(){if(null!==Ue.current){var e=Number(getComputedStyle(document.documentElement).getPropertyValue("--liveshopping-video-aspect-ratio")),t=0===e?9/16:e,n=Math.round(Ue.current.clientHeight*t);n%2==1&&(n-=1),Ue.current.style.setProperty("--liveshopping-video-aspect-width",n+"px")}}),[Ue]),He=(0,r.useCallback)((function(e){var t=e.target;document.documentElement.style.setProperty("--liveshopping-live-screen-offset",t.offsetTop+"px"),"resize"===e.type&&(window.innerHeight===je&&Ke.current&&Ke.current.blur(),Ve())}),[je,Ve]);(0,r.useEffect)((function(){Ve()}),[]),(0,r.useEffect)((function(){return Be(window.innerHeight),te.Dt&&document.documentElement.style.setProperty("--liveshopping-live-screen-height",window.innerHeight+"px"),window.visualViewport&&(window.visualViewport.addEventListener("scroll",He),window.visualViewport.addEventListener("resize",He)),function(){window.visualViewport.removeEventListener("scroll",He),window.visualViewport.removeEventListener("resize",He)}}),[He]);var Ge=Jt((0,r.useState)(!1),2),We=Ge[0],qe=Ge[1],Ke=(0,r.useRef)(null),Qe=(0,S.gl)(),ze=(0,Wt.J)(e.viewerCount.value||0),Ye=we.length+(document.data.liveshoppingLinks||[]).filter((function(e){return e.allowAfterLive||"live"===j.state})).length;return r.createElement("div",{className:"liveshopping-live-wrapper liveshopping-live-wrapper--fullscreen".concat(We?" liveshopping-live-wrapper--fullscreen-keyboard-open":""),ref:Ue},Re&&r.createElement(ae.Z,{zIndex:3,wrapperClassName:"liveshopping-modal--friend-discount-unlocked",header:(0,m.Iu)("livestream.watch.friend_discount_unlocked.heading"),setIsOpen:function(){return Oe(0)}},r.createElement("p",null,(0,m.Iu)("livestream.watch.friend_discount_unlocked.body"))),D&&r.createElement(ae.Z,{wrapperClassName:"liveshopping-modal--profile",setIsOpen:F},r.createElement(ne.Y,{handle:de.handle,pictureSize:80}),r.createElement("h1",null,null===(u=e.influencer)||void 0===u?void 0:u.handle),r.createElement("div",{className:"liveshopping-profile-modal__bio"},null===(p=e.influencer)||void 0===p?void 0:p.bio)),r.createElement("div",{className:"liveshopping-live__top-decor"}," "),r.createElement("div",{className:"liveshopping-live__top"},r.createElement("div",{className:"liveshopping-live__top-bar"},(!_e||"live"!==j.state)&&r.createElement("div",{className:"liveshopping-live__owner".concat(null!==(f=e.influencer)&&void 0!==f&&f.bio?" liveshopping-live__owner--with-bio":""),onClick:function(){var t;null!==(t=e.influencer)&&void 0!==t&&t.bio&&g.displayShowOwner&&F(!D)}},g.displayShowOwner&&r.createElement(ne.Y,{showName:!0,handle:de.handle})),r.createElement("div",{className:"liveshopping-live__top-bar-right".concat(_e&&"live"===j.state?" liveshopping-live__top-bar-right--owner-pov":"")},!!e.viewerCount.value&&(ze||_e)&&r.createElement("div",{className:"liveshopping-live-label__monotone liveshopping-live-label__viewer-count"},r.createElement(v.M,{className:"liveshopping-live__eye-icon",src:Et,alt:(0,m.Iu)("livestream.watch.viewers_icon_alt")}),(0,Bt.M)(e.viewerCount.value)),"RUNNING"===de.state&&r.createElement(r.Fragment,null,r.createElement("div",{className:"liveshopping-live-label"},(0,m.Iu)("livestream.watch.live")),_e&&"live"===j.state&&r.createElement(fn,{show:de})),_e&&"live"===j.state?r.createElement("button",{type:"button",className:"bl-core-button bl-core-button--cta liveshopping-live__end-show",onClick:function(){e.user&&l.sO.endShow(e.user,e.show.id)}},(0,m.Iu)("livestream.watch.end_show")):null,r.createElement("div",{onClick:function(){e.closeStream?e.closeStream():window.location.href=_e?"/pages/profile/livestreams":"/pages/live-shopping"}},r.createElement(v.M,{className:"liveshopping-live__close",src:ue,alt:(0,m.Iu)("accessibility.close")})))),r.createElement("div",{className:"liveshopping-product-mini__container"},me?"VARIANT"===me.type?r.createElement(Gt,{productId:ye,variantId:me.variantId,slideOut:ge,key:me.variantId,hasDiscount:e.hasDiscount,onClick:function(e){_e&&"live"===j.state||("product"!==N&&d.Z.logShowWatchViewProduct({show_id:de.id,product_id:e.product.id,product_handle:e.product.handle,playback_time:U.nowIfOnDemandForAnalytics()}),M("product"))}}):"LINK"===me.type?r.createElement(Ht,{link:me.link,slideOut:ge,key:me.link,onClick:function(e){_e&&"live"===j.state||window.open(e.url,"_blank")}}):null:null),r.createElement("div",{className:"liveshopping-live__purchases"},ke.map((function(e,t,n){return r.createElement(bn,{key:e.message.MessageId,purchase:e,onRemoveSomeonesPurchase:Se,offTheTop:t<n.length-3})})))),r.createElement(Ze,{user:e.user,myProfile:e.myProfile,show:e.show,referralCode:e.referralCode,buttonsToLeftOfChatInput:r.createElement(r.Fragment,null,"RUNNING"!==de.state&&r.createElement("button",{type:"button",className:"liveshopping-live-bottom-button",onClick:function(){Fe?K.play():K.pause()},title:Fe?(0,m.Iu)("livestream.watch.play"):(0,m.Iu)("livestream.watch.pause"),tabIndex:2},r.createElement(v.M,{src:Fe?At:Nt,alt:Fe?(0,m.Iu)("livestream.watch.play"):(0,m.Iu)("livestream.watch.pause"),className:Fe?" liveshopping-playback-play":""})),void 0!==V.isMuted&&r.createElement("button",{type:"button",className:"liveshopping-live-bottom-button",onClick:function(){V.setMuted(!V.isMuted)},title:(0,m.Iu)(V.isMuted?"livestream.watch.audio_unmute":"livestream.watch.audio_mute"),tabIndex:3},r.createElement("div",{className:"liveshopping-live-mute-wrapper"},r.createElement(v.M,{src:V.isMuted?wt.Z:_t.Z,alt:(0,m.Iu)(V.isMuted?"livestream.watch.audio_unmute":"livestream.watch.audio_mute")})))),buttonsToRightOfChatInput:r.createElement(r.Fragment,null,Ye>0&&r.createElement("button",{disabled:"allProducts"===N&&Qe,type:"button",className:"liveshopping-live-bottom-button",onClick:function(){M("allProducts")},tabIndex:4},r.createElement(v.M,{src:St,alt:(0,m.Iu)("livestream.watch.all_products")})),(!_e||"live"!==j.state)&&r.createElement("button",{disabled:"bag"===N&&Qe,type:"button",className:"liveshopping-live-bottom-button",onClick:function(){M("bag")},tabIndex:5},r.createElement("div",{className:"liveshopping-live-bottom-button__bag-container"},r.createElement(v.M,{src:kt,alt:(0,m.Iu)("livestream.watch.buy_now")}),0!==R&&r.createElement("div",{className:"liveshopping-live-bottom__bag-count"},R))),r.createElement("button",{type:"button",title:(0,m.Iu)("livestream.watch.share_title"),className:"liveshopping-live-bottom-button",id:"share__btn",onClick:function(){return T(!P)},tabIndex:6},r.createElement(v.M,{src:It.Z,alt:(0,m.Iu)("livestream.watch.share")})),r.createElement("button",{disabled:Fe,type:"button",title:(0,m.Iu)("livestream.watch.like"),id:"heart__btn",className:"liveshopping-live-bottom-button",tabIndex:7,onClick:function(){if(!Fe){var t=U.nowIfOnDemand(),n=t?new Date(t).toISOString():void 0;l.sO.reactToShow(e.user,e.show.id,"HEART",{playbackTime:n}),xe((function(e){return e+1}))}}},r.createElement(v.M,{src:Ct,alt:(0,m.Iu)("livestream.watch.heart")}),r.createElement(ht,{myHearts:Te,isLiveStreamAvailable:De}))),setShowMayHaveEnded:e.setShowMayHaveEnded,setViewerCountFromChat:e.viewerCount.setValueFromChat,chatSessionCloseCount:e.chatSessionCloseCount,onChatSessionClosed:e.onChatSessionClosed,onSomeonePurchased:Ce,setFeaturedItemFromChat:e.setFeaturedItemFromChat,playbackControl:K,playbackWrapper:"RUNNING"===de.state?null:r.createElement(yn,{show:de,playbackControl:K,setScrubbing:q,setPlaybackState:B}),onKeyboardChange:qe,chatInputRef:Ke,scrubbing:G,variantsAndProducts:e.variantsAndProducts}),a.isPlayerSupported?r.createElement(c.Y,{control:V,streamUrl:y,isLive:"RUNNING"===e.show.state,seekRef:w,onQualityChanged:oe,showErrors:!We}):r.createElement("p",{className:"error"},(0,m.Iu)("livestream.watch.player_not_supported")),r.createElement("div",{className:"liveshopping-live__right"},r.createElement(mn,{view:N,playbackState:j,hostFeaturedItem:le,setHostLocalFeaturedItem:e.setHostLocalFeaturedItem,setUserVariantId:e.setUserVariantId,show:de,user:e.user,userIsOwner:_e,userVariantAndProduct:ce,variantsAndProducts:e.variantsAndProducts,isModalOpen:k,setIsModalOpen:I,setCurrentModal:M,getDataForLineItemProperties:se,hasDiscount:e.hasDiscount})),P&&r.createElement(jt,{show:de,user:e.user,myProfile:e.myProfile,live:!0,setShareModalOpen:T}))}function mn(e){var t=(0,S.gl)(),n=null,a="",i="",o=void 0;if("allProducts"===e.view&&e.variantsAndProducts){var s=e.variantsAndProducts.filter((function(e){return!e.product.gwp})),c=e.userIsOwner&&"live"===e.playbackState.state?"featured-item-switcher":"in-show";if(0===s.length+(document.data.liveshoppingLinks||[]).filter((function(t){return t.allowAfterLive||"live"===e.playbackState.state})).length)return null;"featured-item-switcher"===c?(i=(0,m.Iu)("livestream.watch.all_products"),o=(0,m.Iu)("livestream.watch.featured")):i=(0,m.Iu)("livestream.watch.products"),a="liveshopping-modal--all-products liveshopping-modal--all-products-".concat(c),n=r.createElement(an,{mode:c,variantsAndProducts:s,showIsLive:"live"===e.playbackState.state,featureMode:e.show.featureMode,featuredItem:e.hostFeaturedItem,setFeaturedItem:function(t){e.setHostLocalFeaturedItem(t),void 0===t?l.sO.clearFeaturedItem(e.user,e.show.id).catch((function(){})):"VARIANT"===t.type?l.sO.setActiveVariant(e.user,e.show.id,{variantId:t.variantId}).catch((function(){e.setHostLocalFeaturedItem(void 0)})):"LINK"===t.type&&l.sO.setFeaturedLink(e.user,e.show.id,{link:t.link}).catch((function(){e.setHostLocalFeaturedItem(void 0)}))},onVariantClick:function(t){e.setUserVariantId(t.variant.id),e.setCurrentModal("product")},onClose:function(){return e.setIsModalOpen(!1)}})}else if("bag"===e.view&&e.variantsAndProducts)i=(0,m.Iu)("livestream.watch.cart"),a="liveshopping-modal--bag",n=r.createElement(X,{onDone:function(){return e.setIsModalOpen(!1)},onChangeBag:function(){},show:e.show});else if("product"===e.view&&e.variantsAndProducts&&e.userVariantAndProduct){var u;a="liveshopping-modal--product",n=r.createElement(H,{productAndDefaultVariant:e.userVariantAndProduct,variantsAndProducts:e.variantsAndProducts,getDataForLineItemProperties:e.getDataForLineItemProperties,hasDiscount:e.hasDiscount,giftsWithPurchaseConfig:null===(u=e.show.discounts)||void 0===u?void 0:u.giftsWithPurchase,onDone:function(){t?e.setCurrentModal("allProducts"):e.setIsModalOpen(!1)},showMiniCartOnAddToBag:!1,onBackClick:function(){return e.setCurrentModal("allProducts")},show:e.show})}return t?r.createElement(r.Fragment,null,i&&r.createElement("h1",{className:"liveshopping-live-right-panel__header"},r.createElement("span",null,i),e.userIsOwner&&"ENDED"!==e.show.state&&r.createElement("span",null,(0,m.Iu)("livestream.watch.featured"))),n):e.isModalOpen?r.createElement(ae.Z,{header:i,headerSecondary:o,wrapperClassName:a,setIsOpen:e.setIsModalOpen},n):null}function fn(e){var t=e.show,n=(0,Le.ZA)(Date.parse(t.startTime),1e3);return r.createElement("div",{className:"liveshopping-live__uptime"},r.createElement("p",null,gn(n)))}var hn=function(e){return Math.floor(e/1e3)};function gn(e){var t=e<0,n=o.nL.fromObject({seconds:t?~e:e});return n.toFormat((0,m.Iu)(t?"livestream.schedule.uptime_luxon_format_negative":n.as("hours")>=1?"livestream.schedule.uptime_luxon_format_with_hours":"livestream.schedule.uptime_luxon_format_with_minutes"))}function bn(e){var t,n,a=e.purchase,i=e.onRemoveSomeonesPurchase,o=e.offTheTop,s=Jt((0,W.KS)(45e3),1)[0],c=o||!s;(0,r.useEffect)((function(){if(c){var e=setTimeout((function(){return i(a)}),200);return function(){return clearTimeout(e)}}}),[i,a,c]);var u,l,d=null!==(t=a.metadata.handle)&&void 0!==t?t:null===(n=a.metadata.displayName)||void 0===n?void 0:n.baseName;return u=a.metadata.items?a.metadata.items.reduce((function(e,t){return e+t.quantity}),0):a.metadata.quantity,d&&(l=d.length>12?r.createElement(r.Fragment,null,r.createElement("span",{className:"liveshopping-purchase-txt__name"},d),r.createElement("br",null)):r.createElement("span",{className:"liveshopping-purchase-txt__name"},d)),r.createElement("p",{style:{transitionDuration:"200ms"},className:"liveshopping-purchase-txt liveshopping-live-label__monotone--padded ".concat(c?" liveshopping-purchase-txt__fade-out":"")},(0,m.ju)(d?"livestream.watch.viewer_purchase_info":"livestream.watch.viewer_purchase_info_anon",{name:l,count:u}))}var yn=function(e){var t=e.show,n=e.playbackControl,a=e.setScrubbing,i=e.setPlaybackState,o=(0,r.useRef)(null),s=sn(n.playbackState),c=ln(t),u=dn(t),l=s-c,d=u-c,p=Date.parse(t.startTime),v=u-p,m=hn(s-p);cn(p+1e3*(m+1),n);var f=Jt((0,r.useState)(!1),2),h=f[0],g=f[1],b=function(e){!0!==h&&!1!==h&&clearTimeout(h),g(e)};return(0,r.useEffect)((function(){var e;null===(e=o.current)||void 0===e||e.style.setProperty("--elapsed","".concat(l/d))}),[l,d]),r.createElement("div",{className:"liveshopping-playback".concat(h?" bl-core-dragging":""),onPointerDown:function(e){if(!(e.button>0)){a(!0),b(!0),n.pause();var r=function(e){var n,r=null===(n=o.current)||void 0===n?void 0:n.getBoundingClientRect();if(r){var a=(e-r.left)/r.width,s=Math.min(Math.max(a,0),1)*d,c=ln(t)+s;i({state:"did seek",playbackTimeMillis:c,isPaused:!0})}},s=function(e){return r(e.clientX)},c=function(e){return r(e.touches[0].clientX)},u=function(e){return e.touches.length||l()},l=function e(){n.play(),a(!1),b(setTimeout((function(){b(!1)}),2600)),document.removeEventListener("pointermove",s),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",u),document.removeEventListener("pointerup",e)};document.addEventListener("pointermove",s),document.addEventListener("touchmove",c),document.addEventListener("touchend",u),document.addEventListener("pointerup",l),r(e.clientX)}}},r.createElement("div",{className:"liveshopping-playback__darken"}),r.createElement("p",{className:"liveshopping-playback__timestamp"},gn(m)+" / "+gn(hn(v))),r.createElement("div",{className:"liveshopping-playback__track",ref:o},r.createElement("div",{className:"liveshopping-playback__progress"}),r.createElement("div",{className:"liveshopping-playback__scrub-wrapper"},r.createElement("div",{className:"liveshopping-playback__scrub"},r.createElement("div",{className:"liveshopping-playback__thumb"}),r.createElement("p",null,gn(m))))))};const wn=function(e){var t,n=(0,se.kq)(),a=(0,i.TH)(),o=a.pathname+a.search,s="true"===new URLSearchParams(a.search).get("watch"),c=(0,re.NQ)().skipDisplayName,u=(0,W.XM)(),p=(0,ut.Z)("loading"),f=Jt((0,i.UO)().showStringAndReferralCode.split("!"),2),h=f[0],g=f[1],b=l.sO.shortStringToUuid(h),w=(0,xt.HY)(null!=b?b:"",{poll:!0}),_=w.show,k=w.setShowMayHaveEnded,I=Jt((0,r.useReducer)((function(e){return e+1}),0),2),C=I[0],S=I[1],N=tn(_,C,(function(e){return e.currentViewers})),A=!1,M=Jt((0,r.useState)("loading"),2),R=M[0],O=M[1],P=Jt((0,W.KS)(0),2),T=P[0],x=P[1];(0,r.useEffect)((function(){"loading"===_||"no such show"===_||"temporary error"===_||"loading"!==R||T||(x(5e3),console.log("Requesting influencer at ".concat((new Date).toISOString())),l.sO.getInfluencerProfile(null,_.handle).then((function(e){u.current&&O(e.influencer)})))}),[R,T,u,x,A,_]);var D=(0,ct.C)(),F=Jt((0,r.useState)(),2),L=F[0],j=F[1],B=Jt((0,W.KS)(0),2),U=B[0],V=B[1],H=Jt((0,r.useState)(2),2),G=H[0],K=H[1],Z=Jt((0,r.useState)(2),2),Q=Z[0],z=Z[1];(0,r.useEffect)((function(){n&&b&&"loading"!==_&&"no such show"!==_&&"temporary error"!==_&&(U||Q<=0||"RUNNING"!==_.state&&"ENDED"!==_.state||(G>0?(V(5e3),K((function(e){return e-1}))):V(2e4),l.sO.hasDiscount(n,b).then((function(e){u.current&&(j(e),"ENDED"===_.state&&z((function(e){return e-1})))}))))}),[Q,U,G,V,_,b,n,u]);var Y,J=Jt((0,r.useState)(),2),X=J[0],$=J[1],ee=tn(_,C,(function(e){if(void 0!==e.featuredItem)return e.featuredItem})),te="loading"!==_&&"no such show"!==_&&"temporary error"!==_?_:{},ne=te.products,ae=te.variants,ie=te.featureMode,oe=(0,q.r6)(ne,ae),ce=(0,r.useMemo)((function(){return oe.some((function(e){return e.loading}))?void 0:oe.filter((function(e){var t=e.product,n=e.variant;return t&&n})).map((function(e){return{product:e.product,variant:e.variant}}))}),[oe]),ue=(0,r.useMemo)((function(){if((void 0===ie||"FIRST_PRODUCT_BY_DEFAULT"===ie)&&oe){var e,t,n=null===(e=oe.find((function(e){var t=e.loading,n=e.variant;return!t&&n})))||void 0===e||null===(t=e.variant)||void 0===t?void 0:t.id;if(n)return{type:"VARIANT",variantId:n}}}),[ie,oe]),le=null!==(t=null!=X?X:ee.value)&&void 0!==t?t:ue,de=(0,r.useMemo)((function(){if("VARIANT"===(null==le?void 0:le.type)){var e=oe.find((function(e){var t=e.variant;return(null==t?void 0:t.id)===le.variantId}))||{},t=e.product,n=e.variant;if(t&&n)return{product:t,variant:n}}}),[le,oe]),pe=Jt((0,r.useState)(),2),ve=pe[0],me=pe[1],fe=(0,r.useMemo)((function(){if(void 0===ve)return de;var e=oe.find((function(e){var t=e.variant;return(null==t?void 0:t.id)===ve}))||{},t=e.product,n=e.variant;return t&&n?{product:t,variant:n}:de}),[de,ve,oe]);Y="loading"!==_&&"no such show"!==_&&"temporary error"!==_?_.state:void 0;var he=(0,W.D9)(Y),ge=Jt((0,r.useState)(!1),2),be=ge[0],ye=ge[1];(0,r.useEffect)((function(){"loading"!==_&&"no such show"!==_&&"temporary error"!==_&&"ENDED"===Y&&"RUNNING"===he&&(d.Z.logShowWatchEnd({show_id:_.id}),ye(!0))}),[_,Y,he,ye]);var we=Jt((0,r.useState)(!1),2),_e=we[0],Ee=we[1];(0,r.useEffect)((function(){"loading"!==_&&"no such show"!==_&&"temporary error"!==_&&!_e&&g&&(l.sO.logShowReferral(n,_.id,{referralCode:g}),Ee(!0))}),[g,_,n,_e]);var ke=Jt((0,r.useState)(!1),2),Ie=ke[0],Ce=ke[1],Se=(0,r.useRef)(!1),Ne=function(e){e&&void 0!==b&&l.sO.logShowViewRecording(n,b),Ce(e),e&&ye(!1)};(0,r.useEffect)((function(){"loading"!==_&&"no such show"!==_&&"temporary error"!==_&&"ENDED"===_.state&&Boolean(_.recordings&&_.chatBaseUrl)&&s&&!Se.current&&(Ne(!0),Se.current=!0)}),[_]);var Ae,Me,Re=(0,E.L)();function Oe(e){return r.createElement("div",{className:"liveshopping-watch__wrapper"},r.createElement("div",{className:"liveshopping-watch__status"},e))}function Pe(e){return Oe(r.createElement("p",null,e))}if("no such show"===_||!b)return Pe((0,m.Iu)("livestream.watch.errors.show.cant_find"));if("loading"===_||"temporary error"===_||"loading"===R||"loading"===D||"loading"===p||void 0===ce)return Oe(r.createElement(yt.g,{alt:"accessibility.loading"}));var Te=(0,l.U6)(_,"FRIEND_REFERRAL"),xe=(0,l.U6)(_,"LIVE_ATTENDANCE");switch(_.state){default:case"UNKNOWN":return Pe((0,m.Iu)("livestream.watch.errors.show.unknown"));case"PENDING":var De="medium";if(Re.requirePreShowSignIn){if(n&&(De="large",!c&&(D.influencer?!D.influencer.handle:!D.displayName)))return r.createElement(se.Bj,{to:(0,bt.oo)(o),mode:"replace"},Oe(r.createElement(yt.g,{alt:"accessibility.loading"})))}else De="large";Ae=r.createElement(pn,{show:_,user:n},r.createElement(st._,{show:_,size:De})),Me=g&&(xe||Te)?{title:"account.sign_up.title_with_discount_with_asterisk",subtitle:null,asterisk:xe?"account.sign_up.attendance_discount_asterisk":"account.sign_up.referral_discount_asterisk"}:Re.signInDefaultTitle;break;case"CANCELLED":return Pe((0,m.Iu)("livestream.watch.errors.show.cancelled"));case"RUNNING":if(g&&(Te||xe)&&!n){Ae=r.createElement(st._,{show:_,size:"medium"}),Me={title:"account.sign_up.title_with_discount_with_asterisk",subtitle:null,asterisk:xe?"account.sign_up.attendance_discount_asterisk":"account.sign_up.referral_discount_asterisk"};break}return r.createElement(vn,{show:_,user:n,myProfile:D,referralCode:g||void 0,influencer:R,hasDiscount:L,variantsAndProducts:ce,setShowMayHaveEnded:k,viewerCount:N,chatSessionCloseCount:C,onChatSessionClosed:S,userVariantAndProduct:fe,hostFeaturedItem:le,setHostLocalFeaturedItem:$,setFeaturedItemFromChat:ee.setValueFromChat,setUserVariantId:me});case"ENDED":if(Ie)return r.createElement(vn,{show:_,user:n,myProfile:D,referralCode:g||void 0,influencer:R,hasDiscount:L,variantsAndProducts:ce,setShowMayHaveEnded:function(){return Ne(!1)},viewerCount:N,chatSessionCloseCount:C,onChatSessionClosed:S,userVariantAndProduct:fe,hostFeaturedItem:le,setHostLocalFeaturedItem:$,setFeaturedItemFromChat:ee.setValueFromChat,setUserVariantId:me,closeStream:function(){return Ne(!1)}});Ae=ce?r.createElement(nn,{show:_,user:n,hasDiscount:L,activeProductAndVariant:fe,variantsAndProducts:ce,setActiveVariantId:me,wasWatchingLive:be,setWatchOnDemand:Ne,watchedShowEnd:be,refreshDiscount:function(){"ENDED"===_.state&&z((function(e){return e+1}))}}):r.createElement(r.Fragment,null),Me={title:"account.sign_up.title_after_stream",subtitle:null,asterisk:null}}var Fe=!n&&(Re.requirePreShowSignIn||g&&(Te||xe))?r.createElement(bt.Mo,{titleAndAsterisk:Me,embeddedInAnotherPage:!0,onCanConfirm:en}):void 0,Le=document.getElementById("react-liveshopping-account-form");return r.createElement(r.Fragment,null,r.createElement("div",{className:"liveshopping-watch__wrapper"},_.publiclyListed&&r.createElement("a",{className:"liveshopping-watch__all-events",href:"/pages/live-shopping"},r.createElement(v.M,{src:y,alt:"Back"}),(0,m.Iu)("livestream.watch.all_events")),Ae,Fe&&r.createElement(Ut.q,{portal:Le,renderInline:!0},Fe)),e.extraShowCardChildren)}}}]);