"use strict";!function(e,r){var i={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return void 0!==e?e.time:0}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(){},onMarkerReached:function(){},markers:[]};r.plugin("markers",function(r){function t(){v.sort(function(e,r){return k.markerTip.time(e)-k.markerTip.time(r)})}function a(r){e.each(r,function(e,r){r.key=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?i:3&i|8).toString(16)})}(),u.find(".vjs-progress-control").append(o(r)),d[r.key]=r,v.push(r)}),t()}function n(e){return k.markerTip.time(e)/p.duration()*100}function o(r){var i=e("<div class='vjs-marker'></div>");return i.css(k.markerStyle).css({"margin-left":-parseFloat(i.css("width"))/2+"px",left:n(r)+"%"}).attr("data-marker-key",r.key).attr("data-marker-time",k.markerTip.time(r)),r.class&&i.addClass(r.class),i.on("click",function(){var i=!1;if("function"==typeof k.onMarkerClick&&(i=0==k.onMarkerClick(r)),!i){var t=e(this).data("marker-key");p.currentTime(k.markerTip.time(d[t]))}}),k.markerTip.display&&function(r){r.on("mouseover",function(){var r=d[e(this).data("marker-key")];x.find(".vjs-tip-inner").text(k.markerTip.text(r)),x.css({left:n(r)+"%","margin-left":-parseFloat(x.css("width"))/2-5+"px",visibility:"visible"})}).on("mouseout",function(){x.css("visibility","hidden")})}(i),i}function s(e){y&&(h=-1,y.css("visibility","hidden")),f=-1;for(var r=0;r<e.length;r++){var i=e[r],a=v[i];a&&(delete d[a.key],v[i]=null,u.find(".vjs-marker[data-marker-key='"+a.key+"']").remove())}for(r=v.length-1;r>=0;r--)null===v[r]&&v.splice(r,1);t()}function l(e){if(!(0>f)){var r=v[f],i=k.markerTip.time(r);e>=i&&e<=i+k.breakOverlay.displayTime?(h!=f&&(h=f,y.find(".vjs-break-overlay-text").text(k.breakOverlay.text(r))),y.css("visibility","visible")):(h=-1,y.css("visibility","hidden"))}}function m(){var e,i=function(e){return e<v.length-1?k.markerTip.time(v[e+1]):p.duration()},t=p.currentTime();if(-1!=f){var a=i(f);if(t>=k.markerTip.time(v[f])&&a>t)return}if(v.length>0&&t<k.markerTip.time(v[0]))e=-1;else for(var n=0;n<v.length;n++)if(a=i(n),t>=k.markerTip.time(v[n])&&a>t){e=n;break}e!=f&&(-1!=e&&r.onMarkerReached&&r.onMarkerReached(v[e]),f=e),k.breakOverlay.display&&l(t)}function c(){k.markerTip.display&&(x=e("<div class='vjs-tip'><div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div></div>"),u.find(".vjs-progress-control").append(x)),p.markers.removeAll(),a(r.markers),k.breakOverlay.display&&(y=e("<div class='vjs-break-overlay'><div class='vjs-break-overlay-text'></div></div>").css(k.breakOverlay.style),u.append(y),h=-1),m(),p.on("timeupdate",m)}var k=e.extend(!0,{},i,r),d={},v=[],u=e(this.el()),f=-1,p=this,x=null,y=null,h=-1;p.on("loadedmetadata",function(){c()}),p.markers={getMarkers:function(){return v},next:function(){for(var e=p.currentTime(),r=0;r<v.length;r++){var i=k.markerTip.time(v[r]);if(i>e){p.currentTime(i);break}}},prev:function(){for(var e=p.currentTime(),r=v.length-1;r>=0;r--){var i=k.markerTip.time(v[r]);if(e>i+.5){p.currentTime(i);break}}},add:function(e){a(e)},remove:function(e){s(e)},removeAll:function(){for(var e=[],r=0;r<v.length;r++)e.push(r);s(e)},updateTime:function(){!function(){for(var e=0;e<v.length;e++){var r=v[e],i=u.find(".vjs-marker[data-marker-key='"+r.key+"']"),a=k.markerTip.time(r);i.data("marker-time")!=a&&i.css({left:n(r)+"%"}).attr("data-marker-time",a)}t()}()},reset:function(e){p.markers.removeAll(),a(e)},destroy:function(){p.markers.removeAll(),y.remove(),x.remove(),p.off("timeupdate",l),delete p.markers}}})}(jQuery,window.videojs);