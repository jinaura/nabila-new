(self.webpackChunkrose_inc_web=self.webpackChunkrose_inc_web||[]).push([[204],{78320:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(23922);t.default=class{constructor(e,t,i,s=1e3,o=200){this.realtimeController=e,this.selfAttendeeId=t,this.hasBandwidthPriorityCallback=i,this.waitIntervalMs=s,this.updateIntervalMs=o,this.speakerScores={},this.speakerMuteState={},this.detectorCallbackToHandler=new Map,this.detectorCallbackToScoresTimer=new Map,this.detectorCallbackToActivityTimer=new Map,this.hasBandwidthPriority=!1,this.mostRecentUpdateTimestamp={}}needUpdate(e){return!this.activeSpeakers||(0===this.speakerScores[e]&&this.activeSpeakers.includes(e)||this.speakerScores[e]>0&&!this.activeSpeakers.includes(e))}updateActiveSpeakers(e,t,i){if(!this.needUpdate(i))return;const s=[],o=Object.keys(this.speakerScores);for(let e=0;e<o.length;e++){const t=o[e];s.push({attendeeId:t,activeScore:this.speakerScores[t]})}const n=s.sort(((e,t)=>t.activeScore-e.activeScore)).filter((function(e){return e.activeScore>0})).map((function(e){return e.attendeeId}));this.activeSpeakers=n,t(n);const r=n.length>0&&n[0]===this.selfAttendeeId&&e.prioritizeVideoSendBandwidthForActiveSpeaker();this.hasBandwidthPriority!==r&&(this.hasBandwidthPriority=r,this.hasBandwidthPriorityCallback(r))}updateScore(e,t,i,s,o){const n=e.calculateScore(i,s,o);this.speakerScores[i]!==n&&(this.speakerScores[i]=n,this.mostRecentUpdateTimestamp[i]=Date.now(),this.updateActiveSpeakers(e,t,i))}subscribe(e,t,i,s){const n=(i,s)=>{if(!s)return this.speakerScores[i]=0,this.mostRecentUpdateTimestamp[i]=Date.now(),void this.updateActiveSpeakers(e,t,i);this.realtimeController.realtimeSubscribeToVolumeIndicator(i,((i,s,o,n)=>{this.mostRecentUpdateTimestamp[i]=Date.now(),null!==o&&(this.speakerMuteState[i]=o),this.updateScore(e,t,i,s,o)}))};this.detectorCallbackToHandler.set(t,n);const r=new o.default(this.updateIntervalMs);if(r.start((()=>{for(const i in this.speakerScores)Date.now()-this.mostRecentUpdateTimestamp[i]>this.waitIntervalMs&&this.updateScore(e,t,i,0,this.speakerMuteState[i])})),this.detectorCallbackToActivityTimer.set(t,r),i&&s){const e=new o.default(s);e.start((()=>{i(this.speakerScores)})),this.detectorCallbackToScoresTimer.set(t,e)}this.realtimeController.realtimeSubscribeToAttendeeIdPresence(n)}unsubscribe(e){const t=this.detectorCallbackToHandler.get(e);this.detectorCallbackToHandler.delete(e),t&&this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(t);const i=this.detectorCallbackToActivityTimer.get(e);i&&(i.stop(),this.detectorCallbackToActivityTimer.delete(e));const s=this.detectorCallbackToScoresTimer.get(e);s&&(s.stop(),this.detectorCallbackToHandler.delete(e))}destroy(){return s(this,void 0,void 0,(function*(){for(const e of this.detectorCallbackToHandler.values())this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e);for(const e of this.detectorCallbackToActivityTimer.values())e.stop();for(const e of this.detectorCallbackToScoresTimer.values())e.stop();this.detectorCallbackToHandler.clear(),this.detectorCallbackToActivityTimer.clear(),this.detectorCallbackToScoresTimer.clear()}))}}},42363:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e=.9,t=.01,i=.2,s=.2){this.speakerWeight=e,this.cutoffThreshold=t,this.silenceThreshold=i,this.takeoverRate=s,this.volumes={}}calculateScore(e,t,i){(i||null===t)&&(t=0),this.volumes.hasOwnProperty(e)||(this.volumes[e]=0),t=t>this.silenceThreshold?1:0;const s=this.volumes[e]*this.speakerWeight+t*(1-this.speakerWeight);this.volumes[e]=s;for(const i in this.volumes)i!==e&&(this.volumes[i]=Math.max(this.volumes[i]-this.takeoverRate*t,0));return s<this.cutoffThreshold?0:s}prioritizeVideoSendBandwidthForActiveSpeaker(){return!0}}},37535:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.appName=e,this.appVersion=t}static create(e,t){const s=/^[a-zA-Z0-9]+[a-zA-Z0-9_-]*[a-zA-Z0-9]+$/g;if(!e||e.length>32)throw new Error("appName should be a valid string and 1 to 32 characters in length");if(!s.test(e))throw new Error(`appName must satisfy ${s} regular expression`);if(!t||t.length>32)throw new Error("appVersion should be a valid string and 1 to 32 characters in length");if(!/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/gm.test(t))throw new Error("appVersion must satisfy Semantic Versioning format");return new i(e,t)}}t.default=i},47602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},96802:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(90543),n=i(37797);t.default=class{constructor(e){this.logger=e,this.audioDevice=null,this.audioElement=null,this.audioStream=null,this.browserBehavior=new o.default,this.observers=new Set}bindAudioElement(e){return s(this,void 0,void 0,(function*(){if(!e)throw new Error(`Cannot bind audio element: ${e}`);return this.audioElement=e,this.audioElement.autoplay=!0,this.bindAudioMix()}))}unbindAudioElement(){this.audioElement&&(this.audioElement.srcObject=null,this.audioElement=null,this.forEachObserver((e=>{this.audioStream&&e.meetingAudioStreamBecameInactive(this.audioStream)})))}bindAudioStream(e){return s(this,void 0,void 0,(function*(){if(e){this.audioStream=e;try{yield this.bindAudioMix()}catch(e){this.logger&&this.logger.warn(`Failed to bind audio stream: ${e}`)}}}))}bindAudioDevice(e){return s(this,void 0,void 0,(function*(){if(e&&!this.browserBehavior.supportsSetSinkId())throw new Error("Cannot select audio output device. This browser does not support setSinkId.");return this.audioDevice=e,this.bindAudioMix()}))}forEachObserver(e){for(const t of this.observers)n.default.nextTick((()=>{e(t)}))}bindAudioMix(){var e,t;return s(this,void 0,void 0,(function*(){if(!this.audioElement)return;const i=this.audioElement.srcObject;this.audioStream&&(this.audioElement.srcObject=this.audioStream),i!==this.audioStream&&this.forEachObserver((e=>{i&&e.meetingAudioStreamBecameInactive(i),this.audioStream&&e.meetingAudioStreamBecameActive(this.audioStream)}));const s=(null===(e=this.audioDevice)||void 0===e?void 0:e.deviceId)!==this.audioElement.sinkId;if(s&&void 0===this.audioElement.sinkId)throw new Error("Cannot select audio output device. This browser does not support setSinkId.");const o=this.audioDevice?this.audioDevice.deviceId:"";if(o===this.audioElement.sinkId)return;const n=this.audioElement,r=this.audioStream;if(this.browserBehavior.hasChromiumWebRTC()&&(n.srcObject=null),s)try{yield n.setSinkId(o)}catch(e){throw null===(t=this.logger)||void 0===t||t.error(`Failed to set sinkId for audio element: ${e}`),e}this.browserBehavior.hasChromiumWebRTC()&&(n.srcObject=r)}))}getCurrentMeetingAudioStream(){return s(this,void 0,void 0,(function*(){return this.audioStream}))}addAudioMixObserver(e){return s(this,void 0,void 0,(function*(){this.observers.add(e)}))}removeAudioMixObserver(e){return s(this,void 0,void 0,(function*(){this.observers.delete(e)}))}}},23765:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e=null){this.audioBitrateBps=e}static fullbandSpeechMono(){return new i(4e4)}static fullbandMusicMono(){return new i(64e3)}static fullbandMusicStereo(){return new i(128e3)}isStereo(){return 128e3===this.audioBitrateBps}}t.default=i},31876:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.logger=null,this.browserBehavior=null,this.signalingClient=null,this.meetingSessionConfiguration=null,this.peer=null,this.previousSdpOffer=null,this.sdpOfferInit=null,this.audioVideoController=null,this.realtimeController=null,this.videoTileController=null,this.mediaStreamBroker=null,this.audioMixController=null,this.activeAudioInput=null,this.activeVideoInput=null,this.transceiverController=null,this.indexFrame=null,this.iceCandidates=[],this.iceCandidateHandler=null,this.iceGatheringStateEventHandler=null,this.sdpAnswer=null,this.turnCredentials=null,this.reconnectController=null,this.removableObservers=[],this.audioProfile=null,this.videoStreamIndex=null,this.videoDownlinkBandwidthPolicy=null,this.videoUplinkBandwidthPolicy=null,this.lastKnownVideoAvailability=null,this.videoCaptureAndEncodeParameter=null,this.videosToReceive=null,this.lastVideosToReceive=null,this.videoSubscriptions=null,this.videoSubscriptionLimit=25,this.previousSdpAnswerAsString="",this.serverSupportsCompression=!1,this.videosPaused=null,this.videoDuplexMode=null,this.volumeIndicatorAdapter=null,this.statsCollector=null,this.connectionMonitor=null,this.videoInputAttachedTimestampMs=0,this.audioDeviceInformation={},this.videoDeviceInformation={},this.enableSimulcast=!1,this.eventController=null,this.signalingOpenDurationMs=null,this.iceGatheringDurationMs=null,this.startAudioVideoTimestamp=null,this.attendeePresenceDurationMs=null,this.meetingStartDurationMs=null,this.poorConnectionCount=0,this.maxVideoTileCount=0,this.startTimeMs=null}}},9059:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(78320),n=i(96802),r=i(23765),a=i(90543),d=i(66688),l=i(68581),c=i(13789),u=i(25687),h=i(5723),m=i(97500),v=i(70983),f=i(37797),g=i(19678),p=i(13860),S=i(79553),C=i(93013),b=i(41208),y=i(99416),w=i(9101),M=i(20289),I=i(9636),T=i(2628),D=i(53216),E=i(47408),k=i(5054),A=i(21129),O=i(26240),P=i(21960),x=i(96180),R=i(2748),V=i(11981),_=i(94543),B=i(28556),L=i(51209),U=i(25547),N=i(120),F=i(39560),$=i(88797),W=i(99485),j=i(47079),H=i(64833),z=i(25275),K=i(95924),J=i(90250),G=i(6171),Q=i(50365),q=i(5785),Y=i(79354),X=i(28660),Z=i(51133),ee=i(75185),te=i(12880),ie=i(91508),se=i(91318),oe=i(34242),ne=i(42958),re=i(94922),ae=i(24450),de=i(4442),le=i(99751),ce=i(31876);class ue{constructor(e,t,i,s,o,l){this._audioProfile=new r.default,this.connectionHealthData=new d.default,this.observerQueue=new Set,this.meetingSessionContext=new ce.default,this.enableSimulcast=!1,this.useUpdateTransceiverControllerForUplink=!1,this.totalRetryCount=0,this.startAudioVideoTimestamp=0,this.mayNeedRenegotiationForSimulcastLayerChange=!1,this.receiveIndexTask=void 0,this.monitorTask=void 0,this.destroyed=!1,this.usePromises=!0,this._logger=t,this.sessionStateController=new g.default(this._logger),this._configuration=e,this.enableSimulcast=e.enableSimulcastForUnifiedPlanChromiumBasedBrowsers&&(new a.default).hasChromiumWebRTC(),this._webSocketAdapter=i,this._realtimeController=new v.default,this._realtimeController.realtimeSetLocalAttendeeId(e.credentials.attendeeId,e.credentials.externalUserId),this._mediaStreamBroker=s,this._reconnectController=o,this._videoTileController=new ne.default(new re.default,this,this._logger),this._audioMixController=new n.default(this._logger),this.meetingSessionContext.logger=this._logger,this._eventController=l}destroy(){return s(this,void 0,void 0,(function*(){this.observerQueue.clear(),this.destroyed=!0}))}get configuration(){return this._configuration}get realtimeController(){return this._realtimeController}get activeSpeakerDetector(){return this._activeSpeakerDetector||(this._activeSpeakerDetector=new o.default(this._realtimeController,this._configuration.credentials.attendeeId,this.handleHasBandwidthPriority.bind(this))),this._activeSpeakerDetector}get videoTileController(){return this._videoTileController}get audioMixController(){return this._audioMixController}get logger(){return this._logger}get rtcPeerConnection(){return this.meetingSessionContext&&this.meetingSessionContext.peer||null}get mediaStreamBroker(){return this._mediaStreamBroker}get eventController(){return this._eventController}getRTCPeerConnectionStats(e){return this.logger.warn("The `getRTCPeerConnectionStats()` is on its way to be deprecated. Please use the new API `clientMetricReport.getRTCStatsReport()` returned by `metricsDidReceive(clientMetricReport)` callback instead. It makes an additional call to the `getStats` API and therefore may cause slight performance degradation."),this.rtcPeerConnection?this.rtcPeerConnection.getStats(e):null}setAudioProfile(e){this._audioProfile=e}addObserver(e){this.logger.info("adding meeting observer"),this.observerQueue.add(e)}removeObserver(e){this.logger.info("removing meeting observer"),this.observerQueue.delete(e)}forEachObserver(e){for(const t of this.observerQueue)f.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}initSignalingClient(){this.meetingSessionContext.signalingClient||(this.connectionHealthData.reset(),this.meetingSessionContext=new ce.default,this.meetingSessionContext.logger=this.logger,this.meetingSessionContext.eventController=this.eventController,this.meetingSessionContext.browserBehavior=new a.default,this.meetingSessionContext.meetingSessionConfiguration=this.configuration,this.meetingSessionContext.signalingClient=new b.default(this._webSocketAdapter,this.logger))}uninstallPreStartObserver(){this.meetingSessionContext.signalingClient.removeObserver(this.preStartObserver),this.preStartObserver=void 0}prestart(){return this.logger.info("Pre-connecting signaling connection."),this.createOrReuseSignalingTask().run().then((()=>{const e=()=>s(this,void 0,void 0,(function*(){this.logger.info("Early connection closed; discarding signaling task."),this.signalingTask=void 0,this.uninstallPreStartObserver()}));this.preStartObserver={handleSignalingClientEvent(t){t.type===y.default.WebSocketClosed&&e()}},this.meetingSessionContext.signalingClient.registerObserver(this.preStartObserver)})).catch((e=>{this.logger.error(`Signaling task pre-start failed: ${e}`),this.signalingTask=void 0}))}start(e){this.startReturningPromise(e).then((()=>{this.logger.info("start completed")})).catch((e=>{this.logger.error(`start failed: ${e}`)}))}startReturningPromise(e){return!0===(null==e?void 0:e.signalingOnly)?this.prestart():(this.activeSpeakerDetector,new Promise(((e,t)=>{this.sessionStateController.perform(p.default.Connect,(()=>{this.actionConnect(!1).then(e).catch(t)}))})))}connectWithPromises(e){const t=this.meetingSessionContext;this.monitorTask=new V.default(t,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData);const i=this.monitorTask.once(),s=new L.default(t).once();this.receiveIndexTask=new F.default(t),this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();const o=new j.default(this.logger,"Signaling",[this.createOrReuseSignalingTask(),new R.default(t),new W.default(t),new P.default(t),new U.default(t),this.receiveIndexTask]).once(),n=new k.default(t).once(o),r=new T.default(t).once(n,s),a=new A.default(t).once(r),d=new H.default(t).once(a),l=new O.default(t).once(d),c=new K.default(t).once(l);return new j.default(this.logger,this.wrapTaskName("AudioVideoStart"),[i,((e,t)=>new J.default(this.logger,t,e))(this.configuration.connectionTimeoutMs,new j.default(this.logger,"Peer",[c,e?new J.default(this.logger,new B.default(this.logger,"FinalizeConnection",[new G.default(t),new z.default(t)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new z.default(t)]))])}connectWithTasks(e){return this.receiveIndexTask=new F.default(this.meetingSessionContext),this.monitorTask=new V.default(this.meetingSessionContext,this.configuration.connectionHealthPolicyConfiguration,this.connectionHealthData),this.receiveIndexTask.pauseIngestion(),this.monitorTask.pauseResubscribeCheck(),new j.default(this.logger,this.wrapTaskName("AudioVideoStart"),[this.monitorTask,new L.default(this.meetingSessionContext),new J.default(this.logger,new j.default(this.logger,"Media",[new j.default(this.logger,"Signaling",[new _.default(this.meetingSessionContext),new R.default(this.meetingSessionContext),new W.default(this.meetingSessionContext),new P.default(this.meetingSessionContext),new U.default(this.meetingSessionContext),this.receiveIndexTask]),new j.default(this.logger,"Peer",[new k.default(this.meetingSessionContext),new T.default(this.meetingSessionContext),new A.default(this.meetingSessionContext),new H.default(this.meetingSessionContext),new O.default(this.meetingSessionContext),new K.default(this.meetingSessionContext),e?new J.default(this.logger,new B.default(this.logger,"FinalizeConnection",[new G.default(this.meetingSessionContext),new z.default(this.meetingSessionContext)]),this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs):new z.default(this.meetingSessionContext)])]),this.configuration.connectionTimeoutMs)])}actionConnect(e){var t;return s(this,void 0,void 0,(function*(){this.initSignalingClient(),this.uninstallPreStartObserver(),this.meetingSessionContext.mediaStreamBroker=this._mediaStreamBroker,this.meetingSessionContext.realtimeController=this._realtimeController,this.meetingSessionContext.audioMixController=this._audioMixController,this.meetingSessionContext.audioVideoController=this;const i=!!this.configuration.urls.audioHostURL;if(i?this.enableSimulcast?(this.logger.info("Using transceiver controller with simulcast support"),this.meetingSessionContext.transceiverController=new q.default(this.logger,this.meetingSessionContext.browserBehavior)):(this.logger.info("Using default transceiver controller"),this.meetingSessionContext.transceiverController=new Q.default(this.logger,this.meetingSessionContext.browserBehavior)):(this.logger.info("Using video only transceiver controller"),this.meetingSessionContext.transceiverController=new Y.default(this.logger,this.meetingSessionContext.browserBehavior)),this.meetingSessionContext.volumeIndicatorAdapter=new le.default(this.logger,this._realtimeController,ue.MIN_VOLUME_DECIBELS,ue.MAX_VOLUME_DECIBELS,this.configuration.credentials.attendeeId),this.meetingSessionContext.videoTileController=this._videoTileController,this.meetingSessionContext.videoDownlinkBandwidthPolicy=this.configuration.videoDownlinkBandwidthPolicy,this.meetingSessionContext.videoUplinkBandwidthPolicy=this.configuration.videoUplinkBandwidthPolicy,this.meetingSessionContext.enableSimulcast=this.enableSimulcast,this.enableSimulcast){let e=this.meetingSessionContext.videoUplinkBandwidthPolicy;e||(e=new ae.default(this.configuration.credentials.attendeeId,this.meetingSessionContext.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy=e),e.addObserver(this),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new te.default(this.meetingSessionContext.logger)),this.meetingSessionContext.videoStreamIndex=new oe.default(this.logger)}else this.meetingSessionContext.enableSimulcast=!1,this.meetingSessionContext.videoStreamIndex=new se.default(this.logger),this.meetingSessionContext.videoUplinkBandwidthPolicy||(this.meetingSessionContext.videoUplinkBandwidthPolicy=new de.default(this.configuration.credentials.attendeeId,!this.meetingSessionContext.browserBehavior.disableResolutionScaleDown(),this.meetingSessionContext.logger,this.meetingSessionContext.browserBehavior)),this.meetingSessionContext.videoDownlinkBandwidthPolicy||(this.meetingSessionContext.videoDownlinkBandwidthPolicy=new ee.default(this.configuration.credentials.attendeeId)),this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController&&this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController&&(this.useUpdateTransceiverControllerForUplink=!0,this.meetingSessionContext.videoUplinkBandwidthPolicy.setTransceiverController(this.meetingSessionContext.transceiverController)),this.meetingSessionContext.audioProfile=this._audioProfile;this.meetingSessionContext.videoUplinkBandwidthPolicy&&this.maxUplinkBandwidthKbps&&this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(this.maxUplinkBandwidthKbps),this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController&&this.meetingSessionContext.videoDownlinkBandwidthPolicy.bindToTileController(this._videoTileController),this.meetingSessionContext.lastKnownVideoAvailability=new h.default,this.meetingSessionContext.videoCaptureAndEncodeParameter=new Z.default(0,0,0,0,!1),this.meetingSessionContext.videosToReceive=new ie.default,this.meetingSessionContext.videosPaused=new ie.default,this.meetingSessionContext.statsCollector=new I.default(this,this.logger),this.meetingSessionContext.connectionMonitor=new l.default(this,this._realtimeController,this._videoTileController,this.connectionHealthData,new m.default(this.meetingSessionContext.signalingClient,ue.PING_PONG_INTERVAL_MS,this.logger),this.meetingSessionContext.statsCollector),this.meetingSessionContext.reconnectController=this._reconnectController,this.meetingSessionContext.videoDeviceInformation={},e||(this.totalRetryCount=0,this._reconnectController.reset(),this.startAudioVideoTimestamp=Date.now(),this.forEachObserver((e=>{X.Maybe.of(e.audioVideoDidStartConnecting).map((t=>t.bind(e)(!1)))})),null===(t=this.eventController)||void 0===t||t.publishEvent("meetingStartRequested")),this.meetingSessionContext.startAudioVideoTimestamp=this.startAudioVideoTimestamp,this._reconnectController.hasStartedConnectionAttempt()?this._reconnectController.startedConnectionAttempt(!1):this._reconnectController.startedConnectionAttempt(!0);const o=i&&this.meetingSessionContext.meetingSessionConfiguration.attendeePresenceTimeoutMs>0;let n;this.logger.info("Needs to wait for attendee presence? "+o),n=this.usePromises?this.connectWithPromises(o):this.connectWithTasks(o);try{yield n.run(),this.connectionHealthData.setConnectionStartTime(),this.sessionStateController.perform(p.default.FinishConnecting,(()=>{this.eventController&&(this.meetingSessionContext.meetingStartDurationMs=Date.now()-this.startAudioVideoTimestamp,this.eventController.publishEvent("meetingStartSucceeded",{maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,poorConnectionCount:this.meetingSessionContext.poorConnectionCount,retryCount:this.totalRetryCount,signalingOpenDurationMs:this.meetingSessionContext.signalingOpenDurationMs,iceGatheringDurationMs:this.meetingSessionContext.iceGatheringDurationMs,meetingStartDurationMs:this.meetingSessionContext.meetingStartDurationMs})),this.meetingSessionContext.startTimeMs=Date.now(),this.actionFinishConnecting()}))}catch(e){this.signalingTask=void 0;const t=new c.default(this.getMeetingStatusCode(e)||u.default.TaskFailed);if(this.logger.info(`Start failed: ${t} due to error ${e}.`),this.sessionStateController.state()===S.default.NotConnected)return void this.logger.info("Start failed and not connected. Not cleaning up.");this.sessionStateController.perform(p.default.Fail,(()=>s(this,void 0,void 0,(function*(){yield this.actionDisconnect(t,!0,e),this.handleMeetingSessionStatus(t,e)||this.notifyStop(t,e)}))))}}))}createOrReuseSignalingTask(){return this.signalingTask||(this.initSignalingClient(),this.signalingTask=new J.default(this.logger,new _.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs).once()),this.signalingTask}actionFinishConnecting(){this.signalingTask=void 0,this.meetingSessionContext.videoDuplexMode=M.SdkStreamServiceType.RX,this.meetingSessionContext.enableSimulcast||(this.useUpdateTransceiverControllerForUplink?this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController():this.enforceBandwidthLimitationForSender(this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0])),this.forEachObserver((e=>{X.Maybe.of(e.audioVideoDidStart).map((t=>t.bind(e)()))})),this._reconnectController.reset(),this.receiveIndexTask.resumeIngestion(),this.monitorTask.resumeResubscribeCheck()}stopReturningPromise(){var e;return this.sessionStateController.state()===S.default.NotConnected?(null===(e=this.meetingSessionContext.signalingClient)||void 0===e||e.closeConnection(),new $.default(this.meetingSessionContext).run()):new Promise(((e,t)=>{this.sessionStateController.perform(p.default.Disconnect,(()=>{this._reconnectController.disableReconnect(),this.logger.info("attendee left meeting, session will not be reconnected"),this.actionDisconnect(new c.default(u.default.Left),!1,null).then(e).catch(t)}))}))}stop(){this.stopReturningPromise()}actionDisconnect(e,t,i){return s(this,void 0,void 0,(function*(){try{yield new j.default(this.logger,this.wrapTaskName("AudioVideoStop"),[new J.default(this.logger,new x.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)]).run()}catch(e){this.logger.info("fail to stop")}try{const e=[new J.default(this.logger,new E.default(this.meetingSessionContext),this.configuration.connectionTimeoutMs)];t||e.push(new $.default(this.meetingSessionContext)),yield new j.default(this.logger,this.wrapTaskName("AudioVideoClean"),e).run()}catch(e){this.logger.info("fail to clean")}this.sessionStateController.perform(p.default.FinishDisconnecting,(()=>{t||this.notifyStop(e,i)}))}))}update(e={needsRenegotiation:!0}){let t=e.needsRenegotiation;if(t||(t=void 0===this.meetingSessionContext.peer),t||(t=!this.updateRemoteVideosFromLastVideosToReceive()),t||(t=!this.updateLocalVideoFromPolicy()),this.meetingSessionContext.lastVideosToReceive=this.meetingSessionContext.videosToReceive,!t)return this.logger.info("Update request does not require resubscribe"),this.actionFinishUpdating(),!0;this.logger.info("Update request requires resubscribe");const i=this.sessionStateController.perform(p.default.Update,(()=>{this.actionUpdateWithRenegotiation(!0)}));return i===C.default.Transitioned||i===C.default.DeferredTransition}updateRemoteVideosFromLastVideosToReceive(){var e,t;const i=this.meetingSessionContext;if((null===(e=i.videosToReceive)||void 0===e?void 0:e.empty())||(null===(t=i.lastVideosToReceive)||void 0===t?void 0:t.empty()))return!1;if(!(i.transceiverController&&i.transceiverController.getMidForStreamId&&i.transceiverController.setStreamIdForMid&&i.videosToReceive.forEach&&i.signalingClient.remoteVideoUpdate&&i.videoStreamIndex.overrideStreamIdMappings))return!1;let s=[];const o=new Map;let n=[];if(null===i.lastVideosToReceive)s=i.videosToReceive.array();else{const e=i.videoStreamIndex;i.videosToReceive.forEach((t=>{if(i.lastVideosToReceive.contain(t))return;let n=!1;i.lastVideosToReceive.forEach((i=>{n||e.StreamIdsInSameGroup(i,t)&&(o.set(i,t),n=!0)})),n||s.push(t)})),n=i.lastVideosToReceive.array().filter((e=>{const t=i.videosToReceive.contain(e),s=o.has(e);return!t&&!s}))}this.logger.info(`Request to update remote videos with added: ${s}, updated: ${[...o.entries()]}, removed: ${n}`);const r=[];for(const[e,t]of o.entries()){const s=new w.default;if(s.streamId=t,s.attendeeId=i.videoStreamIndex.attendeeIdForStreamId(t),s.mid=i.transceiverController.getMidForStreamId(e),void 0===s.mid)return this.logger.info(`No MID found for stream ID ${e}, cannot update stream without renegotiation`),!1;if(r.push(s),i.transceiverController.setStreamIdForMid(s.mid,t),i.videoStreamIndex.overrideStreamIdMappings(e,t),i.videoTileController.haveVideoTileForAttendeeId(s.attendeeId)){const e=i.videoTileController.getVideoTileForAttendeeId(s.attendeeId);if(!e.setStreamId)return!1;e.setStreamId(t)}}return 0!==r.length&&i.signalingClient.remoteVideoUpdate(r,[]),0===s.length&&0===n.length}updateLocalVideoFromPolicy(){if(this.meetingSessionContext.enableSimulcast){const e=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseEncodingParameters();if(this.mayNeedRenegotiationForSimulcastLayerChange&&!this.negotiatedBitrateLayersAllocationRtpHeaderExtension())return this.logger.info("Needs regenotiation for local video simulcast layer change"),this.mayNeedRenegotiationForSimulcastLayerChange=!1,!1;this.meetingSessionContext.transceiverController.setEncodingParameters(e)}else this.meetingSessionContext.videoCaptureAndEncodeParameter=this.meetingSessionContext.videoUplinkBandwidthPolicy.chooseCaptureAndEncodeParameters();return this.logger.info("Updated local video from policy without renegotiation"),!0}negotiatedBitrateLayersAllocationRtpHeaderExtension(){if(!this.meetingSessionContext.transceiverController.localVideoTransceiver())return!1;const e=this.meetingSessionContext.transceiverController.localVideoTransceiver().sender.getParameters();return!(!e||!e.headerExtensions)&&e.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00"===e.uri))}restartLocalVideo(e){const t=()=>s(this,void 0,void 0,(function*(){this._videoTileController.hasStartedLocalVideoTile()&&(this.logger.info("stopping local video tile prior to local video restart"),this._videoTileController.stopLocalVideoTile(),this.logger.info("preparing local video restart update"),yield this.actionUpdateWithRenegotiation(!1),this.logger.info("starting local video tile for local video restart"),this._videoTileController.startLocalVideoTile()),this.logger.info("finalizing local video restart update"),yield this.actionUpdateWithRenegotiation(!0),e()})),i=this.sessionStateController.perform(p.default.Update,(()=>{t()}));return i===C.default.Transitioned||i===C.default.DeferredTransition}replaceLocalVideo(){return s(this,void 0,void 0,(function*(){let e=null;try{e=yield this.mediaStreamBroker.acquireVideoInputStream()}catch(e){throw new Error(`could not acquire video stream from mediaStreamBroker due to ${e.message}`)}if(!e||e.getVideoTracks().length<1)throw new Error("could not acquire video track");const t=e.getVideoTracks()[0];if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");yield this.meetingSessionContext.transceiverController.setVideoInput(t);const i=this.meetingSessionContext.videoTileController.getLocalVideoTile();if(i){const t=i.state(),s=e.getVideoTracks()[0].getSettings();i.bindVideoStream(t.boundAttendeeId,!0,e,s.width,s.height,t.streamId,t.boundExternalUserId)}this.meetingSessionContext.activeVideoInput=e}))}restartLocalAudio(e){return s(this,void 0,void 0,(function*(){let t=null;try{t=yield this.mediaStreamBroker.acquireAudioInputStream()}catch(e){this.logger.info("could not acquire audio stream from mediaStreamBroker")}if(!t||t.getAudioTracks().length<1)throw new Error("could not acquire audio track");this.connectionHealthData.reset(),this.connectionHealthData.setConnectionStartTime();const i=t.getAudioTracks()[0];if(!this.meetingSessionContext||!this.meetingSessionContext.peer)throw new Error("no active meeting and peer connection");let s=!1;return s=yield this.meetingSessionContext.transceiverController.replaceAudioTrack(i),this._realtimeController.realtimeSetLocalAudioInput(t),this.meetingSessionContext.activeAudioInput=t,e(),s?Promise.resolve():Promise.reject()}))}actionUpdateWithRenegotiation(e){return s(this,void 0,void 0,(function*(){this.monitorTask.pauseResubscribeCheck(),this.receiveIndexTask.pauseIngestion();try{yield new j.default(this.logger,this.wrapTaskName("AudioVideoUpdate"),[new N.default(this.meetingSessionContext),new J.default(this.logger,new j.default(this.logger,"UpdateSession",[new T.default(this.meetingSessionContext),new A.default(this.meetingSessionContext),new H.default(this.meetingSessionContext),new O.default(this.meetingSessionContext),new K.default(this.meetingSessionContext),new z.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),e&&this.sessionStateController.perform(p.default.FinishUpdating,(()=>{this.actionFinishUpdating()}))}catch(e){this.sessionStateController.perform(p.default.FinishUpdating,(()=>{const t=new c.default(this.getMeetingStatusCode(e)||u.default.TaskFailed);t.statusCode()!==u.default.IncompatibleSDP&&this.logger.info("failed to update audio-video session"),this.handleMeetingSessionStatus(t,e)}))}}))}notifyStop(e,t){var i;if(this.forEachObserver((t=>{X.Maybe.of(t.audioVideoDidStop).map((i=>i.bind(t)(e)))})),this.eventController){const{signalingOpenDurationMs:s,poorConnectionCount:o,startTimeMs:n,iceGatheringDurationMs:r,attendeePresenceDurationMs:a,meetingStartDurationMs:d}=this.meetingSessionContext,l={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:null===n?0:Math.round(Date.now()-n),meetingStatus:u.default[e.statusCode()],signalingOpenDurationMs:s,iceGatheringDurationMs:r,attendeePresenceDurationMs:a,poorConnectionCount:o,meetingStartDurationMs:d,retryCount:this.totalRetryCount},c=t&&t.message||(null===(i=e.toString)||void 0===i?void 0:i.call(e))||"";0===l.meetingDurationMs?(l.meetingErrorMessage=c,delete l.meetingDurationMs,delete l.attendeePresenceDurationMs,delete l.meetingStartDurationMs,this.eventController.publishEvent("meetingStartFailed",l)):e.isFailure()||e.isAudioConnectionFailure()?(l.meetingErrorMessage=c,this.eventController.publishEvent("meetingFailed",l)):this.eventController.publishEvent("meetingEnded",l)}}actionFinishUpdating(){if(!this.meetingSessionContext.enableSimulcast)if(this.useUpdateTransceiverControllerForUplink)this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController();else{const e=this.meetingSessionContext.videoCaptureAndEncodeParameter.encodeBitrates()[0];this.enforceBandwidthLimitationForSender(e)}this.monitorTask.resumeResubscribeCheck(),this.receiveIndexTask.resumeIngestion(),this.logger.info("updated audio-video session")}reconnect(e,t){const i=this._reconnectController.retryWithBackoff((()=>s(this,void 0,void 0,(function*(){this.sessionStateController.state()===S.default.NotConnected?this.sessionStateController.perform(p.default.Connect,(()=>{this.actionConnect(!0)})):this.sessionStateController.perform(p.default.Reconnect,(()=>{this.actionReconnect(e)})),this.totalRetryCount+=1}))),(()=>{this.logger.info("canceled retry")}));return i||this.sessionStateController.perform(p.default.Fail,(()=>{this.actionDisconnect(e,!1,t)})),i}actionReconnect(e){return s(this,void 0,void 0,(function*(){this._reconnectController.hasStartedConnectionAttempt()||(this._reconnectController.startedConnectionAttempt(!1),this.forEachObserver((e=>{X.Maybe.of(e.audioVideoDidStartConnecting).map((t=>t.bind(e)(!0)))}))),this.meetingSessionContext.volumeIndicatorAdapter.onReconnect(),this.connectionHealthData.reset();try{yield new j.default(this.logger,this.wrapTaskName("AudioVideoReconnect"),[new J.default(this.logger,new j.default(this.logger,"Media",[new D.default(this.meetingSessionContext),new j.default(this.logger,"Signaling",[new _.default(this.meetingSessionContext),new P.default(this.meetingSessionContext),new U.default(this.meetingSessionContext)]),new k.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs),new N.default(this.meetingSessionContext),new J.default(this.logger,new j.default(this.logger,"UpdateSession",[new T.default(this.meetingSessionContext),new A.default(this.meetingSessionContext),new H.default(this.meetingSessionContext),new O.default(this.meetingSessionContext),new K.default(this.meetingSessionContext),new z.default(this.meetingSessionContext)]),this.configuration.connectionTimeoutMs)]).run(),this.sessionStateController.perform(p.default.FinishConnecting,(()=>{if(this.eventController){const{signalingOpenDurationMs:t,poorConnectionCount:i,startTimeMs:s,iceGatheringDurationMs:o,attendeePresenceDurationMs:n,meetingStartDurationMs:r}=this.meetingSessionContext,a={maxVideoTileCount:this.meetingSessionContext.maxVideoTileCount,meetingDurationMs:Math.round(Date.now()-s),meetingStatus:u.default[e.statusCode()],signalingOpenDurationMs:t,iceGatheringDurationMs:o,attendeePresenceDurationMs:n,poorConnectionCount:i,meetingStartDurationMs:r,retryCount:this.totalRetryCount};this.eventController.publishEvent("meetingReconnected",a)}this.actionFinishConnecting()}))}catch(e){this.sessionStateController.perform(p.default.FinishConnecting,(()=>{this.logger.info("failed to reconnect audio-video session");const t=new c.default(this.getMeetingStatusCode(e)||u.default.TaskFailed);this.handleMeetingSessionStatus(t,e)}))}this.connectionHealthData.setConnectionStartTime()}))}wrapTaskName(e){return`${e}/${this.configuration.meetingId}/${this.configuration.credentials.attendeeId}`}getMeetingStatusCode(e){const t=/the meeting status code: (\d+)/.exec(e&&e.message);return t&&t.length>1?Number.parseInt(t[1],10):null}enforceBandwidthLimitationForSender(e){return s(this,void 0,void 0,(function*(){yield this.meetingSessionContext.transceiverController.setVideoSendingBitrateKbps(e)}))}handleMeetingSessionStatus(e,t){if(this.logger.info(`handling status: ${u.default[e.statusCode()]}`),e.isTerminal()||this.meetingSessionContext.statsCollector&&this.meetingSessionContext.statsCollector.logMeetingSessionStatus(e),e.statusCode()===u.default.IncompatibleSDP)return this.restartLocalVideo((()=>{this.logger.info("handled incompatible SDP by attempting to restart video")})),!0;if(e.statusCode()===u.default.VideoCallSwitchToViewOnly)return this._videoTileController.removeLocalVideoTile(),this.forEachObserver((e=>{X.Maybe.of(e.videoSendDidBecomeUnavailable).map((t=>t.bind(e)()))})),!1;if(e.isTerminal()&&(this.logger.error("session will not be reconnected"),this.meetingSessionContext.reconnectController&&this.meetingSessionContext.reconnectController.disableReconnect()),(e.isFailure()||e.isTerminal())&&this.meetingSessionContext.reconnectController){const i=this.reconnect(e,t);return i?this.logger.warn(`will retry due to status code ${u.default[e.statusCode()]}${t?` and error: ${t.message}`:""}`):this.logger.error(`failed with status code ${u.default[e.statusCode()]}${t?` and error: ${t.message}`:""}`),i}return!1}setVideoMaxBandwidthKbps(e){this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&(this.logger.info(`video send has ideal max bandwidth ${e} kbps`),this.meetingSessionContext.videoUplinkBandwidthPolicy.setIdealMaxBandwidthKbps(e)),this.maxUplinkBandwidthKbps=e}handleHasBandwidthPriority(e){return s(this,void 0,void 0,(function*(){if(this.meetingSessionContext&&this.meetingSessionContext.videoUplinkBandwidthPolicy&&!this.meetingSessionContext.enableSimulcast){if(this.useUpdateTransceiverControllerForUplink)return this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(e),void(yield this.meetingSessionContext.videoUplinkBandwidthPolicy.updateTransceiverController());const t=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();this.meetingSessionContext.videoUplinkBandwidthPolicy.setHasBandwidthPriority(e);const i=this.meetingSessionContext.videoUplinkBandwidthPolicy.maxBandwidthKbps();t!==i&&(this.logger.info(`video send bandwidth priority ${e} max has changed from ${t} kbps to ${i} kbps`),yield this.enforceBandwidthLimitationForSender(i))}}))}pauseReceivingStream(e){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.pause([e])}resumeReceivingStream(e){this.meetingSessionContext&&this.meetingSessionContext.signalingClient&&this.meetingSessionContext.signalingClient.resume([e])}getRemoteVideoSources(){const{videoStreamIndex:e}=this.meetingSessionContext;if(!e)return this.logger.info("meeting has not started"),[];const t=this.configuration.credentials.attendeeId;return e.allVideoSendingSourcesExcludingSelf(t)}encodingSimulcastLayersDidChange(e){this.mayNeedRenegotiationForSimulcastLayerChange=!0,this.forEachObserver((t=>{X.Maybe.of(t.encodingSimulcastLayersDidChange).map((i=>i.bind(t)(e)))}))}}t.default=ue,ue.MIN_VOLUME_DECIBELS=-42,ue.MAX_VOLUME_DECIBELS=-14,ue.PING_PONG_INTERVAL_MS=1e4},69836:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(38434),o=i(93831),n=i(30209),r=i(14015),a=i(10589),d=i(68015),l=i(76057),c=i(29141),u=i(67631),h=i(9059);class m extends h.default{constructor(e){const t=new a.default;t.meetingId="",t.externalMeetingId="",t.credentials=new d.default,t.credentials.attendeeId="",t.credentials.joinToken="",t.urls=new l.default,t.urls.turnControlURL="",t.urls.audioHostURL="",t.urls.signalingURL="wss://localhost/";const i=new n.default;super(e||t,i,new u.default(new n.default),new r.default,new c.default(0,new s.default(0,0,0)),new o.default(e||t,i))}setAudioProfile(e){}start(){}stop(){}}t.default=m},18538:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(27170);t.default=class{constructor(e,t,i,s,o,n){this.audioVideoController=e,this.videoTileController=t,this.realtimeController=i,this.audioMixController=s,this.deviceController=o,this.contentShareController=n}addObserver(e){this.audioVideoController.addObserver(e),this.trace("addObserver")}removeObserver(e){this.audioVideoController.removeObserver(e),this.trace("removeObserver")}setAudioProfile(e){this.trace("setAudioProfile",e),this.audioVideoController.setAudioProfile(e)}start(e){this.audioVideoController.start(e),this.trace("start")}stop(){this.audioVideoController.stop(),this.trace("stop")}getRTCPeerConnectionStats(e){return this.trace("getRTCPeerConnectionStats",e?e.id:null),this.audioVideoController.getRTCPeerConnectionStats(e)}bindAudioElement(e){const t=this.audioMixController.bindAudioElement(e);return this.trace("bindAudioElement",e.id,t),t}unbindAudioElement(){this.audioMixController.unbindAudioElement(),this.trace("unbindAudioElement")}getCurrentMeetingAudioStream(){return this.trace("getCurrentConferenceStream"),this.audioMixController.getCurrentMeetingAudioStream()}addAudioMixObserver(e){this.trace("addAudioMixObserver"),this.audioMixController.addAudioMixObserver(e)}removeAudioMixObserver(e){this.trace("removeAudioMixObserver"),this.audioMixController.removeAudioMixObserver(e)}bindVideoElement(e,t){this.videoTileController.bindVideoElement(e,t),this.trace("bindVideoElement",{tileId:e,videoElementId:t.id})}unbindVideoElement(e){this.videoTileController.unbindVideoElement(e),this.trace("unbindVideoElement",e)}startLocalVideoTile(){const e=this.videoTileController.startLocalVideoTile();return this.trace("startLocalVideoTile",null,e),e}stopLocalVideoTile(){this.videoTileController.stopLocalVideoTile(),this.trace("stopLocalVideoTile")}hasStartedLocalVideoTile(){const e=this.videoTileController.hasStartedLocalVideoTile();return this.trace("hasStartedLocalVideoTile",null,e),e}removeLocalVideoTile(){this.videoTileController.removeLocalVideoTile(),this.trace("removeLocalVideoTile")}getLocalVideoTile(){const e=this.videoTileController.getLocalVideoTile();return this.trace("getLocalVideoTile"),e}pauseVideoTile(e){this.videoTileController.pauseVideoTile(e),this.trace("pauseVideoTile",e)}unpauseVideoTile(e){this.videoTileController.unpauseVideoTile(e),this.trace("unpauseVideoTile",e)}getVideoTile(e){const t=this.videoTileController.getVideoTile(e);return this.trace("getVideoTile",e),t}getAllRemoteVideoTiles(){const e=this.videoTileController.getAllRemoteVideoTiles();return this.trace("getAllRemoteVideoTiles"),e}getAllVideoTiles(){const e=this.videoTileController.getAllVideoTiles();return this.trace("getAllVideoTiles"),e}addVideoTile(){const e=this.videoTileController.addVideoTile();return this.trace("addVideoTile",null,e.state()),e}removeVideoTile(e){this.videoTileController.removeVideoTile(e),this.trace("removeVideoTile",e)}removeVideoTilesByAttendeeId(e){const t=this.videoTileController.removeVideoTilesByAttendeeId(e);return this.trace("removeVideoTilesByAttendeeId",e,t),t}removeAllVideoTiles(){this.videoTileController.removeAllVideoTiles(),this.trace("removeAllVideoTiles")}captureVideoTile(e){const t=this.videoTileController.captureVideoTile(e);return this.trace("captureVideoTile",e),t}realtimeSubscribeToAttendeeIdPresence(e){this.realtimeController.realtimeSubscribeToAttendeeIdPresence(e),this.trace("realtimeSubscribeToAttendeeIdPresence")}realtimeUnsubscribeToAttendeeIdPresence(e){this.realtimeController.realtimeUnsubscribeToAttendeeIdPresence(e),this.trace("realtimeUnsubscribeToAttendeeIdPresence")}realtimeSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeSetCanUnmuteLocalAudio(e),this.trace("realtimeSetCanUnmuteLocalAudio",e)}realtimeSubscribeToSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeSubscribeToSetCanUnmuteLocalAudio(e),this.trace("realtimeSubscribeToSetCanUnmuteLocalAudio")}realtimeUnsubscribeToSetCanUnmuteLocalAudio(e){this.realtimeController.realtimeUnsubscribeToSetCanUnmuteLocalAudio(e)}realtimeCanUnmuteLocalAudio(){const e=this.realtimeController.realtimeCanUnmuteLocalAudio();return this.trace("realtimeCanUnmuteLocalAudio",null,e),e}realtimeMuteLocalAudio(){this.realtimeController.realtimeMuteLocalAudio(),this.trace("realtimeMuteLocalAudio")}realtimeUnmuteLocalAudio(){const e=this.realtimeController.realtimeUnmuteLocalAudio();return this.trace("realtimeUnmuteLocalAudio"),e}realtimeSubscribeToMuteAndUnmuteLocalAudio(e){this.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(e),this.trace("realtimeSubscribeToMuteAndUnmuteLocalAudio")}realtimeUnsubscribeToMuteAndUnmuteLocalAudio(e){this.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(e)}realtimeIsLocalAudioMuted(){const e=this.realtimeController.realtimeIsLocalAudioMuted();return this.trace("realtimeIsLocalAudioMuted"),e}realtimeSubscribeToVolumeIndicator(e,t){this.realtimeController.realtimeSubscribeToVolumeIndicator(e,t),this.trace("realtimeSubscribeToVolumeIndicator",e)}realtimeUnsubscribeFromVolumeIndicator(e,t){this.realtimeController.realtimeUnsubscribeFromVolumeIndicator(e,t),this.trace("realtimeUnsubscribeFromVolumeIndicator",e,t)}realtimeSubscribeToLocalSignalStrengthChange(e){this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange(e),this.trace("realtimeSubscribeToLocalSignalStrengthChange")}realtimeUnsubscribeToLocalSignalStrengthChange(e){this.realtimeController.realtimeUnsubscribeToLocalSignalStrengthChange(e),this.trace("realtimeUnsubscribeToLocalSignalStrengthChange")}realtimeSendDataMessage(e,t,i){this.realtimeController.realtimeSendDataMessage(e,t,i),this.trace("realtimeSendDataMessage")}realtimeSubscribeToReceiveDataMessage(e,t){this.realtimeController.realtimeSubscribeToReceiveDataMessage(e,t),this.trace("realtimeSubscribeToReceiveDataMessage")}realtimeUnsubscribeFromReceiveDataMessage(e){this.realtimeController.realtimeUnsubscribeFromReceiveDataMessage(e),this.trace("realtimeUnsubscribeFromReceiveDataMessage")}realtimeSubscribeToFatalError(e){this.realtimeController.realtimeSubscribeToFatalError(e)}realtimeUnsubscribeToFatalError(e){this.realtimeController.realtimeUnsubscribeToFatalError(e)}subscribeToActiveSpeakerDetector(e,t,i,s){this.audioVideoController.activeSpeakerDetector.subscribe(e,t,i,s),this.trace("subscribeToActiveSpeakerDetector")}unsubscribeFromActiveSpeakerDetector(e){this.audioVideoController.activeSpeakerDetector.unsubscribe(e),this.trace("unsubscribeFromActiveSpeakerDetector")}listAudioInputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.deviceController.listAudioInputDevices(e);return this.trace("listAudioInputDevices",e,t),t}))}listVideoInputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.deviceController.listVideoInputDevices(e);return this.trace("listVideoInputDevices",e,t),t}))}listAudioOutputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.deviceController.listAudioOutputDevices(e);return this.trace("listAudioOutputDevices",e,t),t}))}chooseAudioInputDevice(e){return this.trace("chooseAudioInputDevice",e),this.deviceController.chooseAudioInputDevice(e)}chooseVideoInputDevice(e){return o.isVideoTransformDevice(e)?this.trace("chooseVideoInputDevice with transform device"):this.trace("chooseVideoInputDevice",e),this.deviceController.chooseVideoInputDevice(e)}chooseAudioOutputDevice(e){const t=this.deviceController.chooseAudioOutputDevice(e);return this.trace("chooseAudioOutputDevice",e),t}addDeviceChangeObserver(e){this.deviceController.addDeviceChangeObserver(e),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(e){this.deviceController.removeDeviceChangeObserver(e),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){const e=this.deviceController.createAnalyserNodeForAudioInput();return this.trace("createAnalyserNodeForAudioInput"),e}startVideoPreviewForVideoInput(e){this.deviceController.startVideoPreviewForVideoInput(e),this.trace("startVideoPreviewForVideoInput",e.id)}stopVideoPreviewForVideoInput(e){this.deviceController.stopVideoPreviewForVideoInput(e),this.trace("stopVideoPreviewForVideoInput",e.id)}setDeviceLabelTrigger(e){this.deviceController.setDeviceLabelTrigger(e),this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(e){const t=this.deviceController.mixIntoAudioInput(e);return this.trace("mixIntoAudioInput",e.id),t}chooseVideoInputQuality(e,t,i,s){this.deviceController.chooseVideoInputQuality(e,t,i,s),this.trace("chooseVideoInputQuality",{width:e,height:t,frameRate:i,maxBandwidthKbps:s})}getVideoInputQualitySettings(){const e=this.deviceController.getVideoInputQualitySettings();return this.trace("getVideoInputQualitySettings"),e}setContentAudioProfile(e){this.trace("setContentAudioProfile",e),this.contentShareController.setContentAudioProfile(e)}startContentShare(e){const t=this.contentShareController.startContentShare(e);return this.trace("startContentShare"),t}startContentShareFromScreenCapture(e,t){const i=this.contentShareController.startContentShareFromScreenCapture(e,t);return this.trace("startContentShareFromScreenCapture"),i}pauseContentShare(){this.contentShareController.pauseContentShare(),this.trace("pauseContentShare")}unpauseContentShare(){this.contentShareController.unpauseContentShare(),this.trace("unpauseContentShare")}stopContentShare(){this.contentShareController.stopContentShare(),this.trace("stopContentShare")}addContentShareObserver(e){this.contentShareController.addContentShareObserver(e),this.trace("addContentShareObserver")}removeContentShareObserver(e){this.contentShareController.removeContentShareObserver(e),this.trace("removeContentShareObserver")}trace(e,t,i){let s=`API/DefaultAudioVideoFacade/${this.audioVideoController.configuration.meetingId}/${this.audioVideoController.configuration.credentials.attendeeId}/${e}`;void 0!==t&&(s+=` ${JSON.stringify(t)}`),void 0!==i&&(s+=` -> ${JSON.stringify(i)}`),this.audioVideoController.logger.info(s)}getRemoteVideoSources(){const e=this.audioVideoController.getRemoteVideoSources();return this.trace("getRemoteVideoSources",null,e),e}get transcriptionController(){return this.realtimeController.transcriptionController}}},30179:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(68074),n=i(99734);class r extends o.default{constructor(e,t){super(e,t),this.blurCanvas=document.createElement("canvas"),this.blurCanvasCtx=this.blurCanvas.getContext("2d"),this.blurCanvas.width=this.spec.model.input.width,this.blurCanvas.height=this.spec.model.input.height,this.logger.info("BackgroundBlur processor using builtin blur")}drawImageWithMask(e,t){const i=this.blurredImage,{canvasCtx:s,targetCanvas:o}=this,{width:n,height:r}=o;if(!t||!i)return void s.clearRect(0,0,n,r);this.scaledCanvas.getContext("2d").putImageData(t,0,0),this.blurCanvasCtx.putImageData(this.blurredImage,0,0),s.save(),s.clearRect(0,0,n,r),s.drawImage(this.scaledCanvas,0,0,n,r),s.globalCompositeOperation="source-in",s.drawImage(e,0,0,n,r),s.globalCompositeOperation="destination-over",s.drawImage(this.blurCanvas,0,0,n,r),s.restore()}setBlurStrength(e){if(super.setBlurStrength(e),this.worker){this.modelInitialized=!1,this.worker.postMessage({msg:"destroy"});const e=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:e.path,inputHeight:e.input.height,inputWidth:e.input.width,inputChannels:4,modelRangeMin:e.input.range[0],modelRangeMax:e.input.range[1],blurPixels:this.blurAmount}})}}setBlurPixels(){this.blurAmount=n.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:540}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}handleInitialize(e){if(this.logger.info(`received initialize message: ${this.stringify(e)}`),!e.payload)return this.logger.error("failed to initialize module"),void this.initWorkerPromise.reject(new Error("failed to initialize the module"));const t=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:t.path,inputHeight:t.input.height,inputWidth:t.input.width,inputChannels:4,modelRangeMin:t.input.range[0],modelRangeMax:t.input.range[1],blurPixels:this.blurAmount}}),this.initWorkerPromise.resolve({})}handlePredict(e){this.blurredImage=e.payload.blurOutput,super.handlePredict(e)}destroy(){const e=Object.create(null,{destroy:{get:()=>super.destroy}});var t;return s(this,void 0,void 0,(function*(){e.destroy.call(this),null===(t=this.blurCanvas)||void 0===t||t.remove(),this.blurCanvas=void 0}))}}t.default=r},68074:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(41851),n=i(99734),r=i(99852);class a extends o.default{constructor(e,t){super("background blur",e,t,new r.default),this.blurAmount=0,this.setBlurStrength(t.blurStrength),this.logger.info("BackgroundBlur processor successfully created"),this.logger.info(`BackgroundBlur spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundBlur options: ${this.stringify(t)}`)}validateOptions(e){if(super.validateOptions(e),!e.blurStrength)throw new Error("processor has null options - blurStrength")}initOnFirstExecution(){this.setBlurPixels()}drawImageWithMask(e,t){t||(t=new ImageData(this.spec.model.input.width,this.spec.model.input.height));this.scaledCanvas.getContext("2d").putImageData(t,0,0);const{canvasCtx:i,targetCanvas:s}=this,{width:o,height:n}=s;i.save(),i.clearRect(0,0,o,n),i.drawImage(this.scaledCanvas,0,0,o,n),i.globalCompositeOperation="source-in",i.drawImage(e,0,0,o,n),i.globalCompositeOperation="destination-over",i.filter=`blur(${this.blurAmount}px)`,i.drawImage(e,0,0,s.width,s.height),i.restore()}setBlurStrength(e){this._blurStrength=e,this.logger.info(`blur strength set to ${this._blurStrength}`),this.setBlurPixels()}setBlurPixels(){this.blurAmount=n.BlurStrengthMapper.getBlurAmount(this._blurStrength,{height:this.sourceHeight}),this.logger.info(`background blur amount set to ${this.blurAmount}`)}addObserver(e){this.delegate.addObserver(e)}removeObserver(e){this.delegate.removeObserver(e)}static isSupported(){return s(this,void 0,void 0,(function*(){const e=document.createElement("canvas"),t=void 0!==e.getContext("2d").filter;return e.remove(),t}))}}t.default=a},99734:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlurStrengthMapper=void 0;class i{static getBlurAmount(e,t){if(e<=0)throw new Error(`invalid value for blur strength: ${e}`);return Math.round(e*t.height/this.BLUR_STRENGTH_DIVISOR)}}t.BlurStrengthMapper=i,i.BLUR_STRENGTH_DIVISOR=540,t.default={LOW:7,MEDIUM:15,HIGH:30}},51260:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(84243),n=i(88030),r=i(70813),a=i(52801),d=i(30179),l=i(68074),c=i(99734);class u extends a.default{setBlurStrength(){}loadAssets(){return s(this,void 0,void 0,(function*(){}))}addObserver(){}removeObserver(){}}class h extends o.default{static create(e,t){return s(this,void 0,void 0,(function*(){e=h.resolveSpec(e),t=h.resolveOptions(t);const{logger:i}=t,s=yield h.isSupported(e,t);if(i.info(`processor is ${s?"":"not"} supported`),!s)return i.warn("Using no-op processor because background blur is not supported"),new u;let o;return(yield l.default.isSupported())?(i.info("Using browser-provided background blur"),o=new l.default(e,t)):(i.info("Using built-in background blur"),o=new d.default(e,t)),yield o.loadAssets(),o}))}static resolveOptions(e={}){let t=Object.assign({},e);return t.blurStrength||(t.blurStrength=c.default.MEDIUM),t.logger||(t.logger=new n.default("BackgroundBlurProcessor",r.default.INFO)),t=super.resolveOptions(t),t}static isSupported(e,t){return e=h.resolveSpec(e),t=h.resolveOptions(t),super.isSupported(e,t)}}t.default=h},99852:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(24627);class o extends s.default{}t.default=o},80022:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.path=null,this.input=null,this.output=null}static builder(){return new i}withDefaultModel(){return this.withSelfieSegmentationDefaults()}withSelfieSegmentationDefaults(){return this.path="https://static.sdkassets.chime.aws/bgblur/models/selfie_segmentation_landscape.tflite",this.input={height:144,width:256,range:[0,1],channels:3},this.output={height:144,width:256,range:[0,1],channels:1},this}withPath(e){return this.path=e,this}withInput(e){return this.input=e,this}withOutput(e){return this.output=e,this}validate(){if(!this.path)throw new Error("model spec path is not set");if(!this.input)throw new Error("model spec input is not set");if(!this.output)throw new Error("model spec output is not set")}build(){return this.validate(),{path:this.path,input:this.input,output:this.output}}}t.default=i},53368:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i,s){this.delegate=e,this.reportingPeriodMillis=t,this.filterCPUUtilization=i,this.logger=s,this._processingFilter=!0,this.lastReportedEventTimestamp=0,this.lastFilterCompleteTimestamp=0,this.filterTotalMillis=0,this.filterCount=0,this.framerate=0,this.filterDurationNotifyMillis=0,this.setSegmentationDuration()}reportEvent(e){const t=e-this.lastReportedEventTimestamp;if(t>=this.reportingPeriodMillis){const i=this.filterCount,s=this.filterTotalMillis;if(this.filterCount=0,this.filterTotalMillis=0,this.lastReportedEventTimestamp=e,0===this.framerate||0===i)return;const o=Math.round(s/i),n=Math.round(this.framerate*(t/1e3))-i,r=Math.round(100*s/t);o>=this.filterDurationNotifyMillis&&this.delegate.filterFrameDurationHigh({framesDropped:n,avgFilterDurationMillis:o,framerate:this.framerate,periodMillis:t}),r>=this.filterCPUUtilization&&this.delegate.filterCPUUtilizationHigh({cpuUtilization:r,filterMillis:s,periodMillis:t})}}setSegmentationDuration(){this.filterDurationNotifyMillis=Math.round(1e3/this.framerate*.8)}frameReceived(e){e!==this.framerate&&(this.framerate=e,this.logger.info(`frame counter setting frame rate to ${this.framerate}`),this.setSegmentationDuration());const t=Date.now();this.reportEvent(t)}filterSubmitted(){this._processingFilter=!0,this.lastFilterCompleteTimestamp=Date.now()}filterComplete(){this.filterTotalMillis+=Date.now()-this.lastFilterCompleteTimestamp,this._processingFilter=!1,this.filterCount++}get processingSegment(){return this._processingFilter}}},41851:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundFilterMonitor=void 0;const o=i(85021),n=i(19807),r=i(53368);class a{constructor(){this.value=void 0,this.resolve=null}whenNext(){return this.promise||(this.promise=new Promise((e=>this.resolve=e))),this.promise}next(e){this.value=e,this.resolve(e),delete this.promise}}class d{constructor(e,t,i,s){this.targetCanvas=document.createElement("canvas"),this.canvasCtx=this.targetCanvas.getContext("2d"),this.canvasVideoFrameBuffer=new n.default(this.targetCanvas),this.mask$=new a,this.sourceWidth=0,this.sourceHeight=0,this.frameNumber=0,this.videoFramesPerFilterUpdate=1,this.initWorkerPromise=d.createWorkerPromise(),this.loadModelPromise=d.createWorkerPromise(),this.modelInitialized=!1,this.destroyed=!1,this.filterType=e,this.validateSpec(t),this.validateOptions(i),this.spec=t,this.logger=i.logger,this.delegate=s,this.initCPUMonitor(i)}static createWorkerPromise(){const e={resolve:null,reject:null,promise:null};return e.promise=new Promise(((t,i)=>{e.resolve=t,e.reject=i})),e}validateSpec(e){if(!e)throw new Error("processor has null spec");if(!e.model)throw new Error("processor spec has null model");if(!e.paths)throw new Error("processor spec has null paths")}validateOptions(e){if(!e)throw new Error("processor has null options");if(!e.logger)throw new Error("processor has null options - logger");if(!e.reportingPeriodMillis)throw new Error("processor has null options - reportingPeriodMillis");if(!e.filterCPUUtilization)throw new Error("processor has null options - filterCPUUtilization")}initCPUMonitor(e){this.videoFramesPerFilterUpdate=1,this.frameCounter=new r.default(this.delegate,e.reportingPeriodMillis,e.filterCPUUtilization,this.logger),this.cpuMonitor=new l(5e3,{reduceCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.min(this.videoFramesPerFilterUpdate+1,10))},increaseCPUUtilization:()=>{this.updateVideoFramesPerFilterUpdate(Math.max(this.videoFramesPerFilterUpdate-1,1))}}),this.delegate.addObserver(this.cpuMonitor)}stringify(e){return JSON.stringify(e,null,2)}handleInitialize(e){if(this.logger.info(`received initialize message: ${this.stringify(e)}`),!e.payload)return this.logger.error("failed to initialize module"),void this.initWorkerPromise.reject(new Error("failed to initialize the module"));const t=this.spec.model;this.worker.postMessage({msg:"loadModel",payload:{modelUrl:t.path,inputHeight:t.input.height,inputWidth:t.input.width,inputChannels:4,modelRangeMin:t.input.range[0],modelRangeMax:t.input.range[1],blurPixels:0}}),this.initWorkerPromise.resolve({})}handleLoadModel(e){if(this.logger.info(`received load model message: ${this.stringify(e)}`),2!==e.payload)return this.logger.error("failed to load model! status: "+e.payload),void this.loadModelPromise.reject(new Error("failed to load model! status: "+e.payload));this.modelInitialized=!0,this.loadModelPromise.resolve({})}handlePredict(e){this.mask$.next(e.payload.output)}handleWorkerEvent(e){const t=e.data;switch(t.msg){case"initialize":this.handleInitialize(t);break;case"loadModel":this.handleLoadModel(t);break;case"predict":this.handlePredict(t);break;default:this.logger.info(`unexpected event msg: ${this.stringify(t)}`)}}loadAssets(){return s(this,void 0,void 0,(function*(){this.logger.info("start initializing the processor");try{this.worker=yield o.loadWorker(this.spec.paths.worker,"BackgroundFilterWorker",{},null),this.worker.addEventListener("message",(e=>this.handleWorkerEvent(e))),this.worker.postMessage({msg:"initialize",payload:{wasmPath:this.spec.paths.wasm,simdPath:this.spec.paths.simd}}),yield this.initWorkerPromise.promise,this.logger.info(`successfully initialized the ${this.filterType} worker`),yield this.loadModelPromise.promise,this.logger.info(`successfully loaded ${this.filterType} worker segmentation model`)}catch(e){throw new Error(`could not initialize the ${this.filterType} video frame processor due to '${e.message}'`)}this.logger.info(`successfully initialized the ${this.filterType} processor`)}))}process(e){return s(this,void 0,void 0,(function*(){if(this.destroyed)return e;this.frameCounter.frameReceived(e[0].framerate),this.cpuMonitor.frameReceived();const t=e[0].asCanvasElement();if(!t)return e;if(!this.modelInitialized)return e[0]=this.canvasVideoFrameBuffer,e;const i=t.width,s=t.height;if(0===i||0===s)return e;0===this.sourceWidth&&(this.sourceWidth=i,this.sourceHeight=s,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight,this.logger.info(`${this.filterType} source width: ${this.sourceWidth}`),this.logger.info(`${this.filterType} source height: ${this.sourceHeight}`),this.initOnFirstExecution()),this.sourceWidth===i&&this.sourceHeight===s||(this.sourceWidth=i,this.sourceHeight=s,this.targetCanvas.width=this.sourceWidth,this.targetCanvas.height=this.sourceHeight);try{this.frameCounter.filterSubmitted();let e=this.mask$.value;const i=this.spec.model.input.width/t.width,s=this.spec.model.input.height/t.height;void 0===this.scaledCanvas&&(this.scaledCanvas=document.createElement("canvas"),this.scaledCanvas.width=this.spec.model.input.width,this.scaledCanvas.height=this.spec.model.input.height);const o=this.scaledCanvas.getContext("2d");o.save(),o.scale(i,s),o.drawImage(t,0,0),o.restore();const n=o.getImageData(0,0,this.scaledCanvas.width,this.scaledCanvas.height);if(this.frameNumber%this.videoFramesPerFilterUpdate==0){const t=this.mask$.whenNext();this.worker.postMessage({msg:"predict",payload:n},[n.data.buffer]),e=yield t}this.destroyed||this.drawImageWithMask(t,e)}catch(t){return this.logger.error(`could not process ${this.filterType} frame buffer due to ${t}`),e}finally{this.frameCounter.filterComplete(),this.frameNumber++}return e[0]=this.canvasVideoFrameBuffer,e}))}updateVideoFramesPerFilterUpdate(e){e!==this.videoFramesPerFilterUpdate&&(this.videoFramesPerFilterUpdate=e,this.logger.info(`Adjusting filter rate to compensate for CPU utilization. Filter rate is ${this.videoFramesPerFilterUpdate} video frames per filter.`))}destroy(){var e,t,i,o;return s(this,void 0,void 0,(function*(){this.destroyed=!0,this.delegate.removeObserver(this.cpuMonitor),this.canvasVideoFrameBuffer.destroy(),null===(e=this.worker)||void 0===e||e.postMessage({msg:"destroy"}),null===(t=this.worker)||void 0===t||t.postMessage({msg:"stop"}),null===(i=this.targetCanvas)||void 0===i||i.remove(),this.targetCanvas=void 0,null===(o=this.scaledCanvas)||void 0===o||o.remove(),this.scaledCanvas=void 0,this.logger.info(`${this.filterType} frame process destroyed`)}))}}t.default=d;class l{constructor(e,t){this.monitoringPeriodMillis=e,this.observer=t,this.lastCPUChangeTimestamp=0}filterCPUUtilizationHigh(){const e=Date.now();e-this.lastCPUChangeTimestamp>=this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=e,this.observer.reduceCPUUtilization())}frameReceived(){const e=Date.now();e-this.lastCPUChangeTimestamp>=2*this.monitoringPeriodMillis&&(this.lastCPUChangeTimestamp=e,this.observer.increaseCPUUtilization())}}t.BackgroundFilterMonitor=l},84243:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(85021),n=i(39424),r=i(80022),a=i(90543),d=i(74046),l=()=>r.default.builder().withSelfieSegmentationDefaults().build(),c="https://static.sdkassets.chime.aws",u={worker:`${c}/bgblur/workers/worker.js`,wasm:`${c}/bgblur/wasm/_cwt-wasm.wasm`,simd:`${c}/bgblur/wasm/_cwt-wasm-simd.wasm`};t.default=class{static defaultAssetSpec(){const e=d.default.sdkVersionSemVer;return{assetGroup:`sdk-${e.major}.${e.minor}`}}static createUrlWithParams(e,t){const i=new URL(e),s=Object.keys(t);for(const e of s)void 0!==t[e]&&i.searchParams.set(e,t[e]);return i.toString()}static resolveSpec(e){const{paths:t=u,model:i=l(),assetGroup:s=this.defaultAssetSpec().assetGroup,revisionID:o=this.defaultAssetSpec().revisionID}=e||{},n={assetGroup:s,revisionID:o,sdk:encodeURIComponent(d.default.sdkVersion),ua:encodeURIComponent(d.default.sdkUserAgentLowResolution)};return t.worker=this.createUrlWithParams(t.worker,n),t.wasm=this.createUrlWithParams(t.wasm,n),t.simd=this.createUrlWithParams(t.simd,n),i.path=this.createUrlWithParams(i.path,n),{paths:t,model:i,assetGroup:s,revisionID:o}}static resolveOptions(e){e.reportingPeriodMillis||(e.reportingPeriodMillis=1e3);return e.filterCPUUtilization?(e.filterCPUUtilization<0||e.filterCPUUtilization>100)&&(e.logger.warn("filterCPUUtilization must be set to a range between 0 and 100 percent. Falling back to default of 30 percent"),e.filterCPUUtilization=30):e.filterCPUUtilization=30,e}static isSupported(e,t){const{logger:i}=t;if("undefined"==typeof globalThis)return i.info("Browser does not have globalThis."),Promise.resolve(!1);return(new a.default).supportsBackgroundFilter()?n.supportsWASM(globalThis,i)?this.supportsBackgroundFilter(globalThis,e,i):(i.info("Browser does not support WASM."),Promise.resolve(!1)):(i.info("Browser is not supported."),Promise.resolve(!1))}static supportsBackgroundFilter(e=globalThis,t,i){return s(this,void 0,void 0,(function*(){if(!n.supportsWorker(e,i))return i.info("Browser does not support web workers."),!1;const s=t.paths.worker;try{const e=yield o.loadWorker(s,"BackgroundFilterWorker",{},null);try{e.terminate()}catch(e){i.info(`Failed to terminate worker. ${e.message}`)}return!0}catch(e){return i.info(`Failed to fetch and instantiate test worker ${e.message}`),!1}}))}}},24627:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}filterFrameDurationHigh(e){var t;for(const i of this.observers)null===(t=i.filterFrameDurationHigh)||void 0===t||t.call(i,e)}filterCPUUtilizationHigh(e){var t;for(const i of this.observers)null===(t=i.filterCPUUtilizationHigh)||void 0===t||t.call(i,e)}}},59392:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(41851),n=i(1447);class r extends o.default{constructor(e,t){super("background replacement",e,t,new n.default),this.replacementBlob=t.imageBlob,this.logger.info("BackgroundReplacement processor successfully created"),this.logger.info(`BackgroundReplacement spec: ${this.stringify(this.spec)}`),this.logger.info(`BackgroundReplacement options: ${this.stringify(t)}`)}setImageBlob(e){return s(this,void 0,void 0,(function*(){this.replacementBlob=e,this.replacementImage=yield r.loadImage(this.createReplacementObjectUrl())}))}initOnFirstExecution(){}drawImageWithMask(e,t){t||(t=new ImageData(this.spec.model.input.width,this.spec.model.input.height));this.scaledCanvas.getContext("2d").putImageData(t,0,0);const{canvasCtx:i,targetCanvas:s}=this,{width:o,height:n}=s;i.save(),i.clearRect(0,0,o,n),i.drawImage(this.scaledCanvas,0,0,o,n),i.globalCompositeOperation="source-in",i.drawImage(e,0,0,o,n),i.globalCompositeOperation="destination-over",i.drawImage(this.replacementImage,0,0,s.width,s.height),i.restore()}static loadImageExecutor(e,t,i){const s=new Image;s.crossOrigin="Anonymous",s.addEventListener("load",(()=>{e(s)}),!1),s.addEventListener("error",(e=>{t(new Error(`Could not load replacement image ${s.src}: ${e.message}`))}),!1),s.src=i}static loadImage(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,i)=>this.loadImageExecutor(t,i,e)))}))}revokeReplacementObjectUrl(){this.replacementObjectUrl&&URL.revokeObjectURL(this.replacementObjectUrl)}createReplacementObjectUrl(){return this.revokeReplacementObjectUrl(),this.replacementObjectUrl=URL.createObjectURL(this.replacementBlob),this.replacementObjectUrl}loadAssets(){const e=Object.create(null,{loadAssets:{get:()=>super.loadAssets}});return s(this,void 0,void 0,(function*(){this.replacementImage=yield r.loadImage(this.createReplacementObjectUrl()),e.loadAssets.call(this)}))}addObserver(e){this.delegate.addObserver(e)}removeObserver(e){this.delegate.removeObserver(e)}destroy(){const e=Object.create(null,{destroy:{get:()=>super.destroy}});return s(this,void 0,void 0,(function*(){e.destroy.call(this),this.revokeReplacementObjectUrl()}))}}t.default=r},19854:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(84243),n=i(88030),r=i(70813),a=i(52801),d=i(59392);class l extends a.default{loadAssets(){return s(this,void 0,void 0,(function*(){}))}addObserver(){}removeObserver(){}setImageBlob(){return s(this,void 0,void 0,(function*(){}))}}class c extends o.default{static create(e,t){return s(this,void 0,void 0,(function*(){e=this.resolveSpec(e),t=this.resolveOptions(t),yield this.resolveOptionsAsync(t);const{logger:i}=t;if(!(yield c.isSupported(e,t)))return i.warn("Using no-op processor because background replacement is not supported"),new l;i.info("Using background replacement filter");const s=new d.default(e,t);return yield s.loadAssets(),s}))}static resolveOptions(e={}){const t=Object.assign({},e);return t.logger||(t.logger=new n.default("BackgroundReplacementProcessor",r.default.INFO)),super.resolveOptions(t)}static resolveOptionsAsync(e){return s(this,void 0,void 0,(function*(){if(!e.imageBlob){const t=document.createElement("canvas");t.width=100,t.height=100;const i=t.getContext("2d");i.fillStyle="blue",i.fillRect(0,0,100,100);const s=yield new Promise((e=>{t.toBlob(e)}));e.imageBlob=s}}))}static isSupported(e,t){const i=Object.create(null,{isSupported:{get:()=>super.isSupported}});return s(this,void 0,void 0,(function*(){e=this.resolveSpec(e),t=this.resolveOptions(t),yield this.resolveOptionsAsync(t);const s=t.imageBlob,o=URL.createObjectURL(s);try{yield d.default.loadImage(o)}catch(e){return t.logger.info(`Failed to fetch load replacement image ${e.message}`),!1}finally{URL.revokeObjectURL(o)}return i.isSupported.call(this,e,t)}))}}t.default=c},1447:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(24627);class o extends s.default{}t.default=o},38434:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i){this.fixedWaitMs=e,this.shortBackoffMs=t,this.longBackoffMs=i,this.currentRetry=0,this.fixedWaitMs<0&&(this.fixedWaitMs=0),this.shortBackoffMs<0&&(this.shortBackoffMs=0),this.longBackoffMs<0&&(this.longBackoffMs=0),this.reset()}reset(){this.currentRetry=0}nextBackoffAmountMs(){const e=Math.random()*Math.min(this.longBackoffMs,this.shortBackoffMs*Math.pow(2,this.currentRetry))+this.fixedWaitMs;return this.currentRetry+=1,e}}},55640:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(38434),o=i(67300);t.default=class{constructor(e,t,i){this.fixedWaitMs=e,this.shortBackoffMs=t,this.longBackoffMs=i}create(){return new s.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs)}createWithLimit(e){return new o.default(this.fixedWaitMs,this.shortBackoffMs,this.longBackoffMs,e)}}},67300:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(38434);class o extends s.default{constructor(e,t,i,s){super(e,t,i),this.limit=s,this.attempts=0}nextBackoffAmountMs(){if(this.attempts++,this.attempts>this.limit)throw new Error("retry limit exceeded");return super.nextBackoffAmountMs()}}t.default=o},90543:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(43631);t.default=class{constructor({recreateAudioContextIfNeeded:e=!1}={}){this.browser=o.detect(),this.browserSupport={chrome:78,"edge-chromium":79,electron:7,firefox:75,ios:13,safari:13,opera:66,samsung:12,crios:86,fxios:23,"ios-webview":605,"chromium-webview":92},this.browserName={chrome:"Google Chrome","edge-chromium":"Microsoft Edge",electron:"Electron",firefox:"Mozilla Firefox",ios:"Safari iOS",safari:"Safari",opera:"Opera",samsung:"Samsung Internet",crios:"Chrome iOS",fxios:"Firefox iOS","ios-webview":"WKWebView iOS","chromium-webview":"Chrome WebView"},this.chromeLike=["chrome","edge-chromium","chromium-webview","opera","samsung"],this.webkitBrowsers=["crios","fxios","safari","ios","ios-webview"],this.recreateAudioContextIfNeeded=e}version(){return this.browser.version}majorVersion(){return parseInt(this.version().split(".")[0])}name(){return this.browser.name}hasChromiumWebRTC(){for(const e of this.chromeLike)if(e===this.browser.name)return!0;return!1}hasWebKitWebRTC(){for(const e of this.webkitBrowsers)if(e===this.browser.name)return!0;return!1}hasFirefoxWebRTC(){return this.isFirefox()}supportsCanvasCapturedStreamPlayback(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}supportsBackgroundFilter(){return("safari"!==this.name()||15!==this.majorVersion())&&!!this.supportsCanvasCapturedStreamPlayback()}requiresResolutionAlignment(e,t){return this.isAndroid()&&this.isPixel3()?[64*Math.ceil(e/64),64*Math.ceil(t/64)]:[e,t]}requiresCheckForSdpConnectionAttributes(){return!this.isIOSSafari()&&!this.isIOSChrome()&&!this.isIOSFirefox()}requiresIceCandidateGatheringTimeoutWorkaround(){return this.hasChromiumWebRTC()}requiresBundlePolicy(){return"max-bundle"}requiresNoExactMediaStreamConstraints(){return this.isSamsungInternet()}requiresGroupIdMediaStreamConstraints(){return this.isSamsungInternet()}requiresContextRecreationForAudioWorklet(){return!!this.recreateAudioContextIfNeeded&&("chrome"in i.g&&("Mac OS"===this.browser.os&&!(!this.isChrome()&&!this.isEdge())))}getDisplayMediaAudioCaptureSupport(){return this.isChrome()||this.isEdge()}doesNotSupportMediaDeviceLabels(){return"chromium-webview"===this.browser.name}isSupported(){return!(!this.browserSupport[this.browser.name]||this.majorVersion()<this.browserSupport[this.browser.name])&&("firefox"!==this.browser.name||!this.isAndroid())}isSimulcastSupported(){return this.hasChromiumWebRTC()}supportDownlinkBandwidthEstimation(){return!this.isFirefox()}supportString(){if(this.isAndroid())return`${this.browserName.chrome} ${this.browserSupport.chrome}+, ${this.browserName.samsung} ${this.browserSupport.samsung}+`;const e=[];for(const t in this.browserSupport)e.push(`${this.browserName[t]} ${this.browserSupport[t]}+`);return e.join(", ")}supportedVideoCodecs(){return s(this,void 0,void 0,(function*(){const e=new RTCPeerConnection;return e.addTransceiver("video",{direction:"inactive",streams:[]}),(yield e.createOffer({offerToReceiveVideo:!0})).sdp.split("\r\n").filter((e=>e.includes("a=rtpmap:"))).map((e=>e.replace(/.* /,"").replace(/\/.*/,""))).filter(((e,t,i)=>i.indexOf(e)===t)).filter((e=>"rtx"!==e&&"red"!==e&&"ulpfec"!==e))}))}supportsSetSinkId(){return"setSinkId"in HTMLAudioElement.prototype}disableResolutionScaleDown(){return this.isAndroid()}disable480pResolutionScaleDown(){return/( Chrome\/98\.)/i.test(navigator.userAgent)&&this.browser.os.startsWith("Windows")}requiresDisablingH264Encoding(){return(this.isIOSSafari()||this.isIOSChrome()||this.isIOSFirefox())&&("15.1.0"===this.version()||/( OS 15_1)/i.test(navigator.userAgent))}isIOSSafari(){return"ios"===this.browser.name||"ios-webview"===this.browser.name||"safari"===this.browser.name&&/( Mac )/i.test(navigator.userAgent)&&navigator.maxTouchPoints>1}isFirefox(){return"firefox"===this.browser.name}isIOSFirefox(){return"fxios"===this.browser.name}isIOSChrome(){return"crios"===this.browser.name}isChrome(){return"chrome"===this.browser.name}isEdge(){return"edge-chromium"===this.browser.name}isSamsungInternet(){return"samsung"===this.browser.name}isAndroid(){return/(android)/i.test(navigator.userAgent)}isPixel3(){return/( pixel 3)/i.test(navigator.userAgent)}}},56196:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ClientMetricReportDirection=void 0,function(e){e[e.UPSTREAM=0]="UPSTREAM",e[e.DOWNSTREAM=1]="DOWNSTREAM"}(i=t.ClientMetricReportDirection||(t.ClientMetricReportDirection={})),t.default=i},99496:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ClientMetricReportMediaType=void 0,function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(i=t.ClientMetricReportMediaType||(t.ClientMetricReportMediaType={})),t.default=i},92770:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},86893:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(20289),o=i(56196),n=i(99496),r=i(2306);class a{constructor(e,t,i){this.logger=e,this.videoStreamIndex=t,this.selfAttendeeId=i,this.globalMetricReport=new r.default,this.streamMetricReports={},this.rtcStatsReport={},this.currentTimestampMs=0,this.previousTimestampMs=0,this.currentSsrcs={},this.identityValue=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;return Number(i.currentMetrics[e])},this.decoderLossPercent=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport,s=i.currentMetrics.concealedSamples-(i.previousMetrics.concealedSamples||0),o=i.currentMetrics.totalSamplesReceived-(i.previousMetrics.totalSamplesReceived||0);if(o<=0)return 0;return o-s<=0?0:s/o*100},this.packetLossPercent=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport,s=i.currentMetrics[e]-(i.previousMetrics[e]||0),o=i.currentMetrics.packetsLost-(i.previousMetrics.packetsLost||0),n=s+o;return n<=0||o<=0?0:100*o/n},this.jitterBufferMs=(e,t)=>{const i=this.streamMetricReports[t],s=i.currentMetrics.jitterBufferDelay-(i.previousMetrics.jitterBufferDelay||0),o=i.currentMetrics.jitterBufferEmittedCount-(i.previousMetrics.jitterBufferEmittedCount||0);return s<=0||o<=0?0:s/o*1e3},this.countPerSecond=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;let s=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(s<=0)return 0;this.previousTimestampMs<=0&&(s=1);const o=i.currentMetrics[e]-(i.previousMetrics[e]||0);return o<=0?0:Math.trunc(o/s)},this.bitsPerSecond=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;let s=(this.currentTimestampMs-this.previousTimestampMs)/1e3;if(s<=0)return 0;this.previousTimestampMs<=0&&(s=1);const o=8*(i.currentMetrics[e]-(i.previousMetrics[e]||0));return o<=0?0:Math.trunc(o/s)},this.secondsToMilliseconds=(e,t)=>{const i=t?this.streamMetricReports[t]:this.globalMetricReport;return Number(1e3*i.currentMetrics[e])},this.globalMetricMap={retransmittedBytesSent:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_RETRANSMIT_BITRATE},totalEncodedBytesTarget:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_TARGET_ENCODER_BITRATE},totalPacketSendDelay:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_BUCKET_DELAY_MS},packetsDiscardedOnSend:{transform:this.countPerSecond,type:s.SdkMetric.Type.SOCKET_DISCARDED_PPS},availableIncomingBitrate:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_AVAILABLE_RECEIVE_BANDWIDTH},availableOutgoingBitrate:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_AVAILABLE_SEND_BANDWIDTH},currentRoundTripTime:{transform:this.identityValue,type:s.SdkMetric.Type.STUN_RTT_MS}},this.audioUpstreamMetricMap={jitter:{transform:this.secondsToMilliseconds,type:s.SdkMetric.Type.RTC_MIC_JITTER_MS},packetsSent:{transform:this.countPerSecond,type:s.SdkMetric.Type.RTC_MIC_PPS},bytesSent:{transform:this.bitsPerSecond,type:s.SdkMetric.Type.RTC_MIC_BITRATE},roundTripTime:{transform:this.identityValue,type:s.SdkMetric.Type.RTC_MIC_RTT_MS},packetsLost:{transform:this.packetLossPercent,type:s.SdkMetric.Type.RTC_MIC_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"}},this.audioDownstreamMetricMap={concealedSamples:{transform:this.countPerSecond},totalSamplesReceived:{transform:this.countPerSecond},decoderLoss:{transform:this.decoderLossPercent,type:s.SdkMetric.Type.RTC_SPK_FRACTION_DECODER_LOSS_PERCENT},packetsReceived:{transform:this.countPerSecond,type:s.SdkMetric.Type.RTC_SPK_PPS},packetsLost:{transform:this.packetLossPercent,type:s.SdkMetric.Type.RTC_SPK_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},jitter:{transform:this.secondsToMilliseconds,type:s.SdkMetric.Type.RTC_SPK_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:s.SdkMetric.Type.RTC_SPK_JITTER_BUFFER_MS},bytesReceived:{transform:this.bitsPerSecond,type:s.SdkMetric.Type.RTC_SPK_BITRATE}},this.videoUpstreamMetricMap={roundTripTime:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_SENT_RTT_MS},nackCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_NACKS_RECEIVED},pliCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_PLIS_RECEIVED},firCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_FIRS_RECEIVED},framesPerSecond:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_INPUT_FPS},framesEncoded:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_ENCODE_FPS},packetsSent:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_SENT_PPS},packetsLost:{transform:this.packetLossPercent,type:s.SdkMetric.Type.VIDEO_SENT_FRACTION_PACKET_LOST_PERCENT,source:"packetsSent"},bytesSent:{transform:this.bitsPerSecond,type:s.SdkMetric.Type.VIDEO_SENT_BITRATE},qpSum:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_SENT_QP_SUM},frameHeight:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_ENCODE_HEIGHT},frameWidth:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_ENCODE_WIDTH}},this.videoDownstreamMetricMap={totalDecodeTime:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_DECODE_MS},packetsReceived:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_RECEIVED_PPS},packetsLost:{transform:this.packetLossPercent,type:s.SdkMetric.Type.VIDEO_RECEIVED_FRACTION_PACKET_LOST_PERCENT,source:"packetsReceived"},framesReceived:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_RECEIVED_FPS},framesDecoded:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_DECODE_FPS},nackCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_NACKS_SENT},firCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_FIRS_SENT},pliCount:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_PLIS_SENT},bytesReceived:{transform:this.bitsPerSecond,type:s.SdkMetric.Type.VIDEO_RECEIVED_BITRATE},jitter:{transform:this.secondsToMilliseconds,type:s.SdkMetric.Type.VIDEO_RECEIVED_JITTER_MS},jitterBufferDelay:{transform:this.countPerSecond},jitterBufferEmittedCount:{transform:this.countPerSecond},jitterBufferMs:{transform:this.jitterBufferMs,type:s.SdkMetric.Type.VIDEO_JITTER_BUFFER_MS},qpSum:{transform:this.countPerSecond,type:s.SdkMetric.Type.VIDEO_RECEIVED_QP_SUM},frameHeight:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_DECODE_HEIGHT},frameWidth:{transform:this.identityValue,type:s.SdkMetric.Type.VIDEO_DECODE_WIDTH}},this.observableVideoMetricSpec={videoUpstreamBitrate:{source:"bytesSent",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoUpstreamPacketsSent:{source:"packetsSent",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoUpstreamPacketLossPercent:{source:"packetsLost",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoUpstreamFramesEncodedPerSecond:{source:"framesEncoded",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoUpstreamFrameHeight:{source:"frameHeight",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoUpstreamFrameWidth:{source:"frameWidth",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoDownstreamBitrate:{source:"bytesReceived",media:n.default.VIDEO,dir:o.default.DOWNSTREAM},videoDownstreamPacketLossPercent:{source:"packetsLost",media:n.default.VIDEO,dir:o.default.DOWNSTREAM},videoDownstreamPacketsReceived:{source:"packetsReceived",media:n.default.VIDEO,dir:o.default.DOWNSTREAM},videoDownstreamFramesDecodedPerSecond:{source:"framesDecoded",media:n.default.VIDEO,dir:o.default.DOWNSTREAM},videoDownstreamFrameHeight:{source:"frameHeight",media:n.default.VIDEO,dir:o.default.DOWNSTREAM},videoDownstreamFrameWidth:{source:"frameWidth",media:n.default.VIDEO,dir:o.default.DOWNSTREAM}},this.observableMetricSpec={audioPacketsReceived:{source:"packetsReceived",media:n.default.AUDIO,dir:o.default.DOWNSTREAM},audioPacketsReceivedFractionLoss:{source:"packetsLost",media:n.default.AUDIO,dir:o.default.DOWNSTREAM},audioDecoderLoss:{source:"decoderLoss",media:n.default.AUDIO,dir:o.default.DOWNSTREAM},audioPacketsSent:{source:"packetsSent",media:n.default.AUDIO,dir:o.default.UPSTREAM},audioPacketLossPercent:{source:"packetsLost",media:n.default.AUDIO,dir:o.default.UPSTREAM},videoUpstreamBitrate:{source:"bytesSent",media:n.default.VIDEO,dir:o.default.UPSTREAM},videoPacketSentPerSecond:{source:"packetsSent",media:n.default.VIDEO,dir:o.default.UPSTREAM},audioSpeakerDelayMs:{source:"jitterBufferMs",media:n.default.AUDIO,dir:o.default.DOWNSTREAM},availableOutgoingBitrate:{source:"availableOutgoingBitrate"},availableIncomingBitrate:{source:"availableIncomingBitrate"},nackCountReceivedPerSecond:{source:"nackCount",media:n.default.VIDEO,dir:o.default.UPSTREAM}}}getMetricMap(e,t){switch(e){case n.default.AUDIO:switch(t){case o.default.UPSTREAM:return this.audioUpstreamMetricMap;case o.default.DOWNSTREAM:return this.audioDownstreamMetricMap}case n.default.VIDEO:switch(t){case o.default.UPSTREAM:return this.videoUpstreamMetricMap;case o.default.DOWNSTREAM:return this.videoDownstreamMetricMap}default:return this.globalMetricMap}}getObservableMetricValue(e){const t=this.observableMetricSpec[e],i=this.getMetricMap(t.media,t.dir)[t.source],s=i.transform,o=i.source;if(!t.hasOwnProperty("media"))return s(o||t.source);for(const e in this.streamMetricReports){const i=this.streamMetricReports[e];if(t.source in i.currentMetrics&&i.direction===t.dir&&i.mediaType===t.media)return s(o||t.source,Number(e))}return 0}getObservableVideoMetricValue(e,t){const i=this.observableVideoMetricSpec[e],s=this.getMetricMap(i.media,i.dir)[i.source],o=s.transform,n=s.source,r=this.streamMetricReports[t];return r&&i.source in r.currentMetrics?o(n||i.source,t):o(n||i.source)}getObservableMetrics(){const e={};for(const t in this.observableMetricSpec)e[t]=this.getObservableMetricValue(t);return e}getObservableVideoMetrics(){const e={};if(!this.videoStreamIndex||!this.selfAttendeeId)return this.logger.error("Need to define VideoStreamIndex and selfAttendeeId if using getObservableVideoMetrics API"),e;for(const t in this.streamMetricReports)if(this.streamMetricReports[t].mediaType===n.default.VIDEO){const i={};for(const e in this.observableVideoMetricSpec)if(this.observableVideoMetricSpec[e].dir===this.streamMetricReports[t].direction){const s=this.getObservableVideoMetricValue(e,Number(t));isNaN(s)||(i[e]=s)}const s=this.streamMetricReports[t].streamId,o=s?this.videoStreamIndex.attendeeIdForStreamId(s):this.selfAttendeeId;e[o]=e[o]?e[o]:{},e[o][t]=i}return e}getRTCStatsReport(){return this.rtcStatsReport}clone(){const e=new a(this.logger,this.videoStreamIndex,this.selfAttendeeId);return e.globalMetricReport=this.globalMetricReport,e.streamMetricReports=this.streamMetricReports,e.rtcStatsReport=this.rtcStatsReport,e.currentTimestampMs=this.currentTimestampMs,e.previousTimestampMs=this.previousTimestampMs,e}print(){const e={globalMetricReport:this.globalMetricReport,streamMetricReports:this.streamMetricReports,currentTimestampMs:this.currentTimestampMs,previousTimestampMs:this.previousTimestampMs};this.logger.debug((()=>`Client Metric Report: ${JSON.stringify(e)}`))}removeDestroyedSsrcs(){for(const e in this.streamMetricReports)this.currentSsrcs[e]||delete this.streamMetricReports[e]}}t.default=a},2306:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.previousMetrics={},this.currentMetrics={}}}},62811:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.previousMetrics={},this.currentMetrics={}}}},13940:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.minHealth=e.minHealth,this.maxHealth=e.maxHealth,this.currentHealth=e.initialHealth,this.currentData=t.clone()}minimumHealth(){return this.minHealth}maximumHealth(){return this.maxHealth}health(){return this.maximumHealth()}update(e){this.currentData=e}getConnectionHealthData(){return this.currentData.clone()}healthy(){return this.health()>this.minimumHealth()}healthIfChanged(){const e=this.health();return e!==this.currentHealth?(this.currentHealth=e,e):null}}},66688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}static isTimestampRecent(e,t){return Date.now()<e+t}setConnectionStartTime(){this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}reset(){this.connectionStartTimestampMs=0,this.consecutiveStatsWithNoPackets=0,this.lastPacketLossInboundTimestampMs=0,this.lastGoodSignalTimestampMs=0,this.lastWeakSignalTimestampMs=0,this.lastNoSignalTimestampMs=0,this.consecutiveMissedPongs=0,this.packetsReceivedInLastMinute=[],this.fractionPacketsLostInboundInLastMinute=[],this.audioSpeakerDelayMs=0,this.connectionStartTimestampMs=Date.now(),this.lastGoodSignalTimestampMs=Date.now()}isConnectionStartRecent(e){return i.isTimestampRecent(this.connectionStartTimestampMs,e)}isLastPacketLossRecent(e){return i.isTimestampRecent(this.lastPacketLossInboundTimestampMs,e)}isGoodSignalRecent(e){return i.isTimestampRecent(this.lastGoodSignalTimestampMs,e)}isWeakSignalRecent(e){return i.isTimestampRecent(this.lastWeakSignalTimestampMs,e)}isNoSignalRecent(e){return i.isTimestampRecent(this.lastNoSignalTimestampMs,e)}clone(){const e=new i;return e.connectionStartTimestampMs=this.connectionStartTimestampMs,e.consecutiveStatsWithNoPackets=this.consecutiveStatsWithNoPackets,e.lastPacketLossInboundTimestampMs=this.lastPacketLossInboundTimestampMs,e.lastGoodSignalTimestampMs=this.lastGoodSignalTimestampMs,e.lastWeakSignalTimestampMs=this.lastWeakSignalTimestampMs,e.lastNoSignalTimestampMs=this.lastNoSignalTimestampMs,e.consecutiveMissedPongs=this.consecutiveMissedPongs,e.packetsReceivedInLastMinute=this.packetsReceivedInLastMinute.slice(0),e.fractionPacketsLostInboundInLastMinute=this.fractionPacketsLostInboundInLastMinute.slice(0),e.audioSpeakerDelayMs=this.audioSpeakerDelayMs,e}setConsecutiveMissedPongs(e){this.consecutiveMissedPongs=e}setConsecutiveStatsWithNoPackets(e){this.consecutiveStatsWithNoPackets=e}setLastPacketLossInboundTimestampMs(e){this.lastPacketLossInboundTimestampMs=e}setLastNoSignalTimestampMs(e){this.lastNoSignalTimestampMs=e}setLastWeakSignalTimestampMs(e){this.lastWeakSignalTimestampMs=e}setLastGoodSignalTimestampMs(e){this.lastGoodSignalTimestampMs=e}setAudioSpeakerDelayMs(e){this.audioSpeakerDelayMs=e}}t.default=i},23731:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.minHealth=0,this.maxHealth=1,this.initialHealth=1,this.connectionUnhealthyThreshold=25,this.noSignalThresholdTimeMs=1e4,this.connectionWaitTimeMs=1e4,this.zeroBarsNoSignalTimeMs=5e3,this.oneBarWeakSignalTimeMs=5e3,this.twoBarsTimeMs=5e3,this.threeBarsTimeMs=1e4,this.fourBarsTimeMs=2e4,this.fiveBarsTimeMs=6e4,this.cooldownTimeMs=6e4,this.pastSamplesToConsider=15,this.goodSignalTimeMs=15e3,this.fractionalLoss=.5,this.packetsExpected=50,this.maximumTimesToWarn=2,this.missedPongsLowerThreshold=1,this.missedPongsUpperThreshold=4,this.maximumAudioDelayMs=6e4,this.maximumAudioDelayDataPoints=10}}},39708:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13940);class o extends s.default{constructor(e,t,i){super(t,i),this.logger=e,this.audioDelayPointsOverMaximum=0,o.CONNECTION_UNHEALTHY_THRESHOLD=t.connectionUnhealthyThreshold,o.CONNECTION_WAIT_TIME_MS=t.connectionWaitTimeMs,o.MISSED_PONGS_THRESHOLD=t.missedPongsUpperThreshold,o.MAXIMUM_AUDIO_DELAY_MS=t.maximumAudioDelayMs,o.MAXIMUM_AUDIO_DELAY_DATA_POINTS=t.maximumAudioDelayDataPoints}health(){if(this.currentData.isConnectionStartRecent(o.CONNECTION_WAIT_TIME_MS))return 1;const e=this.currentData.consecutiveStatsWithNoPackets>=o.CONNECTION_UNHEALTHY_THRESHOLD,t=this.currentData.consecutiveMissedPongs>=o.MISSED_PONGS_THRESHOLD;this.currentData.audioSpeakerDelayMs>o.MAXIMUM_AUDIO_DELAY_MS?this.audioDelayPointsOverMaximum+=1:this.audioDelayPointsOverMaximum=0;const i=this.audioDelayPointsOverMaximum>o.MAXIMUM_AUDIO_DELAY_DATA_POINTS;i&&(this.audioDelayPointsOverMaximum=0);return e||t||i?(this.logger.warn(`reconnection recommended due to: no packets received: ${e}, missed pongs: ${t}, bad audio delay: ${i}`),0):1}}t.default=o},51922:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(13940);class o extends s.default{constructor(e,t){super(e,t),this.coolDownTimeMs=e.cooldownTimeMs,this.pastSamplesToConsider=e.pastSamplesToConsider,this.fractionalLoss=e.fractionalLoss,this.packetsExpected=e.packetsExpected,this.maximumTimesToWarn=e.maximumTimesToWarn,this.lastWarnTimestampMs=0,this.warnCount=0}calculateFractionalLoss(){if(this.currentData.packetsReceivedInLastMinute.length<this.pastSamplesToConsider)return 0;const e=this.pastSamplesToConsider,t=e*this.packetsExpected;let i=0;for(let t=0;t<e;t++)i+=this.currentData.packetsReceivedInLastMinute[t];return Math.min(Math.max(1-i/t,0),1)}health(){if(Date.now()-this.lastWarnTimestampMs<this.coolDownTimeMs)return this.currentHealth;return this.calculateFractionalLoss()>=this.fractionalLoss?0!==this.currentHealth&&(this.lastWarnTimestampMs=Date.now(),this.warnCount++,this.warnCount>this.maximumTimesToWarn)?1:0:1}}t.default=o},68581:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(28660);t.default=class{constructor(e,t,i,s,o,n){this.audioVideoController=e,this.realtimeController=t,this.videoTileController=i,this.connectionHealthData=s,this.pingPong=o,this.statsCollector=n,this.isActive=!1,this.hasSeenValidPacketMetricsBefore=!1,this.lastAvailableSendBandwidthKbps=0,this.lastAvailableRecvBandwidthKbps=0,this.realtimeController.realtimeSubscribeToLocalSignalStrengthChange((e=>{this.isActive&&this.receiveSignalStrengthChange(e)}))}start(){this.isActive=!0,this.pingPong.addObserver(this),this.pingPong.start(),this.audioVideoController.addObserver(this)}stop(){this.isActive=!1,this.pingPong.removeObserver(this),this.pingPong.stop(),this.audioVideoController.removeObserver(this)}receiveSignalStrengthChange(e){0===e?this.connectionHealthData.setLastNoSignalTimestampMs(Date.now()):e<=.5?this.connectionHealthData.setLastWeakSignalTimestampMs(Date.now()):this.connectionHealthData.setLastGoodSignalTimestampMs(Date.now()),this.updateConnectionHealth()}didReceivePong(e,t,i){this.connectionHealthData.setConsecutiveMissedPongs(0),this.statsCollector.logLatency("ping_pong",t),this.statsCollector.logLatency("ping_pong_clock_skew",i),this.updateConnectionHealth()}didMissPongs(){this.connectionHealthData.setConsecutiveMissedPongs(this.connectionHealthData.consecutiveMissedPongs+1),this.updateConnectionHealth()}metricsDidReceive(e){let t=0,i=0;const s=e.getObservableMetrics(),o=s.audioPacketsReceived,n=s.audioPacketsReceivedFractionLoss;let r=0;const a=s.videoPacketSentPerSecond,d=s.videoUpstreamBitrate,l=s.availableOutgoingBitrate,c=s.availableIncomingBitrate,u=s.audioSpeakerDelayMs,h=s.nackCountReceivedPerSecond;"number"!=typeof l||isNaN(l)||this.updateAvailableSendBandwidth(l/1e3,h),"number"!=typeof c||isNaN(c)||this.updateAvailableReceiveBandwidth(c/1e3),"number"!=typeof d||isNaN(d)||(r=d/1e3),"number"!=typeof u||isNaN(u)||this.connectionHealthData.setAudioSpeakerDelayMs(u),this.monitorVideoUplinkHealth(r,a),"number"==typeof o&&"number"==typeof n&&(t=o,i=n,t<0||i<0||(this.addToMinuteWindow(this.connectionHealthData.packetsReceivedInLastMinute,t),this.addToMinuteWindow(this.connectionHealthData.fractionPacketsLostInboundInLastMinute,i),t>0?(this.hasSeenValidPacketMetricsBefore=!0,this.connectionHealthData.setConsecutiveStatsWithNoPackets(0)):this.hasSeenValidPacketMetricsBefore&&this.connectionHealthData.setConsecutiveStatsWithNoPackets(this.connectionHealthData.consecutiveStatsWithNoPackets+1),(0===t||i>0)&&this.connectionHealthData.setLastPacketLossInboundTimestampMs(Date.now()),this.updateConnectionHealth()))}addToMinuteWindow(e,t){e.unshift(t),e.length>60&&e.pop()}updateAvailableSendBandwidth(e,t){if(e!==this.lastAvailableSendBandwidthKbps){if(0===this.lastAvailableSendBandwidthKbps)return void(this.lastAvailableSendBandwidthKbps=e);const i=this.lastAvailableSendBandwidthKbps;this.lastAvailableSendBandwidthKbps=e,this.audioVideoController.forEachObserver((o=>{s.Maybe.of(o.videoSendBandwidthDidChange).map((s=>s.bind(o)(e,i,t)))}))}}updateAvailableReceiveBandwidth(e){if(e!==this.lastAvailableRecvBandwidthKbps){if(0===this.lastAvailableRecvBandwidthKbps)return void(this.lastAvailableRecvBandwidthKbps=e);const t=this.lastAvailableRecvBandwidthKbps;this.lastAvailableRecvBandwidthKbps=e,this.audioVideoController.forEachObserver((i=>{s.Maybe.of(i.videoReceiveBandwidthDidChange).map((s=>s.bind(i)(e,t)))}))}}updateConnectionHealth(){this.audioVideoController.forEachObserver((e=>{s.Maybe.of(e.connectionHealthDidChange).map((t=>t.bind(e)(this.connectionHealthData.clone())))}))}monitorVideoUplinkHealth(e,t){this.videoTileController.hasStartedLocalVideoTile()&&this.audioVideoController.forEachObserver((i=>{s.Maybe.of(i.videoSendHealthDidChange).map((s=>s.bind(i)(e,t)))}))}}},18890:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Modality="#content"}(i||(i={})),t.default=i},78370:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(90543),n=i(44142);class r{constructor(e){this.logger=e}get mediaStream(){return this._mediaStream}set mediaStream(e){this._mediaStream=e}acquireAudioInputStream(){return s(this,void 0,void 0,(function*(){return 0===this._mediaStream.getAudioTracks().length?(this.logger.info("No audio stream available. Synthesizing an audio stream."),n.default.synthesizeAudioDevice(0)):this._mediaStream}))}acquireVideoInputStream(){return s(this,void 0,void 0,(function*(){return this._mediaStream}))}releaseMediaStream(e){this.logger.warn("release media stream called")}acquireDisplayInputStream(e){return s(this,void 0,void 0,(function*(){return e&&e.video&&e.video.mandatory&&e.video.mandatory.chromeMediaSource&&e.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(e):navigator.mediaDevices.getDisplayMedia(e)}))}bindToAudioVideoController(e){throw new Error("unsupported")}acquireScreenCaptureDisplayInputStream(e,t){return s(this,void 0,void 0,(function*(){return this.acquireDisplayInputStream(this.screenCaptureDisplayMediaConstraints(e,t))}))}screenCaptureDisplayMediaConstraints(e,t){return{audio:!(e||!(new o.default).getDisplayMediaAudioCaptureSupport()),video:Object.assign(Object.assign({},!e&&{frameRate:{max:t||r.defaultFrameRate}}),e&&{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:t||r.defaultFrameRate}})}}toggleMediaStream(e){let t=!1;if(this.mediaStream)for(let i=0;i<this.mediaStream.getTracks().length;i++)this.mediaStream.getTracks()[i].enabled!==e&&(this.mediaStream.getTracks()[i].enabled=e,t=!0);return t}cleanup(){if(this.mediaStream)for(let e=0;e<this.mediaStream.getTracks().length;e++){this.mediaStream.getTracks()[e].stop()}this.mediaStream=null}}t.default=r,r.defaultFrameRate=15},38023:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(10589),n=i(68015),r=i(60214),a=i(37797),d=i(28660),l=i(18890);t.default=class{constructor(e,t,i){this.mediaStreamBroker=e,this.contentAudioVideo=t,this.attendeeAudioVideo=i,this.observerQueue=new Set,this.destroyed=!1,this.contentAudioVideo.addObserver(this),this.setupContentShareEvents()}static createContentShareMeetingSessionConfigure(e){const t=new o.default;return t.meetingId=e.meetingId,t.externalMeetingId=e.externalMeetingId,t.urls=e.urls,t.credentials=new n.default,t.credentials.attendeeId=e.credentials.attendeeId+l.default.Modality,t.credentials.externalUserId=e.credentials.externalUserId,t.credentials.joinToken=e.credentials.joinToken+l.default.Modality,t}setContentAudioProfile(e){this.contentAudioVideo.setAudioProfile(e)}startContentShare(e){return s(this,void 0,void 0,(function*(){if(e){this.mediaStreamBroker.mediaStream=e;for(let e=0;e<this.mediaStreamBroker.mediaStream.getTracks().length;e++)this.mediaStreamBroker.mediaStream.getTracks()[e].addEventListener("ended",(()=>{this.stopContentShare()}));this.contentAudioVideo.start(),this.mediaStreamBroker.mediaStream.getVideoTracks().length>0&&this.contentAudioVideo.videoTileController.startLocalVideoTile()}}))}startContentShareFromScreenCapture(e,t){return s(this,void 0,void 0,(function*(){const i=yield this.mediaStreamBroker.acquireScreenCaptureDisplayInputStream(e,t);return yield this.startContentShare(i),i}))}pauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!1)&&this.forEachContentShareObserver((e=>{d.Maybe.of(e.contentShareDidPause).map((t=>t.call(e)))}))}unpauseContentShare(){this.mediaStreamBroker.toggleMediaStream(!0)&&this.forEachContentShareObserver((e=>{d.Maybe.of(e.contentShareDidUnpause).map((t=>t.call(e)))}))}destroy(){return s(this,void 0,void 0,(function*(){this.contentAudioVideo&&(this.destroyed=!0,this.contentAudioVideo.removeObserver(this),this.stopContentShare(),this.observerQueue.clear(),this.contentAudioVideo=void 0,this.attendeeAudioVideo=void 0,this.mediaStreamBroker=void 0)}))}stopContentShare(){this.contentAudioVideo.stop(),this.mediaStreamBroker.cleanup()}addContentShareObserver(e){this.observerQueue.add(e)}removeContentShareObserver(e){this.observerQueue.delete(e)}forEachContentShareObserver(e){for(const t of this.observerQueue)a.default.nextTick((()=>{this.observerQueue.has(t)&&e(t)}))}audioVideoDidStop(e){this.mediaStreamBroker.cleanup(),this.contentShareTile&&(this.attendeeAudioVideo.videoTileController.removeVideoTile(this.contentShareTile.id()),this.contentShareTile=null),this.forEachContentShareObserver((e=>{d.Maybe.of(e.contentShareDidStop).map((t=>t.call(e)))}))}setupContentShareEvents(){this.attendeeAudioVideo.realtimeController.realtimeSubscribeToAttendeeIdPresence(((e,t,i,s)=>{const o=new r.default(e).hasModality(r.default.MODALITY_CONTENT),n=new r.default(e).base()===this.attendeeAudioVideo.configuration.credentials.attendeeId;if(!o||!n||!t||this.contentShareTile)return;const a=this.mediaStreamBroker.mediaStream;if(null==a?void 0:a.getVideoTracks().length){this.contentShareTile=this.attendeeAudioVideo.videoTileController.addVideoTile();const e=a.getVideoTracks()[0];let t,i;if(e.getSettings){const s=e.getSettings();t=s.width,i=s.height}else{const s=e.getCapabilities();t=s.width,i=s.height}this.contentShareTile.bindVideoStream(this.contentAudioVideo.configuration.credentials.attendeeId,!1,a,t,i,null,this.contentAudioVideo.configuration.credentials.externalUserId)}this.forEachContentShareObserver((e=>{d.Maybe.of(e.contentShareDidStart).map((t=>t.call(e)))}))}))}}},47237:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static register(){"document"in i.g&&document.addEventListener&&s.shouldRegisterCSPMonitor&&(s.added||(document.addEventListener("securitypolicyviolation",s.listener),s.added=!0))}static unregister(){"document"in i.g&&document.removeEventListener&&(document.removeEventListener("securitypolicyviolation",s.listener),s.loggers=new Set,s.added=!1)}static disable(){s.shouldRegisterCSPMonitor=!1,s.unregister()}static addLogger(e){e&&s.loggers.add(e)}static removeLogger(e){e&&s.loggers.delete(e)}}t.default=s,s.loggers=new Set,s.shouldRegisterCSPMonitor=!0,s.added=!1,s.listener=e=>{const t=`Security Policy Violation\nBlocked URI: ${e.blockedURI}\nViolated Directive: ${e.violatedDirective}\nOriginal Policy: ${e.originalPolicy}\nDocument URI: ${e.documentURI}\nSource File: ${e.sourceFile}\nLine No.: ${e.lineNumber}\n`;for(const e of s.loggers)e.error(t);0===s.loggers.size&&console.error(t)}},11018:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i,s,o,n){this.timestampMs=e,this.topic=t,this.data=i,this.senderAttendeeId=s,this.senderExternalUserId=o,this.throttled=!!n}text(){return(new TextDecoder).decode(this.data)}json(){return JSON.parse((new TextDecoder).decode(this.data))}}},70146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDestroyable=void 0,t.isDestroyable=function(e){return e&&"destroy"in e}},91746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAudioTransformDevice=void 0,t.isAudioTransformDevice=function(e){return!!e&&"object"==typeof e&&"mute"in e&&"stop"in e&&"intrinsicDevice"in e}},44142:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(90543),n=i(66354),r=i(37797),a=i(23922),d=i(28660),l=i(3327),c=i(91746),u=i(78128),h=i(95348),m=i(31238),v=i(63110),f=i(44842),g=i(6991),p=i(86950),S=i(64500),C=i(27170);class b{constructor(e,t,i=new o.default,s){this.logger=e,this.browserBehavior=i,this.eventController=s,this.deviceInfoCache=null,this.activeDevices={audio:null,video:null},this.chosenVideoTransformDevice=null,this.audioOutputDeviceId=null,this.deviceChangeObservers=new Set,this.deviceLabelTrigger=()=>navigator.mediaDevices.getUserMedia({audio:!0,video:!0}),this.audioInputDestinationNode=null,this.audioInputSourceNode=null,this.videoInputQualitySettings=null,this.useWebAudio=!1,this.inputDeviceCount=0,this.mediaStreamMuteObserver=(e,t)=>{for(const i of this.deviceChangeObservers)r.default.nextTick((()=>{this.deviceChangeObservers.has(i)&&i.audioInputMuteStateChanged&&i.audioInputMuteStateChanged(e,t)}))},this.alreadyHandlingDeviceChange=!1;const{enableWebAudio:a=!1}=t||{};this.useWebAudio=a,this.muteCallback=e=>{var t;null===(t=this.transform)||void 0===t||t.device.mute(e)},this.videoInputQualitySettings=new S.default(b.defaultVideoWidth,b.defaultVideoHeight,b.defaultVideoFrameRate,b.defaultVideoMaxBandwidthKbps);const d=this.browserBehavior.requiresResolutionAlignment(this.videoInputQualitySettings.videoWidth,this.videoInputQualitySettings.videoHeight);this.videoInputQualitySettings.videoWidth=d[0],this.videoInputQualitySettings.videoHeight=d[1],this.logger.info(`DefaultDeviceController video dimension ${this.videoInputQualitySettings.videoWidth} x ${this.videoInputQualitySettings.videoHeight}`);try{this.mediaDeviceWrapper=(new n.default).create();const e=navigator.mediaDevices.getSupportedConstraints();this.logger.info(`Supported Constraints in this browser ${JSON.stringify(e)}`)}catch(t){e.error(t.message)}}isWatchingForDeviceChanges(){return!!this.onDeviceChangeCallback}ensureWatchingDeviceChanges(){var e;this.isWatchingForDeviceChanges()||(this.logger.info("Starting devicechange listener."),this.onDeviceChangeCallback=()=>{this.logger.info("Device change event callback is triggered"),this.handleDeviceChange()},null===(e=this.mediaDeviceWrapper)||void 0===e||e.addEventListener("devicechange",this.onDeviceChangeCallback))}stopWatchingDeviceChanges(){var e;this.isWatchingForDeviceChanges()&&(this.logger.info("Stopping devicechange listener."),null===(e=this.mediaDeviceWrapper)||void 0===e||e.removeEventListener("devicechange",this.onDeviceChangeCallback),this.onDeviceChangeCallback=void 0)}shouldObserveDeviceChanges(){if(this.deviceChangeObservers.size)return!0;return this.activeDevices.audio&&null!==this.activeDevices.audio.constraints||this.activeDevices.video&&null!==this.activeDevices.video.constraints||!!this.audioOutputDeviceId}watchForDeviceChangesIfNecessary(){this.shouldObserveDeviceChanges()?this.ensureWatchingDeviceChanges():this.stopWatchingDeviceChanges()}destroy(){var e,t;return s(this,void 0,void 0,(function*(){this.stopWatchingDeviceChanges(),yield this.chooseAudioInputDevice(null),yield this.chooseVideoInputDevice(null),null===(e=this.audioInputSourceNode)||void 0===e||e.disconnect(),null===(t=this.audioInputDestinationNode)||void 0===t||t.disconnect(),this.audioInputSourceNode=void 0,this.audioInputDestinationNode=void 0}))}listAudioInputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("audioinput",e);return this.trace("listAudioInputDevices",e,t),t}))}listVideoInputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("videoinput",e);return this.trace("listVideoInputDevices",e,t),t}))}listAudioOutputDevices(e=!1){return s(this,void 0,void 0,(function*(){const t=yield this.listDevicesOfKind("audiooutput",e);return this.trace("listAudioOutputDevices",e,t),t}))}pushAudioMeetingStateForPermissions(e){var t;null===(t=this.eventController)||void 0===t||t.publishEvent(null===e?"audioInputUnselected":"audioInputSelected")}pushVideoMeetingStateForPermissions(e){var t;null===(t=this.eventController)||void 0===t||t.publishEvent(null===e?"videoInputUnselected":"videoInputSelected")}chooseAudioInputDevice(e){var t,i;return s(this,void 0,void 0,(function*(){if(void 0===e)return void this.logger.error("Audio input device cannot be undefined");let s=this.useWebAudio;this.useWebAudio||this.logger.debug("Not using Web Audio. No need to recreate audio context."),"suspended"===(null===(t=b.audioContext)||void 0===t?void 0:t.state)&&(s=!1),s&&!this.browserBehavior.requiresContextRecreationForAudioWorklet()&&(this.logger.debug("Browser does not require audio context recreation hack."),s=!1),s&&!this.transform&&c.isAudioTransformDevice(e)&&(this.logger.debug("Neither device is a transform. No need to recreate audio context."),s=!1),s&&(this.logger.info("Recreating audio context when selecting new device."),this.transform&&(this.transform.nodes&&(this.transform.nodes.end.disconnect(),this.transform.nodes=void 0),this.transform=void 0),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0),b.closeAudioContext()),c.isAudioTransformDevice(e)?(this.logger.info(`Choosing transform input device ${e}`),yield this.chooseAudioTransformInputDevice(e)):(this.logger.info(`Choosing intrinsic audio input device ${e}`),this.removeTransform(),yield this.chooseInputIntrinsicDevice("audio",e,!1),this.trace("chooseAudioInputDevice",e,"success")),s&&(null===(i=this.boundAudioVideoController)||void 0===i?void 0:i.rtcPeerConnection)&&this.boundAudioVideoController.restartLocalAudio((()=>{this.logger.info("Local audio restarted.")})),this.pushAudioMeetingStateForPermissions(e)}))}chooseAudioTransformInputDevice(e){var t;return s(this,void 0,void 0,(function*(){if((null===(t=this.transform)||void 0===t?void 0:t.device)===e)return;if(!this.useWebAudio)throw new Error("Cannot apply transform device without enabling Web Audio.");const i=b.getAudioContext();if(i instanceof OfflineAudioContext);else switch(i.state){case"running":break;case"closed":throw new Error("Cannot choose a transform device with a closed audio context.");case"suspended":yield i.resume()}let s;try{s=yield e.createAudioNode(i)}catch(e){throw this.logger.error(`Unable to create transform device node: ${e}.`),e}const o=yield e.intrinsicDevice();yield this.chooseInputIntrinsicDevice("audio",o,!1),this.logger.debug(`Got inner stream: ${o}.`),this.setTransform(e,s)}))}chooseVideoTransformInputDevice(e){var t,i;return s(this,void 0,void 0,(function*(){if(e===this.chosenVideoTransformDevice)return void this.logger.info("Reselecting same VideoTransformDevice");const s=this.chosenVideoTransformDevice;s&&this.logger.info("Switched from previous VideoTransformDevice");const o=!!s,n=yield e.intrinsicDevice();if(!this.isMediaStreamReusableByDeviceId(null===(t=this.activeDevices.video)||void 0===t?void 0:t.stream,n))return this.logger.info("video transform device needs new intrinsic device"),o&&s.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=e,this.activeDevices.video=null,void(yield this.chooseInputIntrinsicDevice("video",n,!1,!0));this.chosenVideoTransformDevice=e;const r=this.activeDevices.video.stream;if(this.logger.info("video transform device uses previous stream"),!n.id){const e=n;e.width=e.width||this.videoInputQualitySettings.videoWidth,e.height=e.height||this.videoInputQualitySettings.videoHeight,e.frameRate=e.frameRate||this.videoInputQualitySettings.videoFrameRate,yield r.getVideoTracks()[0].applyConstraints(e)}yield e.transformStream(this.activeDevices.video.stream),(null===(i=this.boundAudioVideoController)||void 0===i?void 0:i.videoTileController.hasStartedLocalVideoTile())&&(this.boundAudioVideoController.replaceLocalVideo?this.restartLocalVideoAfterSelection(!1,!0):yield this.boundAudioVideoController.update({needsRenegotiation:!0}))}))}chooseVideoInputDevice(e){return s(this,void 0,void 0,(function*(){if(void 0!==e){if(C.isVideoTransformDevice(e))return this.logger.info(`Choosing video transform device ${e}`),this.chooseVideoTransformInputDevice(e);this.updateMaxBandwidthKbps(),this.chosenVideoInputIsTransformDevice()&&(this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null),yield this.chooseInputIntrinsicDevice("video",e,!1),this.trace("chooseVideoInputDevice",e),this.pushVideoMeetingStateForPermissions(e)}else this.logger.error("Video input device cannot be undefined")}))}chooseAudioOutputDevice(e){return s(this,void 0,void 0,(function*(){this.audioOutputDeviceId=e,this.watchForDeviceChangesIfNecessary(),yield this.bindAudioOutput(),this.trace("chooseAudioOutputDevice",e,null)}))}addDeviceChangeObserver(e){this.logger.info("adding device change observer"),this.deviceChangeObservers.add(e),this.watchForDeviceChangesIfNecessary(),this.trace("addDeviceChangeObserver")}removeDeviceChangeObserver(e){this.logger.info("removing device change observer"),this.deviceChangeObservers.delete(e),this.watchForDeviceChangesIfNecessary(),this.trace("removeDeviceChangeObserver")}createAnalyserNodeForAudioInput(){var e,t;if(!this.activeDevices.audio)return null;const i=null===(t=null===(e=this.transform)||void 0===e?void 0:e.nodes)||void 0===t?void 0:t.end;if(i){const e=i.context.createAnalyser();return e.removeOriginalInputs=()=>{try{i.disconnect(e)}catch(e){}},i.connect(e),e}return this.createAnalyserNodeForRawAudioInput()}createAnalyserNodeForRawAudioInput(){return this.activeDevices.audio?this.createAnalyserNodeForStream(this.activeDevices.audio.stream):null}createAnalyserNodeForStream(e){const t=b.getAudioContext(),i=t.createAnalyser(),s=t.createMediaStreamSource(e);return s.connect(i),this.trace("createAnalyserNodeForAudioInput"),i.removeOriginalInputs=()=>{try{s.disconnect(i)}catch(e){}},i}startVideoPreviewForVideoInput(e){if(!this.activeDevices.video)return this.logger.warn("cannot bind video preview since video input device has not been chosen"),void this.trace("startVideoPreviewForVideoInput",e.id);const t=e.srcObject;t&&this.activeDevices.video.stream!==t&&(this.releaseMediaStream(e.srcObject),l.default.disconnectVideoStreamFromVideoElement(e,!1)),this.chosenVideoTransformDevice?l.default.connectVideoStreamToVideoElement(this.chosenVideoTransformDevice.outputMediaStream,e,!0):l.default.connectVideoStreamToVideoElement(this.activeDevices.video.stream,e,!0),this.trace("startVideoPreviewForVideoInput",e.id)}stopVideoPreviewForVideoInput(e){const t=e.srcObject,i=this.activeDevices.video;i&&this.releaseActiveDevice(i),t&&(this.releaseMediaStream(t),l.default.disconnectVideoStreamFromVideoElement(e,!1)),this.trace("stopVideoPreviewForVideoInput",e.id)}setDeviceLabelTrigger(e){if(this.deviceInfoCache)for(const e of this.deviceInfoCache)if(!e.label){this.deviceInfoCache=null;break}this.deviceLabelTrigger=e,this.trace("setDeviceLabelTrigger")}mixIntoAudioInput(e){let t=null;return this.useWebAudio?(t=b.getAudioContext().createMediaStreamSource(e),t.connect(this.getMediaStreamOutputNode())):this.logger.warn("WebAudio is not enabled, mixIntoAudioInput will not work"),this.trace("mixIntoAudioInput",e.id),t}chooseVideoInputQuality(e,t,i,s){const o=this.browserBehavior.requiresResolutionAlignment(e,t);this.videoInputQualitySettings=new S.default(o[0],o[1],i,s),this.updateMaxBandwidthKbps()}getVideoInputQualitySettings(){return this.videoInputQualitySettings}acquireAudioInputStream(){return this.acquireInputStream("audio")}acquireVideoInputStream(){return this.acquireInputStream("video")}acquireDisplayInputStream(e){return s(this,void 0,void 0,(function*(){return e&&e.video&&e.video.mandatory&&e.video.mandatory.chromeMediaSource&&e.video.mandatory.chromeMediaSourceId?navigator.mediaDevices.getUserMedia(e):navigator.mediaDevices.getDisplayMedia(e)}))}releaseAudioTransformStream(){this.logger.info("Stopping audio track for Web Audio graph"),this.stopTracksAndRemoveCallbacks("audio"),this.logger.info("Removing audio transform, if there is one."),this.removeTransform(),this.audioInputSourceNode&&(this.audioInputSourceNode.disconnect(),this.audioInputSourceNode=void 0),this.audioInputDestinationNode&&(this.audioInputDestinationNode.disconnect(),this.audioInputDestinationNode=void 0)}releaseVideoTransformStream(){this.logger.info("Stopping video track for transform"),this.stopTracksAndRemoveCallbacks("video"),this.logger.info("Disconnecting video transform"),this.chosenVideoTransformDevice.onOutputStreamDisconnect(),this.chosenVideoTransformDevice=null}stopTracksAndRemoveCallbacks(e){const t=this.activeDevices[e];if(!t)return;const i=t.endedCallback,s=t.trackMuteCallback,o=t.trackUnmuteCallback;for(const n of t.stream.getTracks())n.stop(),i&&n.removeEventListener("ended",i),s&&n.removeEventListener("mute",s),o&&n.removeEventListener("unmute",o),delete t.endedCallback,delete t.trackMuteCallback,delete t.trackUnmuteCallback,delete this.activeDevices[e]}releaseOrdinaryStream(e){var t;const i=e.getTracks();if(i.length){for(const e of i)e.stop();for(const i in this.activeDevices){const s=this.activeDevices[i];if((null==s?void 0:s.stream)===e){switch(i){case"audio":for(const t of e.getAudioTracks())t.removeEventListener("mute",s.trackMuteCallback),t.removeEventListener("unmute",s.trackUnmuteCallback),t.removeEventListener("ended",s.endedCallback);delete s.trackMuteCallback,delete s.trackUnmuteCallback,delete s.endedCallback;break;case"video":{if(s.endedCallback){for(const t of e.getTracks())t.removeEventListener("ended",s.endedCallback);delete s.endedCallback}const i=null===(t=this.boundAudioVideoController)||void 0===t?void 0:t.videoTileController;(null==i?void 0:i.hasStartedLocalVideoTile())&&i.stopLocalVideoTile();break}}delete this.activeDevices[i]}}}}releaseMediaStream(e){var t,i;if(e)try{if(e===(null===(t=this.audioInputDestinationNode)||void 0===t?void 0:t.stream))return void this.releaseAudioTransformStream();if(e===(null===(i=this.chosenVideoTransformDevice)||void 0===i?void 0:i.outputMediaStream))return void this.releaseVideoTransformStream();this.releaseOrdinaryStream(e)}finally{this.watchForDeviceChangesIfNecessary()}}chosenVideoInputIsTransformDevice(){return!!this.chosenVideoTransformDevice}bindToAudioVideoController(e){this.boundAudioVideoController&&this.unsubscribeFromMuteAndUnmuteLocalAudio(),this.boundAudioVideoController=e,this.subscribeToMuteAndUnmuteLocalAudio(),this.browserBehavior.supportsSetSinkId()&&r.default.nextTick((()=>{this.bindAudioOutput()}))}subscribeToMuteAndUnmuteLocalAudio(){this.boundAudioVideoController&&this.boundAudioVideoController.realtimeController&&this.boundAudioVideoController.realtimeController.realtimeSubscribeToMuteAndUnmuteLocalAudio(this.muteCallback)}unsubscribeFromMuteAndUnmuteLocalAudio(){this.boundAudioVideoController.realtimeController&&this.boundAudioVideoController.realtimeController.realtimeUnsubscribeToMuteAndUnmuteLocalAudio(this.muteCallback)}static getIntrinsicDeviceId(e){if(void 0===e)return;if(null===e)return null;if("string"==typeof e)return e;if(e.id)return e.id;const t=e.deviceId;if(void 0===t)return;if(null===t)return null;if("string"==typeof t||Array.isArray(t))return t;const i=t;return"string"==typeof i.exact||Array.isArray(i.exact)?i.exact:void 0}static createEmptyAudioDevice(){return b.synthesizeAudioDevice(0)}static createEmptyVideoDevice(){return b.synthesizeVideoDevice("black")}static synthesizeAudioDevice(e){const t=b.getAudioContext(),i=t.createMediaStreamDestination();if(e){const s=t.createGain();s.gain.value=.1,s.connect(i);const o=t.createOscillator();o.frequency.value=e,o.connect(s),o.start()}else{const e=t.createBufferSource();try{e.buffer=t.createBuffer(1,5*t.sampleRate,t.sampleRate)}catch(i){if(!i||"NotSupportedError"!==i.name)throw i;e.buffer=t.createBuffer(1,5*b.defaultSampleRate,b.defaultSampleRate)}e.buffer.getChannelData(0)[0]=3e-4,e.loop=!0,e.connect(i),e.start()}return i.stream}static synthesizeVideoDevice(e){const t=document.createElement("canvas");t.width=480,t.height=t.width/16*9;const i=function(e,t){const i=new a.default(1e3),s=e.getContext("2d"),o=e.captureStream(5)||null;if(!o)return;i.start((()=>{"smpte"===t?function(e,t){const i=e.width,s=e.height,o=2*s/3,n=3*s/4,r=s,a=["#c0c0c0","#c0c000","#00c0c0","#00c000","#c000c0","#c00000","#0000c0"],d=["#0000c0","#000000","#c000c0","#000000","#00c0c0","#000000","#c0c0c0"],l=["#00214c","#ffffff","#32006a","#131313","#090909","#131313","#1d1d1d","#131313"],c=[0*i,1*i/4*(5/7),2*i/4*(5/7),3*i/4*(5/7),i*(5/7),i*(5/7+1/21),i*(5/7+2/21),i*(6/7),1*i],u=i/a.length,h=e.getContext("2d");for(let e=0;e<a.length;e++)h.fillStyle=a[e],h.fillRect(t+e*u,0,u,o),h.fillStyle=d[e],h.fillRect(t+e*u,o,u,n-o);for(let e=0;e<l.length;e++)h.fillStyle=l[e],h.fillRect(t+c[e],n,c[e+1]-c[e],r-n)}(e,0):(s.fillStyle=t,s.fillRect(0,0,e.width,e.height))}));const n=()=>{i.stop()};return o.getVideoTracks()[0].addEventListener("ended",n),{listener:n,scheduler:i,stream:o}}(t,e);if(!i)return null;const{stream:s}=i;return s}updateMaxBandwidthKbps(){this.boundAudioVideoController&&this.boundAudioVideoController.setVideoMaxBandwidthKbps(this.videoInputQualitySettings.videoMaxBandwidthKbps)}listDevicesOfKind(e,t){return s(this,void 0,void 0,(function*(){return!t&&null!==this.deviceInfoCache&&this.isWatchingForDeviceChanges()||(yield this.updateDeviceInfoCacheFromBrowser()),this.listCachedDevicesOfKind(e)}))}updateDeviceInfoCacheFromBrowser(){return s(this,void 0,void 0,(function*(){if("undefined"==typeof MediaDeviceInfo)return void(this.deviceInfoCache=[]);let e=yield navigator.mediaDevices.enumerateDevices(),t=!0;for(const i of e)if(!i.label){t=!1;break}if(!t)try{this.logger.info("attempting to trigger media device labels since they are hidden");const t=yield this.deviceLabelTrigger();e=yield navigator.mediaDevices.enumerateDevices();for(const e of t.getTracks())e.stop()}catch(e){this.logger.info("unable to get media device labels")}this.logger.debug(`Update device info cache with devices: ${JSON.stringify(e)}`),this.deviceInfoCache=e}))}listCachedDevicesOfKind(e){const t=[];for(const i of this.deviceInfoCache)i.kind===e&&t.push(i);return t}handleDeviceChange(){return s(this,void 0,void 0,(function*(){if(null===this.deviceInfoCache)return;if(this.alreadyHandlingDeviceChange)return void r.default.nextTick((()=>{this.handleDeviceChange()}));this.alreadyHandlingDeviceChange=!0;const e=this.listCachedDevicesOfKind("audioinput"),t=this.listCachedDevicesOfKind("videoinput"),i=this.listCachedDevicesOfKind("audiooutput");yield this.updateDeviceInfoCacheFromBrowser();const s=this.listCachedDevicesOfKind("audioinput"),o=this.listCachedDevicesOfKind("videoinput"),n=this.listCachedDevicesOfKind("audiooutput");this.forEachObserver((r=>{this.areDeviceListsEqual(e,s)||d.Maybe.of(r.audioInputsChanged).map((e=>e.bind(r)(s))),this.areDeviceListsEqual(t,o)||d.Maybe.of(r.videoInputsChanged).map((e=>e.bind(r)(o))),this.areDeviceListsEqual(i,n)||d.Maybe.of(r.audioOutputsChanged).map((e=>e.bind(r)(n)))})),this.alreadyHandlingDeviceChange=!1}))}handleDeviceStreamEnded(e,t){return s(this,void 0,void 0,(function*(){try{yield this.chooseInputIntrinsicDevice(e,null,!1)}catch(e){this.logger.error("Failed to choose null device after stream ended.")}"audio"===e?this.forEachObserver((e=>{d.Maybe.of(e.audioInputStreamEnded).map((i=>i.bind(e)(t)))})):this.forEachObserver((e=>{d.Maybe.of(e.videoInputStreamEnded).map((i=>i.bind(e)(t)))}))}))}forEachObserver(e){for(const t of this.deviceChangeObservers)r.default.nextTick((()=>{this.deviceChangeObservers.has(t)&&e(t)}))}areDeviceListsEqual(e,t){return JSON.stringify(e.map((e=>JSON.stringify(e))).sort())===JSON.stringify(t.map((e=>JSON.stringify(e))).sort())}intrinsicDeviceAsMediaStream(e){return e&&e.id?e:null}hasSameMediaStreamId(e,t,i){var s,o,n,r;let a;return"audio"===e?(a=null==i?void 0:i.audio.streamId,!!a&&a===(null===(o=null===(s=t.constraints)||void 0===s?void 0:s.audio)||void 0===o?void 0:o.streamId)):(a=null==i?void 0:i.video.streamId,!!a&&a===(null===(r=null===(n=null==t?void 0:t.constraints)||void 0===n?void 0:n.video)||void 0===r?void 0:r.streamId))}hasSameGroupId(e,t,i){if(""===e)return!0;const s=b.getIntrinsicDeviceId(i);return this.logger.debug(`Checking deviceIds ${s} of type ${typeof s} with groupId ${e}`),"string"==typeof s&&e===this.getGroupIdFromDeviceId(t,s)}getGroupIdFromDeviceId(e,t){if(null!==this.deviceInfoCache){const i=this.listCachedDevicesOfKind(`${e}input`).find((e=>e.deviceId===t));if(i&&i.groupId)return this.logger.debug(`GroupId of deviceId ${t} found in cache is ${i.groupId}`),i.groupId}else this.logger.error("Device cache is not populated. Please make sure to call list devices first");return this.logger.debug(`GroupId of deviceId ${t} found in cache is empty`),""}getActiveDeviceId(e){if(this.activeDevices[e]&&this.activeDevices[e].constraints){const t=(this.activeDevices[e].constraints.audio||this.activeDevices[e].constraints.video).deviceId;let i;return i="string"==typeof t?t:t.exact,i}return null}restartLocalVideoAfterSelection(e,t){return s(this,void 0,void 0,(function*(){!e&&this.boundAudioVideoController&&this.boundAudioVideoController.videoTileController.hasStartedLocalVideoTile()&&(t?(yield this.boundAudioVideoController.replaceLocalVideo(),this.logger.info("successfully replaced video track")):(this.logger.info("restarting local video to switch to new device"),this.boundAudioVideoController.restartLocalVideo((()=>{}))))}))}handleGetUserMediaError(e,t){if(!e)throw new h.default(e);switch(e.name){case"NotReadableError":case"TrackStartError":throw new v.default(e);case"NotFoundError":case"DevicesNotFoundError":throw new m.default(e);case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":throw t&&t<b.permissionDeniedOriginDetectionThresholdMs?new g.default(e,"Permission denied by browser"):new g.default(e,"Permission denied by user");case"OverconstrainedError":case"ConstraintNotSatisfiedError":throw new f.default(e);case"TypeError":throw new p.default(e);case"AbortError":default:throw new h.default(e)}}releaseActiveDevice(e){if(e&&e.stream){if(e.endedCallback){const t=e.stream.getTracks()[0];t&&t.removeEventListener("ended",e.endedCallback)}delete e.endedCallback,this.releaseMediaStream(e.stream),delete e.stream}}matchesDeviceSelection(e,t,i,s){return!!(i&&i.stream.active&&(this.hasSameMediaStreamId(e,i,s)||null!==i.groupId&&this.hasSameGroupId(i.groupId,e,t)))&&(this.logger.debug(`Compare current device constraint ${JSON.stringify(i.constraints)} to proposed constraints ${JSON.stringify(s)}`),i.matchesConstraints(s))}chooseInputIntrinsicDevice(e,t,i,o=!1){var n,r,a;return s(this,void 0,void 0,(function*(){this.inputDeviceCount+=1;const s=this.inputDeviceCount;if(null===t&&"video"===e){this.lastNoVideoInputDeviceCount=this.inputDeviceCount;const t=this.activeDevices[e];return void(t&&(this.releaseActiveDevice(t),delete this.activeDevices[e],this.watchForDeviceChangesIfNecessary()))}const d=this.calculateMediaStreamConstraints(e,t);if(this.matchesDeviceSelection(e,t,this.activeDevices[e],d))return void this.logger.info(`reusing existing ${e} input device`);this.activeDevices[e]&&this.activeDevices[e].stream&&("audio"===e?this.releaseActiveDevice(this.activeDevices[e]):"video"===e&&(this.stopTracksAndRemoveCallbacks("video"),delete this.activeDevices[e]));const l=Date.now(),c=new u.default;try{this.logger.info(`requesting new ${e} device with constraint ${JSON.stringify(d)}`);const i=this.intrinsicDeviceAsMediaStream(t);if("audio"===e&&null===t)c.stream=b.createEmptyAudioDevice(),c.constraints=null;else if(i)this.logger.info(`using media stream ${i.id} for ${e} device`),c.stream=i,c.constraints=d;else{if(c.stream=yield navigator.mediaDevices.getUserMedia(d),c.constraints=d,"video"===e&&this.lastNoVideoInputDeviceCount>s)return this.logger.warn(`ignored to get video device for constraints ${JSON.stringify(d)} as no device was requested`),void this.releaseMediaStream(c.stream);yield this.handleDeviceChange();const t=c.stream.getTracks()[0];c.endedCallback=()=>{this.activeDevices[e]&&this.activeDevices[e].stream===c.stream&&(this.logger.warn(`${e} input device which was active is no longer available, resetting to null device`),this.handleDeviceStreamEnded(e,this.getActiveDeviceId(e)),delete c.endedCallback)},t.addEventListener("ended",c.endedCallback,{once:!0})}if(null!==t){const t=null===(n=this.getMediaTrackSettings(c.stream))||void 0===n?void 0:n.deviceId;c.groupId=t?this.getGroupIdFromDeviceId(e,t):""}else c.groupId="";if("audio"===e){const e=c.stream.getAudioTracks()[0];if(e){const t=e.getSettings().deviceId||c.stream;c.trackMuteCallback=()=>{this.mediaStreamMuteObserver(t,!0)},c.trackUnmuteCallback=()=>{this.mediaStreamMuteObserver(t,!1)},e.addEventListener("mute",c.trackMuteCallback,{once:!1}),e.addEventListener("unmute",c.trackUnmuteCallback,{once:!1})}}}catch(t){let s;if(s=(null==t?void 0:t.name)&&t.message?`${t.name}: ${t.message}`:(null==t?void 0:t.name)?t.name:(null==t?void 0:t.message)?t.message:"UnknownError","audio"===e?null===(r=this.eventController)||void 0===r||r.publishEvent("audioInputFailed",{audioInputErrorMessage:s}):null===(a=this.eventController)||void 0===a||a.publishEvent("videoInputFailed",{videoInputErrorMessage:s}),this.logger.error(`failed to get ${e} device for constraints ${JSON.stringify(d)}: ${s}`),t&&"constraint"in t&&this.logger.error(`Over-constrained by constraint: ${t.constraint}`),"audio"===e){this.logger.info(`choosing null ${e} device instead`);try{c.stream=b.createEmptyAudioDevice(),c.constraints=null,yield this.handleNewInputDevice(e,c,i)}catch(t){this.logger.error(`failed to choose null ${e} device. ${t.name}: ${t.message}`)}}this.handleGetUserMediaError(t,Date.now()-l)}finally{this.watchForDeviceChangesIfNecessary()}if(this.logger.info(`got ${e} device for constraints ${JSON.stringify(d)}`),yield this.handleNewInputDevice(e,c,i,o),"audio"===e){this.logger.debug("Notifying mute state after selection");for(const e of c.stream.getAudioTracks())e.muted?c.trackMuteCallback():c.trackUnmuteCallback()}}))}handleNewInputDevice(e,t,i,o=!1){return s(this,void 0,void 0,(function*(){if(this.activeDevices[e]=t,this.logger.debug(`Set activeDevice to ${JSON.stringify(t)}`),this.watchForDeviceChangesIfNecessary(),"video"===e)this.chosenVideoInputIsTransformDevice()&&(this.logger.info("apply processors to transform"),yield this.chosenVideoTransformDevice.transformStream(this.activeDevices.video.stream)),yield this.restartLocalVideoAfterSelection(i,o);else if(this.useWebAudio)this.attachAudioInputStreamToAudioContext(this.activeDevices[e].stream);else if(this.boundAudioVideoController)try{yield this.boundAudioVideoController.restartLocalAudio((()=>{}))}catch(e){this.logger.info(`cannot replace audio track due to: ${e.message}`)}else this.logger.info("no audio-video controller is bound to the device controller")}))}bindAudioOutput(){return s(this,void 0,void 0,(function*(){if(!this.boundAudioVideoController)return;const e=this.deviceInfoFromDeviceId("audiooutput",this.audioOutputDeviceId);yield this.boundAudioVideoController.audioMixController.bindAudioDevice(e)}))}calculateMediaStreamConstraints(e,t){let i={};""===t&&(t=null);const s=this.intrinsicDeviceAsMediaStream(t);if(null===t)return null;if("string"==typeof t?this.browserBehavior.requiresNoExactMediaStreamConstraints()&&this.browserBehavior.requiresGroupIdMediaStreamConstraints()?(i.deviceId=t,i.groupId=this.getGroupIdFromDeviceId(e,t)):this.browserBehavior.requiresNoExactMediaStreamConstraints()?i.deviceId=t:i.deviceId={exact:t}:s?i.streamId=s.id:!function(e){return"object"==typeof e&&"deviceId"in e&&"groupId"in e&&"kind"in e&&"label"in e}(t)?i=t:(i.deviceId=t.deviceId,i.groupId=t.groupId),"video"===e&&(i.width=i.width||{ideal:this.videoInputQualitySettings.videoWidth},i.height=i.height||{ideal:this.videoInputQualitySettings.videoHeight},i.frameRate=i.frameRate||{ideal:this.videoInputQualitySettings.videoFrameRate}),"audio"===e&&this.supportSampleRateConstraint()&&(i.sampleRate={ideal:b.defaultSampleRate}),"audio"===e&&this.supportSampleSizeConstraint()&&(i.sampleSize={ideal:b.defaultSampleSize}),"audio"===e&&this.supportChannelCountConstraint()&&(i.channelCount={ideal:b.defaultChannelCount}),"audio"===e){i=Object.assign({echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0},i)}return"audio"===e?{audio:i}:{video:i}}deviceInfoFromDeviceId(e,t){if(null===this.deviceInfoCache)return null;for(const i of this.deviceInfoCache)if(i.kind===e&&i.deviceId===t)return i;return null}acquireInputStream(e){return s(this,void 0,void 0,(function*(){if("audio"===e&&this.useWebAudio){return this.getMediaStreamDestinationNode().stream}if("video"===e&&this.chosenVideoInputIsTransformDevice())return this.chosenVideoTransformDevice.outputMediaStream;let t=null;if(this.activeDevices[e]){this.logger.info(`checking whether existing ${e} input device can be reused`);const i=this.activeDevices[e];t=i.constraints?i.constraints[e]:null}else{if("audio"!==e)throw this.logger.error(`no ${e} device chosen, stopping local video tile`),this.boundAudioVideoController.videoTileController.stopLocalVideoTile(),new Error(`no ${e} device chosen, stopping local video tile`);this.logger.info(`no ${e} device chosen, creating empty ${e} device`)}try{yield this.chooseInputIntrinsicDevice(e,t,!0)}catch(t){if(this.logger.error(`unable to acquire ${e} device`),t instanceof g.default)throw t;throw new h.default(t,`unable to acquire ${e} device`)}return this.activeDevices[e].stream}))}hasAppliedTransform(){return!!this.transform}isMediaStreamReusableByDeviceId(e,t){if(!e||!e.active||!t)return!1;if(t.id)return e.id===t.id;const i=this.getMediaTrackSettings(e);if(!i.deviceId)return!1;const s=b.getIntrinsicDeviceId(t);return"string"==typeof s&&i.deviceId===s}getMediaTrackSettings(e){var t;return null===(t=e.getTracks()[0])||void 0===t?void 0:t.getSettings()}reconnectAudioInputs(){if(!this.audioInputSourceNode)return;this.audioInputSourceNode.disconnect();const e=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(e)}setTransform(e,t){var i,s;null===(s=null===(i=this.transform)||void 0===i?void 0:i.nodes)||void 0===s||s.end.disconnect(),this.transform={nodes:t,device:e};const o=null==t?void 0:t.end,n=this.getMediaStreamDestinationNode();this.logger.debug(`Connecting transform node ${o} to destination ${n}.`),null==o||o.connect(n),this.reconnectAudioInputs()}removeTransform(){var e;const t=this.transform;if(t)return null===(e=this.transform.nodes)||void 0===e||e.end.disconnect(),this.transform=void 0,this.reconnectAudioInputs(),t}attachAudioInputStreamToAudioContext(e){var t;null===(t=this.audioInputSourceNode)||void 0===t||t.disconnect(),this.audioInputSourceNode=b.getAudioContext().createMediaStreamSource(e);const i=this.getMediaStreamOutputNode();this.audioInputSourceNode.connect(i)}getMediaStreamDestinationNode(){return this.audioInputDestinationNode||(this.audioInputDestinationNode=b.getAudioContext().createMediaStreamDestination()),this.audioInputDestinationNode}getMediaStreamOutputNode(){var e,t;return(null===(t=null===(e=this.transform)||void 0===e?void 0:e.nodes)||void 0===t?void 0:t.start)||this.getMediaStreamDestinationNode()}static getAudioContext(){if(!b.audioContext){const e={};navigator.mediaDevices.getSupportedConstraints().sampleRate&&(e.sampleRate=b.defaultSampleRate),b.audioContext=new(window.AudioContext||window.webkitAudioContext)(e)}return b.audioContext}static closeAudioContext(){if(b.audioContext)try{b.audioContext.close()}catch(e){}b.audioContext=null}supportSampleRateConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleRate}supportSampleSizeConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().sampleSize}supportChannelCountConstraint(){return this.useWebAudio&&!!navigator.mediaDevices.getSupportedConstraints().channelCount}trace(e,t,i){let s=`API/DefaultDeviceController/${e}`;void 0!==t&&(s+=` ${JSON.stringify(t)}`),void 0!==i&&(s+=` -> ${JSON.stringify(i)}`),this.logger.info(s)}}t.default=b,b.permissionDeniedOriginDetectionThresholdMs=500,b.defaultVideoWidth=960,b.defaultVideoHeight=540,b.defaultVideoFrameRate=15,b.defaultVideoMaxBandwidthKbps=1400,b.defaultSampleRate=48e3,b.defaultSampleSize=16,b.defaultChannelCount=1,b.audioContext=null},78128:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){this.groupId=""}matchesConstraints(e){return JSON.stringify(this.constraints)===JSON.stringify(e)}}},95348:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Error{constructor(e,t){super(t||"Error fetching device."),this.cause=e,this.name="GetUserMediaError"}}t.default=i},86154:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DestroyableNoOpDeviceController=t.NoOpDeviceControllerWithEventController=void 0;const o=i(14015);class n extends o.default{constructor(e){super()}listAudioInputDevices(){return Promise.resolve([])}listVideoInputDevices(){return Promise.resolve([])}listAudioOutputDevices(){return Promise.resolve([])}chooseAudioInputDevice(e){return Promise.reject()}chooseVideoInputDevice(e){return Promise.reject()}chooseAudioOutputDevice(e){return Promise.reject()}addDeviceChangeObserver(e){}removeDeviceChangeObserver(e){}createAnalyserNodeForAudioInput(){return null}startVideoPreviewForVideoInput(e){}stopVideoPreviewForVideoInput(e){}setDeviceLabelTrigger(e){}mixIntoAudioInput(e){return null}chooseVideoInputQuality(e,t,i,s){}getVideoInputQualitySettings(){return null}}t.default=n;t.NoOpDeviceControllerWithEventController=class extends n{constructor(e){super(),this.eventController=e}};t.DestroyableNoOpDeviceController=class extends n{constructor(){super(...arguments),this.destroyed=!1}destroy(){return s(this,void 0,void 0,(function*(){this.destroyed=!0}))}}},31238:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(95348);class o extends s.default{constructor(e){super(e),this.name="NotFoundError"}}t.default=o},63110:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(95348);class o extends s.default{constructor(e){super(e),this.name="NotReadableError"}}t.default=o},44842:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(95348);class o extends s.default{constructor(e,t){super(e),this.constraint=t,this.name="OverconstrainedError"}}t.default=o},6991:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(95348);class o extends s.default{constructor(e,t){super(e,t),this.name="PermissionDeniedError"}}t.default=o},37786:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.inner=e}mute(e){return i(this,void 0,void 0,(function*(){}))}stop(){var e;return i(this,void 0,void 0,(function*(){null===(e=this.node)||void 0===e||e.disconnect()}))}intrinsicDevice(){return i(this,void 0,void 0,(function*(){return this.inner}))}createAudioNode(e){var t;return i(this,void 0,void 0,(function*(){return null===(t=this.node)||void 0===t||t.disconnect(),this.node=yield this.createSingleAudioNode(e),{start:this.node,end:this.node}}))}}},86950:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(95348);class o extends s.default{constructor(e){super(e),this.name="TypeError"}}t.default=o},64500:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i,s){this.videoWidth=e,this.videoHeight=t,this.videoFrameRate=i,this.videoMaxBandwidthKbps=s}}},27170:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVideoTransformDevice=void 0,t.isVideoTransformDevice=function(e){return!!e&&"object"==typeof e&&"transformStream"in e&&"stop"in e&&"intrinsicDevice"in e}},78236:function(e,t){"use strict";var i=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){if(this.devicePixelRatioSource=e,this.observerQueue=new Set,this.mediaQueryListener=()=>{this.observerQueue.forEach((e=>{e.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}))},"undefined"==typeof window)return;const i=matchMedia(`(resolution: ${this.devicePixelRatioSource.devicePixelRatio()}dppx)`);"function"==typeof i.addEventListener?(i.addEventListener("change",this.mediaQueryListener),this.mediaQueryList=i):"function"==typeof i.addListener?(i.addListener(this.mediaQueryListener),this.mediaQueryList=i):t.warn("ignoring DefaultDevicePixelRatioMonitor")}destroy(){return i(this,void 0,void 0,(function*(){this.mediaQueryList&&("function"==typeof this.mediaQueryList.addEventListener?this.mediaQueryList.removeEventListener("change",this.mediaQueryListener):this.mediaQueryList.removeListener(this.mediaQueryListener)),delete this.mediaQueryListener,this.observerQueue.clear()}))}registerObserver(e){this.observerQueue.add(e),e.devicePixelRatioChanged(this.devicePixelRatioSource.devicePixelRatio())}removeObserver(e){this.observerQueue.delete(e)}}},49190:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{devicePixelRatio(){return"undefined"!=typeof window&&window&&window.devicePixelRatio?window.devicePixelRatio:1}}},83520:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))},o=this&&this.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};Object.defineProperty(t,"__esModule",{value:!0});const n=i(38434),r=i(23922),a=i(68627),d=i(98690);class l{constructor(e,t,i,n,r){this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.retryCountLimit=15,this.lock=!1,this.cancellableEvents=new Map,this.attributesToFilter=["externalUserId","externalMeetingId","timestampMs"],this.deepCopyCurrentIngestionEvent=e=>({type:e.type,v:e.v,payloads:[...e.payloads]}),this.sendEvents=()=>s(this,void 0,void 0,(function*(){if(this.lock)return;const e=this.getItems(this.flushSize);if(0===e.length)return;this.lock=!0;const t=this.makeRequestBody(e);let i=!1;const s=Date.now();"firefox"===this.metadata.browserName.toLowerCase()&&this.cancellableEvents.set(s,e);try{this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - sending body ${t}`);const e=yield this.send(t);if(this.cancellableEvents.delete(s),e.ok)try{const i=yield e.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - send successful events: ${t} message: ${JSON.stringify(i)}`)}catch(e){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents error reading OK response ${e} for events ${t}`)}else this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Failed to send events ${t} with response status ${e.status}`),i=!0}catch(e){i=!0,this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEvents - Error in sending events ${t} to the ingestion endpoint ${e}`)}finally{this.lock=!1}i&&(this.cancellableEvents.delete(s),this.failedIngestionEvents.push(...e))}));const d=new a.default(r).getParserResult(),{browserMajorVersion:l}=d,c=o(d,["browserMajorVersion"]),u=t.toJSON(),{type:h,v:m}=u,v=o(u,["type","v"]);this.authenticationToken=t.getAuthenticationToken(),this.metadata=Object.assign(Object.assign({},c),v),Object.keys(this.metadata).forEach((e=>this.attributesToFilter.push(e))),this.type=h,this.v=m,this.ingestionURL=i,this.logger=r,this.importantEvents=new Set(n);const{maxBufferCapacityKb:f,totalBufferItems:g,flushSize:p,flushIntervalMs:S,retryCountLimit:C}=e;this.maxBufferCapacityBytes=1024*f,this.totalBufferItems=g,this.maxBufferItemCapacityBytes=Math.round(this.maxBufferCapacityBytes/g),this.flushIntervalMs=S,this.flushSize=p,this.retryCountLimit=C,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.beaconEventListener=e=>this.beaconEventHandler(e),this.addEventListeners()}addEventListeners(){this.beaconEventListener&&"window"in i.g&&window.addEventListener&&"document"in i.g&&document.addEventListener&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - addEventListeners - adding pagehide and visibility change event listeners"),window.addEventListener("pagehide",this.beaconEventListener),document.addEventListener("visibilitychange",this.beaconEventListener))}beaconEventHandler(e){("visibilitychange"===e.type&&"hidden"===document.visibilityState||"pagehide"===e.type)&&(this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - beaconEventHandler is triggered calling sendBeacon"),this.sendBeacon())}removeEventListeners(){this.beaconEventListener&&"window"in i.g&&window.removeEventListener&&"document"in i.g&&document.removeEventListener&&(window.removeEventListener("pagehide",this.beaconEventListener),document.removeEventListener("visibilitychange",this.beaconEventListener),this.logger.debug("Event Reporting - InMemoryJSONEventBuffer - removeEventListeners - removing pagehide and visibility change event listeners"))}start(){var e;this.removeEventListeners(),this.addEventListeners(),null===(e=this.intervalScheduler)||void 0===e||e.stop(),this.intervalScheduler=new r.default(this.flushIntervalMs),this.intervalScheduler.start((()=>this.sendEvents()))}stop(){var e;null===(e=this.intervalScheduler)||void 0===e||e.stop(),this.intervalScheduler=void 0,this.sendBeacon(),this.removeEventListeners()}addItem(e){return s(this,void 0,void 0,(function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - received event ${JSON.stringify(e)}`);const{name:t,ts:i,attributes:s}=e,o=s&&this.filterAttributes(s,this.attributesToFilter),n=Object.assign({name:t,ts:i},o);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - event after filtering attributes ${JSON.stringify(n)}`);const r=this.getSize(n);if(r>l.MAX_ITEM_SIZE_BYTES_ALLOWED)throw new Error(`Event Reporting - Item to be added has size ${r} bytes. Item cannot exceed max item size allowed of ${l.MAX_ITEM_SIZE_BYTES_ALLOWED} bytes.`);if(this.importantEvents.has(t))return this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - sending important event ${JSON.stringify(n)}`),void this.sendEventImmediately({name:t,ts:i,attributes:o});if(this.isFull())throw this.logger.warn("Event Reporting - Event buffer is full"),new Error("Buffer full");if(this.currentIngestionEvent.payloads.push(n),this.ingestionEventSize+=r,this.bufferItemThresholdReached(r)){const e=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);this.buffer.push(e),this.bufferSize+=this.ingestionEventSize,this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent(),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - addItem - buffer item threshold reached updated buffer ${JSON.stringify(this.buffer)}`)}}))}filterAttributes(e,t){const i=new Set(t);return Object.keys(e).filter((e=>i.has(e))).forEach((t=>delete e[t])),e}initializeAndGetCurrentIngestionEvent(){const e={type:this.type,v:this.v,payloads:[]};return this.ingestionEventSize=this.getSize(e),e}bufferItemThresholdReached(e){return e+this.ingestionEventSize>=this.maxBufferItemCapacityBytes||this.currentIngestionEvent.payloads.length===l.MAX_PAYLOAD_ITEMS}getSize(e){let t=0;if("object"==typeof e)for(const[i,s]of Object.entries(e))t+=this.getPrimitiveSize(i),t+=this.getSize(s);else t+=this.getPrimitiveSize(e);return t}getPrimitiveSize(e){let t=0;return"string"==typeof e?t+=2*e.length:"number"==typeof e&&(t+=8),t}isFull(){return this.bufferSize===this.maxBufferCapacityBytes||this.buffer.length===this.totalBufferItems}isEmpty(){return 0===this.buffer.length||0===this.bufferSize}getItems(e,t=0){if(this.isEmpty())return[];e=Math.min(this.buffer.length,e+1);return this.buffer.splice(t,e)}makeBeaconRequestBody(e){const t={metadata:this.metadata,events:e,authorization:this.authenticationToken};return JSON.stringify(t)}makeRequestBody(e){const t={metadata:this.metadata,events:e};return JSON.stringify(t)}sendEventImmediately(e){return s(this,void 0,void 0,(function*(){this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - important event received ${JSON.stringify(e)}`);const{name:t,ts:i,attributes:s}=e,o={type:this.type,v:this.v,payloads:[Object.assign({name:t,ts:i},s)]};let n=!1,r=null;const a=this.makeRequestBody([o]);try{if(r=yield this.send(a),r.ok){try{const e=yield r.json();this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - send successful event: ${a}, message: ${JSON.stringify(e)}`)}catch(e){this.logger.warn(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Error reading OK response ${e} for event ${a}`)}return}this.logger.error(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - Failed to send an important event ${a} with response status ${r.status}`),n=!0}catch(e){this.logger.warn(`Event Reporting - There may be a failure in sending an important event ${a} to the ingestion endpoint ${e}.`),n=!0;try{if("firefox"===this.metadata.browserName.toLowerCase()){const e=this.makeBeaconRequestBody([o]);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - beaconing data out ${e}`),n=!navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,e)}}catch(e){this.logger.warn(`Event Reporting - Error sending beacon for an important event ${a}`),n=!0}}n&&(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendEventImmediately - pushing to failed events ${a}`),this.failedIngestionEvents.push(o))}))}send(e){return s(this,void 0,void 0,(function*(){const t=new n.default(l.RETRY_FIXED_BACKOFF_WAIT_MS,l.RETRY_SHORT_BACKOFF_MS,l.RETRY_LONG_BACKOFF_MS);try{let i=0;for(;i<this.retryCountLimit;){const s=yield fetch(this.ingestionURL,{method:"POST",headers:{Authorization:`Bearer ${this.authenticationToken}`},body:e});if(s.ok||!l.SENDING_FAILURE_CODES.has(s.status))return s;if(this.logger.warn(`Will retry sending failure for ${e} due to status code ${s.status}.`),i++,i<this.retryCountLimit){const e=t.nextBackoffAmountMs();yield d.wait(e)}}if(i===this.retryCountLimit)throw new Error(`Retry count limit reached for ${e}`)}catch(e){throw e}}))}sendBeacon(){return s(this,void 0,void 0,(function*(){const e=this.buffer;if(this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out buffer events ${JSON.stringify(e)}`),this.buffer=[],this.currentIngestionEvent.payloads.length>0){const t=this.deepCopyCurrentIngestionEvent(this.currentIngestionEvent);e.push(t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out current ingestion event ${JSON.stringify(t)}`),this.currentIngestionEvent=this.initializeAndGetCurrentIngestionEvent()}if(this.failedIngestionEvents.length>0){const t=this.failedIngestionEvents.map((e=>this.deepCopyCurrentIngestionEvent(e)));e.push(...t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out any failed ingestion event ${JSON.stringify(t)}`),this.failedIngestionEvents=[]}if(this.cancellableEvents.size>0&&(this.cancellableEvents.forEach((t=>{e.push(...t),this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - clearing out each cancellable event ${JSON.stringify(t)}`)})),this.cancellableEvents.clear()),0===e.length)return;const t=this.makeBeaconRequestBody(e);this.logger.debug(`Event Reporting - InMemoryJSONEventBuffer - sendBeacon - beacon data to send ${t}`);try{navigator.sendBeacon(`${this.ingestionURL}?beacon=1`,t)||this.logger.warn(`Event Reporting - Browser failed to queue beacon data ${t}`)}catch(e){this.logger.warn(`Event Reporting - Sending beacon data ${t} failed with error ${e}`)}}))}reset(){this.maxBufferCapacityBytes=0,this.totalBufferItems=0,this.buffer=[],this.bufferSize=0,this.maxBufferItemCapacityBytes=0,this.ingestionEventSize=0,this.flushIntervalMs=0,this.flushSize=0,this.failedIngestionEvents=[],this.lock=!1,this.beaconEventListener=void 0,this.cancellableEvents.clear()}destroy(){return s(this,void 0,void 0,(function*(){this.stop(),this.reset()}))}}t.default=l,l.SENDING_FAILURE_CODES=new Set([408,429,500,502,503,504]),l.RETRY_FIXED_BACKOFF_WAIT_MS=0,l.RETRY_SHORT_BACKOFF_MS=1e3,l.RETRY_LONG_BACKOFF_MS=15e3,l.MAX_PAYLOAD_ITEMS=2,l.MAX_ITEM_SIZE_BYTES_ALLOWED=3e3},97700:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e=5e3,t=2,i=64,s=100,o=15){this.flushIntervalMs=e,this.flushSize=t,this.maxBufferCapacityKb=i,this.totalBufferItems=s,this.retryCountLimit=o}}},93831:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(4624),n=i(70146),r=i(75680),a=i(46366),d=i(79385),l=i(37797),c=i(74046),u=i(60731);class h{constructor(e,t,i){var s,n,r,a,d,l,c;this.meetingHistoryStates=[],this.observerSet=new Set,this.destroyed=!1,this.logger=t,this.configuration=e,this.setupEventReporter(e,t,i);try{this.parserResult=navigator&&navigator.userAgent?new o.UAParser(navigator.userAgent).getResult():null}catch(e){this.logger.error(e.message)}this.browserMajorVersion=(null===(r=null===(n=null===(s=this.parserResult)||void 0===s?void 0:s.browser)||void 0===n?void 0:n.version)||void 0===r?void 0:r.split(".")[0])||h.UNAVAILABLE,this.browserName=(null===(a=this.parserResult)||void 0===a?void 0:a.browser.name)||h.UNAVAILABLE,this.browserVersion=(null===(d=this.parserResult)||void 0===d?void 0:d.browser.version)||h.UNAVAILABLE,this.deviceName=[(null===(l=this.parserResult)||void 0===l?void 0:l.device.vendor)||"",(null===(c=this.parserResult)||void 0===c?void 0:c.device.model)||""].join(" ").trim()||h.UNAVAILABLE}addObserver(e){this.observerSet.add(e)}removeObserver(e){this.observerSet.delete(e)}forEachObserver(e){for(const t of this.observerSet)l.default.nextTick((()=>{this.observerSet.has(t)&&e(t)}))}publishEvent(e,t){return s(this,void 0,void 0,(function*(){const i=Date.now();this.meetingHistoryStates.push({name:e,timestampMs:i});const s=Object.freeze(Object.assign(this.getAttributes(i),t));this.forEachObserver((t=>{t.eventDidReceive(e,s)})),this.reportEvent(e,i,t)}))}reportEvent(e,t,i){var o;return s(this,void 0,void 0,(function*(){let s;try{i&&(s=u.default(i)),yield null===(o=this.eventReporter)||void 0===o?void 0:o.reportEvent(t,e,s)}catch(e){this.logger.error(`Error reporting event ${e}`)}}))}setupEventReporter(e,t,i){if(i)this._eventReporter=i;else if(e.urls){const i=e.urls.eventIngestionURL;if(i){this.logger.info("Event ingestion URL is present in the configuration");const{meetingId:s,credentials:{attendeeId:o,joinToken:n}}=e,l=new d.default(s,o,n),c=new r.default(l,i);this._eventReporter=new a.default(c,t)}}}getAttributes(e){var t,i;return{attendeeId:this.configuration.credentials.attendeeId,browserMajorVersion:this.browserMajorVersion,browserName:this.browserName,browserVersion:this.browserVersion,deviceName:this.deviceName,externalMeetingId:"string"==typeof this.configuration.externalMeetingId?this.configuration.externalMeetingId:"",externalUserId:this.configuration.credentials.externalUserId,meetingHistory:this.meetingHistoryStates,meetingId:this.configuration.meetingId,osName:(null===(t=this.parserResult)||void 0===t?void 0:t.os.name)||h.UNAVAILABLE,osVersion:(null===(i=this.parserResult)||void 0===i?void 0:i.os.version)||h.UNAVAILABLE,sdkVersion:c.default.sdkVersion,sdkName:c.default.sdkName,timestampMs:e}}get eventReporter(){return this._eventReporter}destroy(){return s(this,void 0,void 0,(function*(){n.isDestroyable(this.eventReporter)&&(yield this.eventReporter.destroy()),this.logger=void 0,this.configuration=void 0,this._eventReporter=void 0,this.destroyed=!0}))}}t.default=h,h.UNAVAILABLE="Unavailable"},60731:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=e=>{const t={};for(const[i,s]of Object.entries(e))if(null!=s&&""!==s){if("number"!=typeof s&&"string"!=typeof s)throw new TypeError("Unhandled type received while flattening attributes.");t[i]=s}return t}},75680:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(97700);t.default=class{constructor(e,t,i=new s.default){this.eventsClientConfiguration=e,this.ingestionURL=t,this.eventBufferConfiguration=i}}},46366:function(e,t,i){"use strict";var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function r(e){try{d(s.next(e))}catch(e){n(e)}}function a(e){try{d(s.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=i(70146),n=i(83520);t.default=class{constructor(e,t){this.reportingEvents=!1,this.importantEvents=["meetingEnded","meetingFailed","meetingStartFailed","audioInputFailed","videoInputFailed","meetingStartSucceeded"],this.destroyed=!1;const{eventsClientConfiguration:i,ingestionURL:s,eventBufferConfiguration:o}=e,{eventsToIgnore:r}=i;this.eventBuffer=new n.default(o,i,s,this.importantEvents,t),this.logger=t,this.eventsToIgnore=r,this.start()}start(){if(!this.reportingEvents)try{this.eventBuffer.start(),this.logger.info("Event reporting started"),this.reportingEvents=!0}catch(e){this.logger.error(`Event Reporting - Error starting the event buffer ${e}`)}}stop(){if(this.reportingEvents)try{this.eventBuffer.stop(),this.logger.info("Event reporting stopped"),this.reportingEvents=!1}catch(e){this.logger.error(`Event Reporting - Error stopping the event buffer ${e}`)}}reportEvent(e,t,i){return s(this,void 0,void 0,(function*(){if(this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - event received in reportEvent ${e}, ${t}, ${JSON.stringify(i)}`),this.eventsToIgnore.includes(t))this.logger.debug(`Event Reporting - DefaultMeetingEventReporter - ${t} event will be ignored as it is in events to ignore`);else try{this.logger.debug("Event Reporting - DefaultMeetingEventReporter - adding item to event buffer"),yield this.eventBuffer.addItem({ts:e,name:t,attributes:i})}catch(e){this.logger.error(`Event Reporting - Error adding event to buffer ${e}`)}}))}destroy(){return s(this,void 0,void 0,(function*(){this.destroyed=!0,this.stop(),o.isDestroyable(this.eventBuffer)&&this.eventBuffer.destroy(),this.eventBuffer=void 0}))}}},90732:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(){}reportEvent(e,t,i){}start(){}stop(){}}},79385:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t,i,s=[]){this.type="Meet",this.v=1,this.meetingId=e,this.attendeeId=t,this.eventsToIgnore=s,this.authenticationToken=i}getAuthenticationToken(){return this.authenticationToken}toJSON(){const e={};return e.type=this.type,e.v=this.v,e.meetingId=this.meetingId,e.attendeeId=this.attendeeId,e}}},63204:(e,t,i)=>{"use strict";t.kwN=void 0,t.ini=t.J6=void 0,t.iyk=void 0;i(75185).default;i(37535).default;i(37797).default;i(2628).default;i(47602).default;i(79880).default;i(23765).default;i(31876).default;i(99734).default;i(51260).default;i(84243).default;i(19854).default;i(13940).default;i(31789).default;i(59394).default;i(47237).default;i(19807).default;i(62084).default;i(48892).default;i(69333).default;i(51087).default;i(72606).default;i(87415).default;i(4299).default;i(26818).default;i(71737).default;i(53216).default;i(47408).default;i(56196).default;i(99496).default;i(92770).default;i(66688).default;i(23731).default;const s=i(88030);t.kwN=s.default;i(18890).default;i(78370).default;i(5054).default;i(21129).default;i(11018).default;i(78320).default;i(42363).default;i(96802).default;i(9059).default;i(18538).default;i(90543).default;i(86893).default;i(38023).default;i(44142).default;i(78236).default;i(93831).default;i(66354).default;i(46366).default;i(83980).default;i(19751).default;const o=i(88947);t.J6=o.default;i(60214).default;i(97500).default;i(70983).default;i(29141).default;i(19678).default;i(50334).default;i(41208).default;i(24450).default;i(9636).default;i(50365).default;i(95308).default;i(68627).default;i(51133).default;i(38919).default;i(91508).default;i(91318).default;i(3327).default;i(42958).default;i(94922).default;i(67673).default;i(99751).default;i(67631).default;i(49190).default;i(78128).default;i(97700).default;i(75680).default;i(26240).default;i(38434).default;i(55640).default;i(67300).default;i(95348).default;i(2306).default;i(83520).default;i(23922).default;i(21960).default;i(96180).default;i(2748).default;i(80293).default;const n=i(70813);t.ini=n.default;i(34236).default;i(79385).default;i(3990).default;i(10589).default;i(68015).default;i(87604).default;i(41296).default;i(16326).default;i(13789).default;i(25687).default;i(87215).default;i(76057).default;i(5723).default;i(19358).default;const r=i(77500);t.iyk=r.default;i(80022).default;i(11981).default;i(69938).default;i(4442).default;i(69836).default;i(30209).default;i(86154).default;i(90732).default;i(77434).default;i(14015).default;i(48831).default;i(13663).default;i(52801).default;i(5319).default;i(40657).default;i(31238).default;i(63110).default;i(21124).default;i(94543).default;i(44842).default;i(28556).default;i(6991).default;i(75910).default;i(19825).default;i(49576).default;i(51209).default;i(25547).default;i(120).default;i(39560).default;i(39708).default;i(88797).default;i(44191).default;i(326).default;i(4076).default;i(41944).default;i(99485).default;i(47079).default;i(13860).default;i(36850).default;i(79553).default;i(93013).default;i(64833).default;i(25275).default;i(68581).default;i(3920).default;i(42902).default;i(99416).default;i(82168).default;i(46729).default;i(9101).default;i(17606).default;i(5785).default;i(34242).default;i(37786).default;i(62811).default;i(95924).default;i(42721).default;i(4456).default;i(44929).default;i(90250).default;i(34739).default;i(32471).default;i(67210).default;i(61741).default;i(53037).default;i(59063).default;i(5323).default;i(41288).default;i(91326).default;i(86950).default;i(51922).default;i(74046).default;i(12880).default;i(40155).default;i(79354).default;i(91754).default;i(21819).default;i(84992).default;i(91034).default;i(64500).default;i(90060).default;i(96876).default;i(37804).default;i(32497).default;i(48878).default;i(6171).default;i(7387).default;i(73320).default;const a=i(21819);const d=i(28660);const l=i(91746);const c=i(70146);const u=i(27170)}}]);